<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRAC - Artist Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* BASIC RESET */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Space Grotesk', sans-serif; }
        body { 
            background: #ffffff; 
            color: #000000; 
            line-height: 1.6; 
            font-weight: 400;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* Add this right after the body styles */
        html {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        /* LOGIN STYLES - PROPERLY CENTERED */
        #login-section { 
            background: white; 
            min-height: 100vh; 
            display: grid; 
            place-items: center; 
            justify-content: center;
            padding: 2rem; 
        }
        .login-container { width: 100%; max-width: 440px; }
        .login-header { text-align: center; margin-bottom: 3rem; }
        .login-header h1 { font-size: 2rem; font-weight: 500; margin-bottom: 0.75rem; letter-spacing: -0.02em; }
        .login-header .tagline { color: #666; font-size: 1rem; font-weight: 400; }
        .auth-form { background: white; border: 1px solid #e5e5e5; border-radius: 12px; padding: 2.5rem; }
        .form-header { text-align: center; margin-bottom: 2.5rem; }
        .form-header h2 { font-size: 1.25rem; font-weight: 500; margin-bottom: 0.5rem; }
        .form-header p { color: #666; font-size: 0.9rem; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-size: 0.85rem; margin-bottom: 0.5rem; color: #333; font-weight: 500; }
        .form-group input { width: 100%; padding: 0.875rem; border: 1px solid #d1d1d1; border-radius: 8px; font-size: 0.9rem; font-family: inherit; transition: border-color 0.2s; background: white; }
        .form-group input:focus { outline: none; border-color: #000; }
        .auth-button { width: 100%; background: #000; color: white; border: none; padding: 1rem; font-size: 0.9rem; font-weight: 500; cursor: pointer; border-radius: 8px; transition: opacity 0.2s; margin-bottom: 1.5rem; }
        .auth-button:hover { opacity: 0.9; }
        .auth-switch { text-align: center; padding-top: 1.5rem; border-top: 1px solid #f0f0f0; }
        .auth-switch p { color: #666; font-size: 0.85rem; }
        .auth-switch a { color: #000; text-decoration: underline; }
        .message { margin: 1rem 0; padding: 0.875rem; border-radius: 8px; font-size: 0.85rem; text-align: center; }

        /* DASHBOARD HEADER */
        .gallery-header { background: white; border-bottom: 1px solid #e5e5e5; padding: 1rem 0; position: sticky; top: 0; z-index: 100; }
        .header-container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .header-left { display: flex; align-items: center; gap: 3rem; }
        .logo-container { background: #000000; border-radius: 12px; padding: 0.75rem 1.25rem; display: inline-flex; align-items: center; justify-content: center; }
        .gallery-logo { font-size: 2.2rem; font-weight: 600; letter-spacing: -0.02em; color: #ffffff; margin: 0; line-height: 1; }
        .gallery-nav { display: flex; gap: 2rem; }
        .nav-item { text-decoration: none; color: #666; font-size: 0.85rem; font-weight: 400; transition: color 0.2s; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; }
        .nav-item.active, .nav-item:hover { color: #000; }
        .header-right { display: flex; gap: 1rem; }
        .icon-button { background: none; border: none; padding: 0.5rem; cursor: pointer; color: #666; transition: color 0.2s; border-radius: 8px; }
        .icon-button:hover { color: #000; background: #f5f5f5; }

        /* DASHBOARD CONTENT */
        .gallery-main { padding: 0; }
        .hero-section { padding: 3rem 0 2rem; text-align: center; }
        .hero-container { max-width: 800px; margin: 0 auto; padding: 0 2rem; }
        .hero-title { font-size: 2.25rem; font-weight: 500; margin-bottom: 0.75rem; letter-spacing: -0.02em; }
        .hero-subtitle { font-size: 1rem; color: #666; font-weight: 400; }
        .stats-section { padding: 2rem 0; border-bottom: 1px solid #e5e5e5; }
        .stats-container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; }
        .stat-item { text-align: center; }
        .stat-number { font-size: 2rem; font-weight: 400; margin-bottom: 0.5rem; letter-spacing: -0.02em; }
        .stat-label { font-size: 0.85rem; color: #666; text-transform: uppercase; letter-spacing: 0.05em; }
        .artworks-section { padding: 4rem 0; }
        .section-header { max-width: 1400px; margin: 0 auto 3rem; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .section-title { font-size: 1.25rem; font-weight: 500; letter-spacing: -0.02em; }
        .add-artwork-btn { background: #000; color: white; border: none; padding: 0.75rem 1.5rem; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: opacity 0.2s; border-radius: 8px; }
        .add-artwork-btn:hover { opacity: 0.9; }
        .artworks-grid { 
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: grid;
            gap: 2rem; 
        }
        .empty-state { grid-column: 1 / -1; text-align: center; padding: 4rem 2rem; }
        .empty-icon { font-size: 3rem; margin-bottom: 1.5rem; }
        .empty-state h4 { font-size: 1.1rem; font-weight: 500; margin-bottom: 0.5rem; }
        .empty-state p { color: #666; margin-bottom: 2rem; font-size: 0.9rem; }
        .cta-button { background: #000; color: white; border: none; padding: 1rem 2rem; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: opacity 0.2s; border-radius: 8px; }
        .cta-button:hover { opacity: 0.9; }
        .artwork-card { 
            /* Ensure proper text containment */
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .artwork-info {
            padding: 0;
            max-width: 100%; /* Contain within image width */
            word-wrap: break-word;
        }
        .artwork-title { 
            font-size: 0.8rem; /* Even smaller title */
            font-weight: 500; 
            margin-bottom: 0.25rem; 
        }
        .artwork-details { 
            color: #666; 
            font-size: 0.7rem;
            line-height: 1.3;
            max-width: 100%; /* Contain within parent */
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        /* Add this to your CSS - prevents description overflow */
        .artwork-details div {
            max-width: 100%;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Specifically target description text */
        .artwork-details div[style*="italic"] {
            font-style: italic;
            margin-top: 0.5rem;
            max-width: 100%;
            word-wrap: break-word;
            overflow-wrap: break-word;
            display: block;
        }
        .artwork-actions {
            margin-top: 1rem;
        }
        .delete-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 0.7rem;
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
        }
        .delete-btn:hover {
            color: #ff4444;
        }

        /* Events Styles */
        .event-card {
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 1.5rem;
            background: white;
        }
        .event-date {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        .event-title {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #000;
        }
        .event-location {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.75rem;
        }
        .event-description {
            font-size: 0.8rem;
            color: #333;
            line-height: 1.4;
            margin-bottom: 1rem;
        }
        .event-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        
        /* Activity Section - COMPACT VERSION */
        .activity-section { 
            padding: 1.5rem 0; 
            border-top: 1px solid #e5e5e5; 
        }
        .activity-list { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 0 2rem; 
        }

        .activity-item { 
            display: flex; 
            gap: 0.75rem; 
            padding: 0.5rem 0; 
            border-bottom: 1px solid #f0f0f0; 
        }
        .activity-dot { 
            width: 6px; 
            height: 6px; 
            background: #000; 
            border-radius: 50%; 
            margin-top: 0.4rem; 
            flex-shrink: 0; 
        }

        .activity-content p { 
            margin-bottom: 0.2rem; 
            font-size: 0.75rem; 
            line-height: 1.3;
            color: #333;
        }

        .activity-time { 
            font-size: 0.65rem; 
            color: #666; 
        }

        /* UPLOAD FORM */
        .upload-form-container { max-width: 800px; margin: 0 auto 3rem; padding: 0 2rem; }
        .upload-form { background: white; border: 1px solid #e5e5e5; border-radius: 12px; overflow: hidden; }
        .upload-form .form-header { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 2rem; border-bottom: 1px solid #e5e5e5; margin: 0; }
        .upload-form .form-header h4 { font-size: 1.1rem; font-weight: 500; margin: 0; }
        .close-form { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 8px; }
        .close-form:hover { color: #000; background: #f5f5f5; }
        .form-body { padding: 2rem; }
        .upload-zone { border: 2px dashed #d1d1d1; border-radius: 12px; padding: 3rem 2rem; text-align: center; cursor: pointer; transition: all 0.3s ease; margin-bottom: 2rem; background: #fafafa; }
        .upload-zone:hover { border-color: #000; background: #f5f5f5; }
        .upload-zone.dragover { border-color: #000; background: #f0f0f0; }
        .upload-placeholder span { display: block; }
        .upload-placeholder span:first-child { font-size: 1rem; margin-bottom: 0.5rem; font-weight: 500; }
        .upload-subtitle { color: #666; font-size: 0.85rem; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
        .form-actions { display: flex; justify-content: flex-end; gap: 1rem; padding: 1.5rem 2rem; border-top: 1px solid #e5e5e5; background: #fafafa; }
        .btn-secondary { background: transparent; border: 1px solid #d1d1d1; padding: 0.75rem 1.5rem; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: all 0.2s; border-radius: 8px; }
        .btn-secondary:hover { background: #f5f5f5; }
        .btn-primary { background: #000; color: white; border: none; padding: 0.75rem 1.5rem; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: opacity 0.2s; border-radius: 8px; }
        .btn-primary:hover { opacity: 0.9; }
        .image-preview { text-align: center; }
        .image-preview img { max-width: 100%; max-height: 300px; }

        /* Timeline Filter Buttons */
        .timeline-filter {
            background: #f5f5f5;
            border: 1px solid #e5e5e5;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timeline-filter:hover {
            background: #e5e5e5;
        }

        .timeline-filter.active {
            background: #000;
            color: white;
            border-color: #000;
        }

        /* PROFILE SETTINGS STYLES */
        .form-section { margin-bottom: 2rem; }
        .form-section h3 { font-size: 0.85rem; font-weight: 500; margin-bottom: 1rem; color: #000; text-transform: uppercase; letter-spacing: 0.05em; }
        .terms-group { display: flex; align-items: flex-start; gap: 0.75rem; margin: 2rem 0; padding: 1rem 0; border-top: 1px solid #f0f0f0; border-bottom: 1px solid #f0f0f0; }
        .terms-group input[type="checkbox"] { margin-top: 0.2rem; }
        .terms-group label { font-size: 0.85rem; color: #333; line-height: 1.4; }
        .terms-group a { color: #000; text-decoration: underline; }
        .social-platform-item { margin-bottom: 1.5rem; padding: 1rem; border: 1px solid #f0f0f0; border-radius: 8px; background: #fafafa; }

        /* PORTFOLIO STYLES */
        .portfolio-header { background: white; border-bottom: 1px solid #e5e5e5; padding: 1rem 0; position: sticky; top: 0; z-index: 100; }
        .portfolio-header .header-container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .portfolio-header .header-left { display: flex; align-items: center; gap: 3rem; }
        .portfolio-header .header-right { display: flex; gap: 2rem; align-items: center; }
        .artist-name { font-size: 1.5rem; font-weight: 500; color: #000; }
        .portfolio-nav { display: flex; gap: 2rem; }
        .collection-section {
            margin-top: 6rem !important;
            margin-bottom: 5rem !important;
        }

        /* PORTFOLIO Size Classes */
        .artworks-grid.small { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)) !important; }
        .artworks-grid.medium { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)) !important; }
        .artworks-grid.large { grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)) !important; }

        /* Natural image sizing for both dashboard and portfolio */
        .artwork-image {
            width: 100%;
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem; /* Add space between image and info */
        }
        .artwork-image img {
            width: 100%;
            height: auto;
            display: block;
        }
        /* PORTFOLIO STYLES - FIXED VERSION */
        .style-minimal-dark {
            --bg-color: #000000;
            --text-color: #ffffff;
            --accent-color: #666666;
            --border-color: #333333;
        }

        .style-gallery-bright {
            --bg-color: #ffffff;
            --text-color: #333333;
            --accent-color: #000000;
            --border-color: #e5e5e5;
        }

        .style-warm-modern {
            --bg-color: #f8f4e9;
            --text-color: #5a4a3a;
            --accent-color: #8b7355;
            --border-color: #e8e0d0;
        }

        .style-bold-minimal {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --accent-color: #ff6b6b;
            --border-color: #333333;
        }

        /* ONLY TARGET THE MAIN PORTFOLIO PAGE - NOT SETTINGS OR COLLECTIONS */
        body.style-applied #portfolioPage {
            background: var(--bg-color) !important;
            color: var(--text-color) !important;
        }

        body.style-applied #portfolioPage .portfolio-header {
            background: var(--bg-color) !important;
            border-bottom-color: var(--border-color) !important;
        }

        body.style-applied #portfolioPage .artist-name,
        body.style-applied #portfolioPage .portfolio-nav .nav-item {
            color: var(--text-color) !important;
        }

        body.style-applied #portfolioPage .portfolio-nav .nav-item.active {
            color: var(--accent-color) !important;
        }
        
    </style>
</head>
<body>
    <!-- LOGIN SECTION -->
    <div id="login-section">
        <div class="login-container">
            <div class="login-header">
                <!-- TRAC Logo -->
                <div style="margin-bottom: 1.5rem;">
                    <div style="background: #000000; border-radius: 12px; padding: 1rem 1.5rem; display: inline-flex; align-items: center; justify-content: center;">
                        <h1 style="font-size: 3rem; font-weight: 600; letter-spacing: -0.02em; color: #ffffff; margin: 0; line-height: 1;">TRAC</h1>
                    </div>
                </div>
                <h1 style="font-size: 2rem; margin-bottom: 0.75rem;">Artist Portal</h1>
                <p class="tagline">Sign up or sign in to access your artist dashboard</p>
            </div>

            <!-- Sign In Form (Default) -->
            <div id="signInForm" class="auth-form">
                <div class="form-header">
                    <h2>Welcome back</h2>
                    <p>Sign in to your dashboard</p>
                </div>

                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Enter your email">
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <div style="position: relative;">
                        <input type="password" id="password" placeholder="Enter your password" style="padding-right: 2.5rem;">
                        <button type="button" onclick="togglePassword('password')" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer; padding: 0.25rem;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                </div>

                <button id="signInButton" class="auth-button">Sign in</button>

                <div class="auth-switch">
                    <p>Don't have an account? <a href="#" id="switchToSignUp">Sign up</a></p>
                </div>

                <div id="message" class="message"></div>
            </div>

            <!-- Sign Up Form (Hidden by default) -->
            <div id="signUpForm" class="auth-form" style="display: none;">
                <div class="form-header">
                    <h2>Create Artist Account</h2>
                    <p>Join TRAC as an artist to manage your artwork</p>
                </div>

                <div class="form-section">
                    <h3>Full Name</h3>
                    <div class="form-group">
                        <input type="text" id="signupFullName" placeholder="Enter your full name">
                    </div>

                    <div class="form-group">
                        <input type="email" id="signupEmail" placeholder="Enter your email">
                    </div>
                </div>

                <div class="form-section">
                    <h3>Password</h3>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <div style="position: relative;">
                            <input type="password" id="signupPassword" placeholder="Enter your password" style="padding-right: 2.5rem;">
                            <button type="button" onclick="togglePassword('signupPassword')" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer; padding: 0.25rem;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <div style="position: relative;">
                            <input type="password" id="confirmPassword" placeholder="Confirm your password" style="padding-right: 2.5rem;">
                            <button type="button" onclick="togglePassword('confirmPassword')" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer; padding: 0.25rem;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="terms-group">
                    <input type="checkbox" id="agreeTerms">
                    <label for="agreeTerms">
                        I agree to the <a href="#" onclick="showTermsPopup()" style="color: #000; text-decoration: underline;">Terms of Service</a> and <a href="#" onclick="showPrivacyPopup()" style="color: #000; text-decoration: underline;">Privacy Policy</a>
                    </label>
                </div>

                <button id="signUpButton" class="auth-button">Create Artist Account</button>

                <div class="auth-switch">
                    <p>Already have an account? <a href="#" id="switchToSignIn">Sign in</a></p>
                </div>

                <div id="signupMessage" class="message"></div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD SECTION -->
    <div id="dashboard-section" style="display: none;">
        <header class="gallery-header">
            <div class="header-container">
                <div class="header-left">
                    <div class="logo-container">
                        <h1 class="gallery-logo">TRAC</h1>
                    </div>
                    <nav class="gallery-nav">
                        <a href="#" class="nav-item active" onclick="showSection('dashboard')">Dashboard</a>
                        <a href="#" class="nav-item" onclick="showSection('settings')">Profile Settings</a>
                        <a href="#" class="nav-item" onclick="showSection('portfolio')">Portfolio</a>
                    </nav>
                </div>
                <div class="header-right">
                    <button class="icon-button" onclick="signOut()" title="Sign Out">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M6 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V3.33333C2 2.97971 2.14048 2.64057 2.39052 2.39052C2.64057 2.14048 2.97971 2 3.33333 2H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M10.6667 11.3333L14 7.99996L10.6667 4.66663" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M14 8H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <main class="gallery-main">
            <!-- Hero Section -->
            <section class="hero-section">
                <div class="hero-container">
                    <h2 class="hero-title">Your Art Archive</h2>
                    <p class="hero-subtitle">Manage and protect your artistic legacy</p>
                </div>
            </section>

            <!-- Stats Section -->
            <section class="stats-section">
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-number">0</div>
                        <div class="stat-label">Artworks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">0</div>
                        <div class="stat-label">Collections</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">0</div>
                        <div class="stat-label">Activities</div>
                    </div>
                </div>
            </section>

            <!-- Artworks Grid Section -->
            <section class="artworks-section">
                <div class="section-header">
                    <h3 class="section-title">Your Uploaded Works</h3>
                    <button class="add-artwork-btn" onclick="showUploadForm()">+ Add Artwork</button>
                </div>

                
                <!-- Artworks Grid -->
                <div id="artworksGrid" class="artworks-grid">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" style="margin-bottom: 1.5rem;">
                                <rect x="10" y="10" width="60" height="60" fill="none" stroke="#ddd" stroke-width="1.5"/>
                                <line x1="25" y1="25" x2="55" y2="55" stroke="#ddd" stroke-width="1"/>
                                <line x1="55" y1="25" x2="25" y2="55" stroke="#ddd" stroke-width="1"/>
                            </svg>
                        </div>
                        <h4>No artworks yet</h4>
                        <p>Add your first artwork to start building your archive</p>
                        <button class="cta-button" onclick="showUploadForm()">Upload Your First Piece</button>
                    </div>
                </div>
            </section>

            <!-- UPLOAD FORM -->
            <!-- FLOATING ARTWORK EDIT POPUP -->
            <div id="uploadForm" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 10000;">
                <div class="upload-form">
                    <div class="form-header" style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 2rem; border-bottom: 1px solid #e5e5e5;">
                        <h4 style="margin: 0;">Add New Artwork</h4>
                        <button class="close-form" onclick="hideUploadForm()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 8px;">Ã—</button>
                    </div>
                    <form id="artworkUploadForm">
                        <div class="form-body" style="padding: 2rem;">
                            <!-- KEEP ALL YOUR EXISTING FORM CONTENT EXACTLY AS IS -->
                            <div class="upload-zone" id="uploadZone" ondragover="handleDragOver(event)" ondrop="handleDrop(event)">
                                <div class="upload-placeholder" id="uploadPlaceholder">
                                    <span>Drag & drop artwork image here</span>
                                    <span class="upload-subtitle">or click to browse (JPG, PNG, WebP - max 5MB)</span>
                                </div>
                                <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageSelect(event)">
                                <div id="imagePreview" class="image-preview" style="display: none;"></div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="title">Title *</label>
                                    <input type="text" id="title" name="title" required>
                                </div>
                                <div class="form-group">
                                    <label for="year">Year</label>
                                    <input type="number" id="year" name="year" min="1900" max="2030">
                                </div>
                                <div class="form-group">
                                    <label for="medium">Medium</label>
                                    <input type="text" id="medium" name="medium" placeholder="Oil on canvas, etc.">
                                </div>
                                <div class="form-group">
                                    <label for="dimensions">Dimensions</label>
                                    <input type="text" id="dimensions" name="dimensions" placeholder="24 Ã— 36 in">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="description">Description</label>
                                <textarea id="description" name="description" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="isPublic" name="isPublic" checked>
                                    Make this artwork public on your portfolio
                                </label>
                            </div>
                        </div>
                        <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 1rem; padding: 1.5rem 2rem; border-top: 1px solid #e5e5e5; background: #fafafa;">
                            <button type="button" class="btn-secondary" onclick="hideUploadForm()">Cancel</button>
                            <button type="submit" class="btn-primary">Add Artwork</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Your Events Section -->
            <section class="artworks-section" style="border-top: 1px solid #e5e5e5; padding-top: 3rem;">
                <div class="section-header">
                    <h3 class="section-title">Your Events</h3>
                    <button class="add-artwork-btn" onclick="showAddEventForm()">+ Add Event</button>
                </div>

                <div id="eventsGrid" class="artworks-grid">
                    <div class="empty-state">
                        <div class="empty-icon">ðŸ“…</div>
                        <h4>No upcoming events</h4>
                        <p>Add exhibitions, shows, or important dates to track your artistic calendar</p>
                        <button class="cta-button" onclick="showAddEventForm()">Add Your First Event</button>
                    </div>
                </div>
            </section>


            <!-- Archived Artworks Section -->
            <section class="artworks-section" style="border-top: 1px solid #e5e5e5; padding-top: 3rem;">
                <div class="section-header">
                    <h3 class="section-title">Your Archives</h3>
                    <button class="add-artwork-btn" onclick="showArchivedPopup()">View Archived Works</button>
                </div>
            </section>

            <!-- Activity Section -->
            <section class="activity-section">
                <div class="section-header" style="margin-bottom: 1rem;">
                    <h3 class="section-title" style="font-size: 1rem;">Recent Activity</h3>
                    <button class="add-artwork-btn" onclick="showActivityHistory()" style="font-size: 0.8rem; padding: 0.5rem 1rem;">View History</button>
                </div>
                <div class="activity-list" id="activitiesList">
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <p>Loading activities...</p>
                        </div>
                    </div>
                </div>
            </section>

        </main>
        </div>

        <!-- Archived Works Popup -->
        <div id="archivedPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center;">
            <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 1200px; width: 90%; max-height: 80vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h3 style="margin: 0;">Archived Works</h3>
                    <button onclick="hideArchivedPopup()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">Ã—</button>
                </div>

                <div id="archivedArtworksGrid" class="artworks-grid large">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" style="margin-bottom: 1.5rem;">
                                <rect x="15" y="15" width="50" height="50" fill="none" stroke="#ddd" stroke-width="1.5"/>
                                <rect x="20" y="20" width="40" height="15" fill="none" stroke="#ddd" stroke-width="1"/>
                                <line x1="20" y1="45" x2="60" y2="45" stroke="#ddd" stroke-width="1"/>
                                <line x1="20" y1="55" x2="60" y2="55" stroke="#ddd" stroke-width="1"/>
                            </svg>
                        </div>
                        <h4>No archived artworks</h4>
                        <p>Archived works are hidden from your main collection but preserved.</p>
                    </div>
                </div>
            </div>
        </div>

        </div>         

    <!-- PROFILE SETTINGS SECTION -->
    <div id="settings-section" style="display: none;">
        <header class="gallery-header">
            <div class="header-container">
                <div class="header-left">
                    <div class="logo-container">
                        <h1 class="gallery-logo">TRAC</h1>
                    </div>
                    <nav class="gallery-nav">
                        <a href="#" class="nav-item" onclick="showSection('dashboard')">Dashboard</a>
                        <a href="#" class="nav-item active">Profile Settings</a>
                        <a href="#" class="nav-item" onclick="showSection('portfolio')">Portfolio</a>
                    </nav>
                </div>
                <div class="header-right">
                    <button class="icon-button" onclick="signOut()" title="Sign Out">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M6 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V3.33333C2 2.97971 2.14048 2.64057 2.39052 2.39052C2.64057 2.14048 2.97971 2 3.33333 2H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M10.6667 11.3333L14 7.99996L10.6667 4.66663" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M14 8H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <main class="gallery-main">
            <!-- Hero Section -->
            <section class="hero-section">
                <div class="hero-container">
                    <h2 class="hero-title">Profile Settings</h2>
                    <p class="hero-subtitle">Manage your artist profile and portfolio settings</p>
                </div>
            </section>

    <!-- Profile Form Section -->
    <section class="artworks-section">
        <div class="upload-form-container">
            <div class="upload-form">
                <div class="form-header">
                    <h4>Artist Profile</h4>
                </div>

                <form id="profileSettingsForm">
                    <div class="form-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="username">Username *</label>
                                <input type="text" id="username" name="username" required>
                                <small style="color: #666; font-size: 0.8rem;">This will be your portfolio URL: trac/username</small>
                            </div>

                            <div class="form-group">
                                <label>Your Portfolio Link</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="portfolioLink" readonly style="flex: 1; background: #f5f5f5;">
                                    <button type="button" onclick="copyPortfolioLink()" class="btn-secondary">Copy</button>
                                </div>
                                <small style="color: #666; font-size: 0.8rem;">Share this link with galleries and collectors</small>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="profileFullName">Full Name *</label>
                            <input type="text" id="profileFullName" name="fullName" required>
                        </div>

                        <div class="form-group">
                            <label for="profilePhoto">Profile Photo</label>
                            <input type="file" id="profilePhoto" name="profilePhoto" accept="image/*" style="margin-bottom: 0.5rem;">
                            <small style="color: #666; font-size: 0.8rem;">Recommended: Square image, 500x500px or larger</small>
                        </div>
                        <div id="profilePhotoPreview" style="margin-top: 0.5rem;"></div>

                        <div class="form-group">
                            <label for="bio">Artist Bio</label>
                            <textarea id="bio" name="bio" rows="10" placeholder="Tell your artistic story..." style="width: 100%; min-height: 200px; resize: vertical;"></textarea>
                        </div>

                        <div class="form-section">
                            <h3>Contact</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="website">Website</label>
                                    <input type="url" id="website" name="website" placeholder="https://...">
                                </div>
                                <div class="form-group">
                                    <label for="contactEmail">Contact Email</label>
                                    <input type="email" id="contactEmail" name="contactEmail">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Professional Materials</h3>
                            <div class="form-group">
                                <label for="cvUpload">Curriculum Vitae (CV)</label>
                                <input type="file" id="cvUpload" name="cvUpload" accept=".pdf,.doc,.docx" style="margin-bottom: 0.5rem;">
                                <small style="color: #666; font-size: 0.8rem;">Upload your CV (PDF or Word). Gallery professionals can request access via your public portfolio.</small>
                            </div>
                            <div id="cvCurrentFile" style="margin-top: 0.5rem;"></div>
                        </div>

                        <div class="form-section">
                            <h3>Social Media</h3>
                            <div id="socialPlatformsContainer">
                                <!-- Platforms will be added here dynamically -->
                            </div>
                            <button type="button" class="btn-secondary" onclick="addSocialPlatform()" style="margin-top: 1rem;">+ Add Platform</button>
                        </div>

                        <div class="form-section">
                            <h3>Portfolio Display</h3>
                            <div class="form-group">
                                <label>Artwork Image Size</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="radio" name="imageSize" value="small"> Small
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="radio" name="imageSize" value="medium" checked> Medium
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="radio" name="imageSize" value="large"> Large
                                    </label>
                                </div>
                            </div>
                        </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="showSection('dashboard')">Back to Dashboard</button>
                        <button type="submit" class="btn-primary">Save Profile</button>
                    </div>
                </form>

                <!-- PORTFOLIO STYLES SECTION -->
                    <div class="form-section">
                        <h3>Portfolio Styles</h3>
                        <div class="form-group">
                            <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
                                Browse and apply curated portfolio designs
                            </p>
                            <button type="button" onclick="showStyleBrowser()" class="btn-secondary" 
                                    style="width: auto; padding: 0.75rem 1.5rem;">
                                Browse Portfolio Styles
                            </button>
                             <div id="currentStyleIndicator" style="display: none; padding: 1rem; background: #f8f8f8; border-radius: 8px; border: 1px solid #e5e5e5; margin-top: 1rem;">
                                    <div style="font-size: 0.9rem; color: #666; margin-bottom: 0.25rem;">Current Style</div>
                                    <div id="currentStyleName" style="font-weight: 500;">Loading...</div>
                                </div>
                            </div>

                </div>

                <div class="form-section">
                    <h3>Portfolio Collections</h3>
                    <div id="collectionsContainer">
                        <!-- Collections will be listed here -->
                    </div>
                    <button type="button" class="btn-secondary" onclick="showCreateCollectionForm()" style="margin-top: 1rem;">+ New Collection</button>
                </div>

                <!-- Create Collection Form -->
                    <div id="createCollectionForm" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 10000;">
                    <div class="upload-form">
                        <div class="form-header">
                            <h4>Create New Collection</h4>
                            <button class="close-form" onclick="hideCreateCollectionForm()">Ã—</button>
                        </div>
                        <form id="collectionForm">
                            <div class="form-body">
                                <div class="form-group">
                                    <label for="collectionTitle">Collection Title *</label>
                                    <input type="text" id="collectionTitle" name="name" required>
                                </div>
                                <div class="form-group">
                                    <label for="collectionStatement">Artist Statement</label>
                                    <textarea id="collectionStatement" name="statement" rows="10" placeholder="Describe this body of work..." style="width: 100%; min-height: 200px; resize: vertical;"></textarea>
                                </div>
                                <div class="form-section">
                                    <h3>Add Artworks to Collection</h3>
                                    <div id="availableArtworks" style="max-height: 200px; overflow-y: auto; border: 1px solid #e5e5e5; padding: 1rem; border-radius: 8px;">
                                        <!-- Artworks will be listed here -->
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="hideCreateCollectionForm()">Cancel</button>
                                <button type="submit" class="btn-primary">Create Collection</button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </section>
    </main>
    </div>
    
    <!-- PORTFOLIO SECTION -->
    <div id="portfolio-section">
        <div id="portfolioPage">
            <!-- Portfolio content loads here -->
            <div style="padding: 2rem; text-align: center;">
                <h1>Loading portfolio...</h1>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        // TRAC - Single Page App
        console.log("ðŸŽ¯ TRAC SPA loaded");

        // STYLE PRESETS DATA
        const STYLE_PRESETS = {
            'guerrilla-minimal': {
                id: 'guerrilla-minimal',
                name: 'Guerrilla Minimal',
                fonts: { primary: 'Helvetica', secondary: 'Courier New' },
                colors: { 
                    bg: '#0a0a0a', 
                    text: '#ffffff', 
                    accent: '#ff0000',
                    border: '#333333'
                },
                layout: 'stacked',
                sections: ['works', 'about', 'events']
            },
            'elegant-gallery': {
                id: 'elegant-gallery',
                name: 'Elegant Gallery', 
                fonts: { primary: 'Georgia', secondary: 'Helvetica' },
                colors: { 
                    bg: '#f8f8f8', 
                    text: '#2a2a2a', 
                    accent: '#8b7355',
                    border: '#e0e0e0'
                },
                layout: 'grid-focused',
                sections: ['hero', 'works', 'about']
            },
            'experimental-immersive': {
                id: 'experimental-immersive',
                name: 'Experimental Immersive',
                fonts: { primary: 'Space Grotesk', secondary: 'Inter' },
                colors: { 
                    bg: '#1a1a2e', 
                    text: '#e6e6e6', 
                    accent: '#00b4d8',
                    border: '#2d3047'
                },
                layout: 'stacked',
                sections: ['hero', 'works', 'events', 'about']
            },
            'monumental-sculptural': {
                id: 'monumental-sculptural',
                name: 'Monumental Sculptural',
                fonts: { primary: 'Times New Roman', secondary: 'Arial' },
                colors: { 
                    bg: '#2c2c2c', 
                    text: '#ffffff', 
                    accent: '#c0a080',
                    border: '#4a4a4a'
                },
                layout: 'stacked',
                sections: ['hero', 'works', 'about']
            },
            'historical-layered': {
                id: 'historical-layered',
                name: 'Historical Layered',
                fonts: { primary: 'Garamond', secondary: 'Helvetica' },
                colors: { 
                    bg: '#f5f1e6', 
                    text: '#3a2c1e', 
                    accent: '#8b4513',
                    border: '#d4c4a8'
                },
                layout: 'stacked',
                sections: ['hero', 'about', 'works', 'events']
            },
            'colorful-vibrant': {
                id: 'colorful-vibrant',
                name: 'Colorful Vibrant',
                fonts: { primary: 'Arial', secondary: 'Georgia' },
                colors: { 
                    bg: '#ffffff', 
                    text: '#333333', 
                    accent: '#ff6b6b',
                    border: '#e5e5e5'
                },
                layout: 'grid-focused',
                sections: ['works', 'hero', 'about']
            },
            'abstract-expressionist': {
                id: 'abstract-expressionist',
                name: 'Abstract Expressionist',
                fonts: { primary: 'Brush Script MT', secondary: 'Arial' },
                colors: { 
                    bg: '#1e1e1e', 
                    text: '#f0f0f0', 
                    accent: '#ff9500',
                    border: '#3a3a3a'
                },
                layout: 'stacked',
                sections: ['hero', 'works', 'about']
            },
            'storytelling-quilt': {
                id: 'storytelling-quilt',
                name: 'Storytelling Quilt',
                fonts: { primary: 'Georgia', secondary: 'Verdana' },
                colors: { 
                    bg: '#fff8e1', 
                    text: '#5d4037', 
                    accent: '#7b1fa2',
                    border: '#ffcc80'
                },
                layout: 'grid-focused',
                sections: ['hero', 'about', 'works']
            },
            'contemporary-digital': {
                id: 'contemporary-digital',
                name: 'Contemporary Digital',
                fonts: { primary: 'Inter', secondary: 'Space Grotesk' },
                colors: { 
                    bg: '#000000', 
                    text: '#00ff00', 
                    accent: '#ff00ff',
                    border: '#333333'
                },
                layout: 'grid-focused',
                sections: ['works', 'events', 'about']
            },
            'political-archival': {
                id: 'political-archival',
                name: 'Political Archival',
                fonts: { primary: 'Times New Roman', secondary: 'Courier New' },
                colors: { 
                    bg: '#ffffff', 
                    text: '#000000', 
                    accent: '#cc0000',
                    border: '#cccccc'
                },
                layout: 'stacked',
                sections: ['hero', 'about', 'works', 'events']
            }
        };

        const STYLE_COMPONENTS = {
          fonts: [
            { primary: 'Inter', secondary: 'Space Grotesk' },
            { primary: 'Helvetica', secondary: 'Georgia' },
            { primary: 'Georgia', secondary: 'Helvetica' },
            { primary: 'Space Grotesk', secondary: 'Inter' },
            { primary: 'Times New Roman', secondary: 'Arial' },
            { primary: 'Garamond', secondary: 'Helvetica' },
            { primary: 'Arial', secondary: 'Georgia' },
            { primary: 'Brush Script MT', secondary: 'Arial' },
            { primary: 'Courier New', secondary: 'Helvetica' }
          ],
          colorSchemes: [
            { bg: '#0a0a0a', text: '#ffffff', accent: '#ff0000', border: '#333333' },
            { bg: '#f8f8f8', text: '#2a2a2a', accent: '#8b7355', border: '#e0e0e0' },
            { bg: '#1a1a2e', text: '#e6e6e6', accent: '#00b4d8', border: '#2d3047' },
            { bg: '#2c2c2c', text: '#ffffff', accent: '#c0a080', border: '#4a4a4a' },
            { bg: '#f5f1e6', text: '#3a2c1e', accent: '#8b4513', border: '#d4c4a8' },
            { bg: '#ffffff', text: '#333333', accent: '#ff6b6b', border: '#e5e5e5' },
            { bg: '#1e1e1e', text: '#f0f0f0', accent: '#ff9500', border: '#3a3a3a' },
            { bg: '#fff8e1', text: '#5d4037', accent: '#7b1fa2', border: '#ffcc80' },
            { bg: '#000000', text: '#00ff00', accent: '#ff00ff', border: '#333333' },
            { bg: '#ffffff', text: '#000000', accent: '#cc0000', border: '#cccccc' }
          ],
          layouts: ['stacked', 'grid-focused', 'magazine', 'portfolio'],
          sections: [
            ['hero', 'works', 'about', 'events'],
            ['works', 'hero', 'about'], 
            ['hero', 'about', 'works', 'events'],
            ['works', 'events', 'about']
          ]
        };

        let generatedStyles = [];
        let currentPage = 0;
        let favoriteStyles = JSON.parse(localStorage.getItem('favoriteStyles')) || [];

        // Your credentials
        const supabaseUrl = 'https://vhgsayaugbepugssyary.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZoZ3NheWF1Z2JlcHVnc3N5YXJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2NjA5ODMsImV4cCI6MjA3ODIzNjk4M30.2a6qJqW3BrHZxHHhM5Hm9e0sU6Bts6dXmPFW5tbrW_A';

        // Global Supabase client
        let supabaseClient;

        // Global variables
        let currentArtworks = [];
        let cachedPortfolioData = null;
        let cachedArtworksData = null;
        let cachedCollectionsData = null;

        // Activity Types Constants
        const ACTIVITY_TYPES = {
            ARTWORK_UPLOAD: 'artwork_upload',
            ARTWORK_ARCHIVE: 'artwork_archive', 
            ARTWORK_DELETE: 'artwork_delete',
            ARTWORK_RESTORE: 'artwork_restore',
            COLLECTION_CREATE: 'collection_create',
            COLLECTION_DELETE: 'collection_delete',
            PROFILE_UPDATE: 'profile_update'
        };

        // Event Types Constants
        const EVENT_TYPES = {
            EXHIBITION: 'exhibition',
            SHOW: 'show', 
            DEADLINE: 'deadline',
            OPENING: 'opening',
            OTHER: 'other'
        };

        // Clean URL Routing
        function handleUrlRouting() {
            const hash = window.location.hash;
            console.log("ðŸ”— Current hash:", hash);

            // Handle #/trac/username URLs (works everywhere)
            if (hash.startsWith('#/trac/')) {
                const username = hash.replace('#/trac/', '').split('/')[0];
                console.log("ðŸŽ¯ Loading public portfolio for:", username);
                loadPublicPortfolio(username);
                return true;
            }

            console.log("âŒ No public portfolio URL detected");
            return false;
        }

        // Social platforms with icons
        const availablePlatforms = [
            'instagram', 'arena', 'twitter', 'tiktok', 'substack', 
            'linkedin', 'facebook', 'youtube', 'vimeo', 'spotify',
            'threads', 'bluesky', 'discord', 'patreon', 'github', 'upscrolled'
        ];

        // Activity Logging Function
        // REPLACE your current logActivity function with this:
        async function logActivity(type, title, description = null, metadata = {}) {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) {
                    console.log('No user found - skipping activity log');
                    return;
                }

                const { error } = await supabaseClient
                    .from('activities')
                    .insert([{
                        artist_id: user.id,
                        type: type,
                        title: title,
                        description: description,
                        metadata: metadata
                    }]);

                if (error) {
                    console.error('ðŸ”´ ACTIVITY INSERT FAILED:', {
                        error: error,
                        details: error.details,
                        hint: error.hint,
                        message: error.message,
                        dataWeSent: {
                            artist_id: user.id,
                            type: type,
                            title: title,
                            description: description,
                            metadata: metadata
                        }
                    });
                    return;
                }

                console.log('Activity logged:', type); // Debug log

            } catch (error) {
                console.error('Unexpected error logging activity:', error);
                // Fail silently - don't break main functionality
            }
        }

        async function updateDashboardStats() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                // Get artwork count
                const { count: artworkCount, error: artworkError } = await supabaseClient
                    .from('artworks')
                    .select('*', { count: 'exact', head: true })
                    .eq('artist_id', user.id)
                    .eq('is_archived', false);

                if (artworkError) throw artworkError;

                // Get collections count
                const { count: collectionCount, error: collectionError } = await supabaseClient
                    .from('collections')
                    .select('*', { count: 'exact', head: true })
                    .eq('artist_id', user.id);

                if (collectionError) throw collectionError;

                // Get activities count
                const { count: activityCount, error: activityError } = await supabaseClient
                    .from('activities')
                    .select('*', { count: 'exact', head: true })
                    .eq('artist_id', user.id);

                if (activityError) throw activityError;

                // Update the stats
                const statNumbers = document.querySelectorAll('.stat-number');
                if (statNumbers[0]) statNumbers[0].textContent = artworkCount || 0;
                if (statNumbers[1]) statNumbers[1].textContent = collectionCount || 0;
                if (statNumbers[2]) statNumbers[2].textContent = activityCount || 0;

            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        // Events Functions
        function showAddEventForm() {
            alert('Event form coming soon! This will allow you to add exhibitions, shows, and important dates.');
            // TODO: Implement event form
        }

        // Placeholder function for events data
        async function loadEvents() {
            // TODO: Implement events loading from database
            console.log('Loading events...');
        }

        function setupActivitiesRealtime() {
            const subscription = supabaseClient
                .channel('activities-changes')
                .on('postgres_changes', 
                    { 
                        event: 'INSERT', 
                        schema: 'public', 
                        table: 'activities' 
                    }, 
                    (payload) => {
                        console.log('ðŸŸ¢ REAL-TIME: New activity detected:', payload);
                        fetchActivities();
                    }
                )
                .subscribe((status) => {
                    console.log('ðŸ”µ REAL-TIME SUBSCRIPTION STATUS:', status);
                });

            return subscription;
        }

        // Add this function to display collections
        async function loadCollectionsInProfile() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const { data: collections, error } = await supabaseClient
                    .from('collections')
                    .select(`
                        *,
                        artwork_collections (
                            artwork_id
                        )
                    `)
                    .eq('artist_id', user.id)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                displayCollectionsInProfile(collections || []);

            } catch (error) {
                console.error('Error loading collections:', error);
            }
        }

        function displayCollectionsInProfile(collections) {
            const container = document.getElementById('collectionsContainer');

            if (!collections || collections.length === 0) {
                container.innerHTML = '<p style="color: #666; font-size: 0.9rem;">No collections yet</p>';
                return;
            }

            container.innerHTML = collections.map(collection => `
                <div class="collection-item" style="border: 1px solid #e5e5e5; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <h4 style="margin: 0 0 0.25rem 0; font-size: 1rem; font-weight: 500;">${collection.name}</h4>
                        <p style="margin: 0; color: #666; font-size: 0.8rem;">
                            ${collection.artwork_collections ? collection.artwork_collections.length : 0} artworks â€¢ ${collection.is_public ? 'Public' : 'Private'}
                        </p>
                    </div>
                    <div style="display: flex; gap: 0.5rem; flex-shrink: 0;">
                        <button onclick="event.preventDefault(); event.stopPropagation(); editCollection('${collection.id}')" class="btn-secondary" style="font-size: 0.7rem; padding: 0.25rem 0.5rem;">Edit</button>
                        <button onclick="event.preventDefault(); event.stopPropagation(); toggleCollectionPrivacy('${collection.id}', ${collection.is_public})" class="btn-secondary" style="font-size: 0.7rem; padding: 0.25rem 0.5rem;">
                            Make ${collection.is_public ? 'Private' : 'Public'}
                        </button>
                        <button onclick="event.preventDefault(); event.stopPropagation(); deleteCollection('${collection.id}')" class="delete-btn" style="color: #ccc; text-decoration: underline; background: none; border: none; cursor: pointer; font-size: 0.7rem; padding: 0;">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // â¬‡ï¸ REPLACE SOCIAL ICONS MAPPING WITH PROPER SVGs â¬‡ï¸
        const socialIcons = {
            instagram: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                <circle cx="12" cy="12" r="5"></circle>
                <circle cx="18" cy="6" r="1"></circle>
            </svg>`,
            arena: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>`,
            twitter: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
            </svg>`,
            tiktok: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12a4 4 0 1 0 4 4V4a5 5 0 0 0 5 5"></path>
            </svg>`,
            substack: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                <line x1="8" y1="8" x2="16" y2="8"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
                <line x1="8" y1="16" x2="13" y2="16"></line>
            </svg>`,
            linkedin: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                <rect x="2" y="9" width="4" height="12"></rect>
                <circle cx="4" cy="4" r="2"></circle>
            </svg>`,
            facebook: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
            </svg>`,
            youtube: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 12a29 29 0 0 0 .46 5.58 2.78 2.78 0 0 0 1.94 2c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2A29 29 0 0 0 23 12a29 29 0 0 0-.46-5.58z"></path>
                <polygon points="9.75 15.02 15.5 12 9.75 8.98 9.75 15.02"></polygon>
            </svg>`,
            vimeo: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22.875 10.063c-.835 4.43-5.95 10.62-9.375 10.62-3.426 0-4.26-3.128-7.426-3.128-3.165 0-4.524 2.23-5.874 2.23-1.35 0-2.2-1.34-2.2-2.68 0-1.34 1.35-2.68 2.2-2.68 1.35 0 2.1 1.34 3.425 1.34 1.325 0 2.55-3.13 3.425-5.02.875-1.89 2.2-5.02 3.425-5.02 1.225 0 2.55 2.68 3.425 4.47.875 1.79 1.75 4.47 2.55 4.47.8 0 2.55-2.68 3.425-4.47.875-1.79 1.75-2.68 2.55-2.68s1.35 1.34 1.35 2.68c0 1.34-.875 2.68-1.35 2.68z"></path>
            </svg>`,
            spotify: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M8 12c0 1.38.72 2.5 1.6 3.2.88.7 2.08 1.2 3.4 1.2s2.52-.5 3.4-1.2c.88-.7 1.6-1.82 1.6-3.2s-.72-2.5-1.6-3.2C15.52 8.5 14.32 8 13 8s-2.52.5-3.4 1.2C8.72 9.9 8 11.02 8 12z"></path>
            </svg>`,
            threads: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 8l-4 4h3a4 4 0 0 1-4 4H5a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v0z"></path>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>`,
            bluesky: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
            </svg>`,
            discord: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path>
                <path d="M15 12a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path>
                <path d="M8 16c.5.5 1.2 1 2 1s1.5-.5 2-1"></path>
                <path d="M21 12c0 5-4 9-9 9s-9-4-9-9 4-9 9-9 9 4 9 9z"></path>
                <path d="M8 8h8M8 12h8"></path>
            </svg>`,
            patreon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M8 8h8v8H8z"></path>
            </svg>`,
            github: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg>`,
            upscrolled: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                <line x1="8" y1="8" x2="16" y2="8"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
                <line x1="8" y1="16" x2="12" y2="16"></line>
            </svg>`
        };

        async function fetchActivities() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const { data: activities, error } = await supabaseClient
                    .from('activities')
                    .select('*')
                    .eq('artist_id', user.id)
                    .order('created_at', { ascending: false })
                    .limit(10);

                if (error) throw error;

                displayActivities(activities || []);

                // UPDATE ACTIVITY COUNT IN STATS - ADD THESE 3 LINES:
                if (activities && activities.length > 0) {
                    document.querySelector('.stats-container .stat-number').textContent = activities.length;
                }

            } catch (error) {
                console.error('Error fetching activities:', error);
                document.getElementById('activitiesList').innerHTML = `
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <p>Unable to load activities</p>
                        </div>
                    </div>
                `;
            }
        }

        function displayActivities(activities) {
            const container = document.getElementById('activitiesList');

            if (!activities || activities.length === 0) {
                container.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <p><strong>Welcome to TRAC</strong> - Your artist archive is ready</p>
                            <div class="activity-time">Just now</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <p>Upload your first artwork to start building your portfolio</p>
                            <div class="activity-time">Today</div>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = activities.map(activity => {
                // Customize display based on activity type
                let displayText = activity.title;
                if (activity.description) {
                    displayText += ` - ${activity.description}`;
                }

                return `
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <p>${displayText}</p>
                            <div class="activity-time">${formatActivityTime(activity.created_at)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function formatActivityTime(timestamp) {
            const now = new Date();
            const activityTime = new Date(timestamp);
            const diffMs = now - activityTime;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;

            return activityTime.toLocaleDateString();
        }

        // Show activity history popup
        function showActivityHistory() {
            document.getElementById('activityHistoryPopup').style.display = 'flex';
            loadActivityHistory(24); // Default: last day
        }

        // Hide activity history popup
        function hideActivityHistory() {
            document.getElementById('activityHistoryPopup').style.display = 'none';
        }

        // Load activity history with time filter
        async function loadActivityHistory(hours = 0) {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                let query = supabaseClient
                    .from('activities')
                    .select('*')
                    .eq('artist_id', user.id)
                    .order('created_at', { ascending: false });

                // Add time filter if not "All Time"
                if (hours > 0) {
                    const timeAgo = new Date();
                    timeAgo.setHours(timeAgo.getHours() - hours);
                    query = query.gte('created_at', timeAgo.toISOString());
                }

                const { data: activities, error } = await query;

                if (error) throw error;

                displayActivityHistory(activities || []);

            } catch (error) {
                console.error('Error loading activity history:', error);
                document.getElementById('activityHistoryList').innerHTML = `
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <p>Unable to load activity history</p>
                        </div>
                    </div>
                `;
            }
        }

        // Display activity history
        function displayActivityHistory(activities) {
            const container = document.getElementById('activityHistoryList');

            if (!activities || activities.length === 0) {
                container.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <p>No activities found for this time period</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = activities.map(activity => {
                let displayText = activity.title;
                if (activity.description) {
                    displayText += ` - ${activity.description}`;
                }

                return `
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <p>${displayText}</p>
                            <div class="activity-time">${formatActivityTime(activity.created_at)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }        

        // SPA Navigation
        function showSection(sectionName) {
            console.log("ðŸ” [DEBUG] Switching to section:", sectionName);

            // Hide all sections
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('dashboard-section').style.display = 'none';
            document.getElementById('settings-section').style.display = 'none';
            document.getElementById('portfolio-section').style.display = 'none';

            // Show selected section
            document.getElementById(sectionName + '-section').style.display = 'block';
            console.log("âœ… [DEBUG] Section displayed:", sectionName);

            // Load section-specific data
            console.log("ðŸ” [DEBUG] Checking section:", sectionName);
            if (sectionName === 'dashboard') {
                console.log("ðŸš€ [DEBUG] Calling fetchUserArtworks");
                fetchUserArtworks();
                console.log("ðŸš€ [DEBUG] Calling fetchUserCollections"); 
                fetchArchivedArtworks();
                fetchActivities();
                loadEvents();
            } else if (sectionName === 'settings') {
                console.log("ðŸš€ [DEBUG] Calling loadProfileData");
                loadProfileData();
                console.log("âœ… [DEBUG] loadProfileData called");
            } else if (sectionName === 'portfolio') {
                console.log("ðŸš€ [DEBUG] Calling loadPortfolio");
                loadPortfolio();
            }

            if (sectionName !== 'portfolio') {
                console.log("ðŸ” [DEBUG] Clearing hash for section:", sectionName);
                window.location.hash = '';
            }

            console.log("ðŸ [DEBUG] showSection completed for:", sectionName);
        }

        // Initialize Supabase
        async function initializeApp() {
            supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

            console.log("ðŸ”§ initializeApp started");

            setupActivitiesRealtime();

            // Check if we're loading a public portfolio URL
            const isPublicPortfolio = handleUrlRouting();
            console.log("ðŸ“¡ URL Routing result:", isPublicPortfolio);

            if (!isPublicPortfolio) {
                console.log("ðŸš€ Showing login page");
                showSection('login');
            } else {
                console.log("ðŸŽ¯ Public portfolio loading handled by URL routing");
            }
        }

        // Sign out function
        async function signOut() {
            try {
                const { error } = await supabaseClient.auth.signOut();
                if (error) throw error;

                alert("âœ… Signed out successfully");
                showSection('login');

            } catch (error) {
                console.error('Error signing out:', error);
                alert('Error signing out. Please try again.');
            }
        }

        // Form switching
        function showSignUpForm() {
            document.getElementById('signInForm').style.display = 'none';
            document.getElementById('signUpForm').style.display = 'block';
            clearMessages();
        }

        function showSignInForm() {
            document.getElementById('signUpForm').style.display = 'none';
            document.getElementById('signInForm').style.display = 'block';
            clearMessages();
        }

        function clearMessages() {
            document.getElementById('message').innerHTML = '';
            document.getElementById('signupMessage').innerHTML = '';
        }

        // Popup functions for Terms & Privacy
        function showTermsPopup() {
            document.getElementById('termsPopup').style.display = 'flex';
        }

        function hideTermsPopup() {
            document.getElementById('termsPopup').style.display = 'none';
        }

        function showPrivacyPopup() {
            document.getElementById('privacyPopup').style.display = 'flex';
        }

        function hidePrivacyPopup() {
            document.getElementById('privacyPopup').style.display = 'none';
        }

        // ARTWORK UPLOAD SYSTEM
        function showUploadForm(artwork = null) {
            console.log("ðŸ” showUploadForm called, artwork:", artwork);

            document.getElementById('uploadForm').style.display = 'block';
            document.getElementById('artworksGrid').style.display = 'none';

            // If editing existing artwork, pre-fill data
            if (artwork) {
                console.log("ðŸ” EDIT MODE - Setting up edit form");

                // Pre-fill form data WITHOUT resetting
                document.getElementById('title').value = artwork.title || '';
                document.getElementById('year').value = artwork.year || '';
                document.getElementById('medium').value = artwork.medium || '';
                document.getElementById('dimensions').value = artwork.dimensions || '';
                document.getElementById('description').value = artwork.description || '';
                document.getElementById('isPublic').checked = artwork.is_public || false;

                // Show current image AND upload zone for editing
                document.getElementById('uploadZone').style.display = 'block';
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('imagePreview').innerHTML = `
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <img src="${artwork.image_url}" alt="${artwork.title}" style="max-width: 100%; max-height: 200px; border-radius: 0;">
                        <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #666;">
                            Current artwork - upload new image below to replace
                        </div>
                    </div>
                `;

                // Set form to edit mode
                document.getElementById('artworkUploadForm').dataset.mode = 'edit';
                document.getElementById('artworkUploadForm').dataset.artworkId = artwork.id;
                document.querySelector('#uploadForm .form-header h4').textContent = 'Edit Artwork';

                // Change button text
                const updateBtn = document.querySelector('#uploadForm .btn-primary');
                console.log("ðŸ” Update button found:", updateBtn);
                if (updateBtn) {
                    updateBtn.textContent = 'Update Artwork';
                }

            } else {
                console.log("ðŸ” CREATE MODE");
                // CREATE MODE - reset form and show only upload zone
                document.getElementById('artworkUploadForm').reset();
                document.getElementById('uploadZone').style.display = 'block';
                document.getElementById('imagePreview').style.display = 'none';

                document.getElementById('artworkUploadForm').dataset.mode = 'create';
                document.querySelector('#uploadForm .form-header h4').textContent = 'Add New Artwork';
                document.querySelector('#uploadForm .btn-primary').textContent = 'Add Artwork';
            }
        }

        function hideUploadForm() {
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('artworksGrid').style.display = 'grid';
            document.getElementById('artworkUploadForm').reset();
        }

        async function uploadArtwork() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) throw new Error('Not authenticated');

                const formData = new FormData(document.getElementById('artworkUploadForm'));
                const title = document.getElementById('title').value;
                const isEdit = document.getElementById('artworkUploadForm').dataset.mode === 'edit';
                const artworkId = document.getElementById('artworkUploadForm').dataset.artworkId;

                if (!title) {
                    alert('Please enter a title for your artwork');
                    return;
                }

                if (!isEdit && !selectedImageFile) {
                    alert('Please select an image for your artwork');
                    return;
                }

                let imageUrl = null;
                let imagePath = null;

                // Upload new image if provided
                if (selectedImageFile) {
                    const imageName = `${user.id}/${Date.now()}_${selectedImageFile.name}`;
                    const { data: imageData, error: uploadError } = await supabaseClient.storage
                        .from('artwork-images')
                        .upload(imageName, selectedImageFile);

                    if (uploadError) throw uploadError;

                    const { data: { publicUrl } } = supabaseClient.storage
                        .from('artwork-images')
                        .getPublicUrl(imageData.path);

                    imageUrl = publicUrl;
                    imagePath = imageData.path;
                }

                let result;

                if (isEdit) {
                    // UPDATE EXISTING ARTWORK
                    const isPublic = document.getElementById('isPublic').checked;
                    const updateData = {
                        title: title,
                        year: formData.get('year') || null,
                        medium: formData.get('medium') || '',
                        dimensions: formData.get('dimensions') || '',
                        description: formData.get('description') || '',
                        is_public: isPublic  // â† ADD THIS LINE
                    };

                    if (imageUrl) {
                        updateData.image_url = imageUrl;
                    }

                    const { data, error } = await supabaseClient
                        .from('artworks')
                        .update(updateData)
                        .eq('id', artworkId)
                        .eq('artist_id', user.id)
                        .select();

                    result = { data, error };

                    if (result.error) throw result.error;

                    await logActivity(
                        ACTIVITY_TYPES.ARTWORK_UPDATE,
                        'Updated artwork',
                        `Modified "${title}"`,
                        { artwork_id: artworkId }
                    );

                    alert('âœ… Artwork updated!');

                } else {
                    // CREATE NEW ARTWORK
                    const artworkData = {
                        artist_id: user.id,
                        title: title,
                        year: formData.get('year') || null,
                        medium: formData.get('medium') || '',
                        dimensions: formData.get('dimensions') || '',
                        description: formData.get('description') || '',
                        image_url: imageUrl,
                        is_public: isPublic,
                        created_at: new Date().toISOString()
                    };

                    const { data, error } = await supabaseClient
                        .from('artworks')
                        .insert([artworkData])
                        .select();

                    result = { data, error };

                    if (result.error) throw result.error;

                    currentArtworks.unshift(result.data[0]);

                    await logActivity(
                        ACTIVITY_TYPES.ARTWORK_UPLOAD, 
                        'Added new artwork', 
                        `Uploaded "${artworkData.title}" to your collection`,
                        { artwork_id: result.data[0].id }  // âœ… FIXED: use result.data
                    );

                    alert('ðŸŽ¨ Artwork added to your archive!');
                }

                // Refresh display and cleanup
                displayArtworks();
                hideUploadForm();
                clearImageSelection();
                cachedArtworksData = null;
                cachedCollectionsData = null;
                updateDashboardStats();

            } catch (error) {
                console.error('Error saving artwork:', error);
                alert('Error saving artwork. Please try again.');
            }
        }

        async function editArtwork(artworkId) {
            console.log("ðŸ” [DEBUG] editArtwork called with ID:", artworkId);

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                console.log("ðŸ” [DEBUG] User:", user?.id);

                if (!user) {
                    console.log("âŒ [DEBUG] No user found");
                    return;
                }

                // Fetch artwork data
                console.log("ðŸ” [DEBUG] Fetching artwork from Supabase...");
                const { data: artwork, error } = await supabaseClient
                    .from('artworks')
                    .select('*')
                    .eq('id', artworkId)
                    .eq('artist_id', user.id)
                    .single();

                console.log("ðŸ” [DEBUG] Artwork data:", artwork);
                console.log("ðŸ” [DEBUG] Error:", error);

                if (error) {
                    console.log("âŒ [DEBUG] Supabase error:", error);
                    throw error;
                }

                if (!artwork) {
                    console.log("âŒ [DEBUG] No artwork found");
                    throw new Error('Artwork not found');
                }

                console.log("ðŸ” [DEBUG] Calling showUploadForm with artwork data");
                // Show upload form with artwork data pre-filled
                showUploadForm(artwork);

                console.log("âœ… [DEBUG] editArtwork completed successfully");

            } catch (error) {
                console.error("âŒ [DEBUG] Error in editArtwork:", error);
                alert('Error loading artwork for editing: ' + error.message);
            }
        }

        async function archiveOrDeleteArtwork(artworkId) {
            // Create custom dialog
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;

            dialog.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 400px; width: 90%;">
                    <h3 style="margin: 0 0 1rem 0;">Artwork Action</h3>
                    <p style="margin: 0 0 2rem 0; color: #666;">Choose what to do with this artwork:</p>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button id="cancelAction" style="background: none; border: 1px solid #d1d1d1; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">Cancel</button>
                        <button id="archiveAction" style="background: #666; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">Archive</button>
                        <button id="deleteAction" style="background: #ff4444; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">Delete</button>
                    </div>
                </div>
            `;

            document.body.appendChild(dialog);

            // Wait for user choice
            return new Promise((resolve) => {
                dialog.querySelector('#cancelAction').onclick = () => {
                    document.body.removeChild(dialog);
                    resolve('cancel');
                };

                dialog.querySelector('#archiveAction').onclick = () => {
                    document.body.removeChild(dialog);
                    resolve('archive');
                };

                dialog.querySelector('#deleteAction').onclick = () => {
                    document.body.removeChild(dialog);
                    resolve('delete');
                };
            }).then(async (action) => {
                if (action === 'cancel') return;

                try {
                    const { data: { user } } = await supabaseClient.auth.getUser();

                    if (action === 'delete') {
                        // DELETE PERMANENTLY
                        const { error } = await supabaseClient
                            .from('artworks')
                            .delete()
                            .eq('id', artworkId)
                            .eq('artist_id', user.id);

                        if (error) throw error;
                        alert('Artwork permanently deleted!');

                        await logActivity(
                            ACTIVITY_TYPES.ARTWORK_DELETE,
                            'Deleted artwork',
                            `Permanently deleted artwork`,
                            { artwork_id: artworkId }
                        );

                    } else if (action === 'archive') {
                        // ARCHIVE
                        const { error } = await supabaseClient
                            .from('artworks')
                            .update({ is_archived: true })
                            .eq('id', artworkId)
                            .eq('artist_id', user.id);

                        if (error) throw error;
                        alert('Artwork archived! It is hidden but can be restored later.');

                        await logActivity(
                            ACTIVITY_TYPES.ARTWORK_ARCHIVE,
                            'Archived artwork', 
                            `Archived artwork - hidden from main collection`,
                            { artwork_id: artworkId }
                        );
                    }

                    // Refresh data
                    cachedArtworksData = null;
                    cachedCollectionsData = null;
                    fetchUserArtworks();
                    if (document.getElementById('portfolio-section').style.display === 'block') {
                        loadPortfolio();
                    }

                } catch (error) {
                    console.error('Error:', error);
                    alert('Error processing artwork');
                }
            });
        }

        // Delete collection
        async function deleteCollection(collectionId) {
            if (!confirm('Delete this collection? (Artworks will not be deleted)')) return;

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();

                // First remove artwork links
                const { error: linkError } = await supabaseClient
                    .from('artwork_collections')
                    .delete()
                    .eq('collection_id', collectionId);

                if (linkError) throw linkError;

                // Then delete collection
                const { error } = await supabaseClient
                    .from('collections')
                    .delete()
                    .eq('id', collectionId)
                    .eq('artist_id', user.id);

                if (error) throw error;

                alert('Collection deleted!');
                // Log activity  
                await logActivity(
                    ACTIVITY_TYPES.COLLECTION_DELETE,
                    'Deleted collection',
                    `Deleted collection`,
                    { collection_id: collectionId }
                );
                cachedCollectionsData = null; // Clear cache

            } catch (error) {
                console.error('Error deleting collection:', error);
                alert('Error deleting collection');
            }
        }

        // Events Functions
        function showAddEventForm() {
            document.getElementById('addEventPopup').style.display = 'flex';
            // Set default date to today
            document.getElementById('eventDate').valueAsDate = new Date();
        }

        function hideAddEventForm() {
            document.getElementById('addEventPopup').style.display = 'none';
            document.getElementById('eventForm').reset();
        }

        function showArtworkPopup() {
            document.getElementById('artworkPopup').style.display = 'flex';
        }

        function hideArtworkPopup() {
            document.getElementById('artworkPopup').style.display = 'none';
            document.getElementById('artworkUploadForm').reset();
            clearImageSelection();
        }

        async function createEvent(event) {
            event.preventDefault();

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) throw new Error('Not authenticated');

                const formData = new FormData(event.target);
                const title = formData.get('title');
                const eventType = formData.get('eventType');
                const eventDate = formData.get('eventDate');
                const eventTime = formData.get('eventTime');
                const location = formData.get('location');
                const description = formData.get('description');
                const isPublic = formData.get('isPublic') === 'on';

                if (!title || !eventDate) {
                    alert('Please fill in required fields');
                    return;
                }

                let imageUrl = null;
                let imagePath = null;

                // Upload event image if selected
                if (selectedEventImageFile) {
                    const imageName = `${user.id}/events/${Date.now()}_${selectedEventImageFile.name}`;
                    const { data: imageData, error: uploadError } = await supabaseClient.storage
                        .from('artwork-images')
                        .upload(imageName, selectedEventImageFile);

                    if (uploadError) throw uploadError;

                    // Get public URL for the image
                    const { data: { publicUrl } } = supabaseClient.storage
                        .from('artwork-images')
                        .getPublicUrl(imageData.path);

                    imageUrl = publicUrl;
                    imagePath = imageData.path;
                }

                const eventData = {
                    artist_id: user.id,
                    title: title,
                    event_type: eventType,
                    event_date: eventDate,
                    event_time: eventTime || null,
                    location: location || '',
                    description: description || '',
                    is_public: isPublic,
                    image_url: imageUrl,
                    image_path: imagePath
                };

                const { data, error } = await supabaseClient
                    .from('events')
                    .insert([eventData])
                    .select();

                if (error) throw error;

                // Log activity
                await logActivity(
                    'event_create',
                    'Added new event',
                    `Created "${title}" event`,
                    { event_id: data[0].id }
                );

                alert('âœ… Event added!');
                hideAddEventForm();
                clearEventImageSelection();
                loadEvents();

                // Refresh portfolio if it's open
                if (document.getElementById('portfolio-section').style.display === 'block') {
                    loadPortfolio();
                }

            } catch (error) {
                console.error('Error creating event:', error);
                alert('Error creating event: ' + error.message);
            }
        }

        async function loadEvents() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const { data: events, error } = await supabaseClient
                    .from('events')
                    .select('*')
                    .eq('artist_id', user.id)
                    .gte('event_date', new Date().toISOString().split('T')[0]) // Only future events
                    .order('event_date', { ascending: true })
                    .limit(10);

                if (error) throw error;

                displayEvents(events || []);

            } catch (error) {
                console.error('Error loading events:', error);
            }
        }

        function displayEvents(events) {
            const container = document.getElementById('eventsGrid');

            if (!events || events.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
    <div class="empty-icon">
        <svg width="80" height="80" viewBox="0 0 80 80" style="margin-bottom: 1.5rem;">
            <rect x="15" y="15" width="50" height="35" fill="none" stroke="#ddd" stroke-width="1.5"/>
            <rect x="20" y="55" width="40" height="15" fill="none" stroke="#ddd" stroke-width="1"/>
            <line x1="30" y1="20" x2="50" y2="20" stroke="#ddd" stroke-width="1"/>
            <line x1="30" y1="25" x2="50" y2="25" stroke="#ddd" stroke-width="1"/>
        </svg>
    </div>
    <h4>No upcoming events</h4>
    <p>Add exhibitions, shows, or important dates to track your artistic calendar</p>
    <button class="cta-button" onclick="showAddEventForm()">Add Your First Event</button>
</div>
                `;
                return;
            }

            container.innerHTML = events.map(event => {
                const eventDate = new Date(event.event_date);
                const formattedDate = eventDate.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric' 
                });

                const eventTime = event.event_time ? ` â€¢ ${event.event_time}` : '';

                return `
                    <div class="event-card">
                        <div class="event-date">${formattedDate}${eventTime}</div>
                        <div class="event-title">${event.title}</div>
                        ${event.location ? `<div class="event-location">ðŸ“ ${event.location}</div>` : ''}
                        ${event.description ? `<div class="event-description">${event.description}</div>` : ''}
                        <div class="event-actions">
                            <button onclick="editEvent('${event.id}')" class="btn-secondary" style="font-size: 0.7rem; padding: 0.25rem 0.5rem;">Edit</button>
                            <button onclick="deleteEvent('${event.id}')" class="delete-btn" style="color: #ccc; text-decoration: underline; background: none; border: none; cursor: pointer; font-size: 0.7rem; padding: 0; white-space: nowrap;">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Placeholder functions for edit/delete
        async function editEvent(eventId) {
            alert('Edit event functionality coming soon!');
        }

        async function deleteEvent(eventId) {
            if (!confirm('Delete this event?')) return;

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                const { error } = await supabaseClient
                    .from('events')
                    .delete()
                    .eq('id', eventId)
                    .eq('artist_id', user.id);

                if (error) throw error;

                alert('Event deleted!');
                loadEvents();

            } catch (error) {
                console.error('Error deleting event:', error);
                alert('Error deleting event');
            }
        }

        // Toggle collection privacy
        async function toggleCollectionPrivacy(collectionId, currentStatus) {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                const { error } = await supabaseClient
                    .from('collections')
                    .update({ is_public: !currentStatus })
                    .eq('id', collectionId)
                    .eq('artist_id', user.id);

                if (error) throw error;

                fetchUserCollections();
                cachedCollectionsData = null; // Clear cache

            } catch (error) {
                console.error('Error updating collection privacy:', error);
            }
        }

        async function fetchUserArtworks() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const { data, error } = await supabaseClient
                    .from('artworks')
                    .select('*')
                    .eq('artist_id', user.id)
                    .eq('is_archived', false)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                currentArtworks = data || [];
                displayArtworks();
                updateDashboardStats();

            } catch (error) {
                console.error('Error fetching artworks:', error);
            }
        }

        async function fetchArchivedArtworks() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const { data, error } = await supabaseClient
                    .from('artworks')
                    .select('*')
                    .eq('artist_id', user.id)
                    .eq('is_archived', true)
                    .order('created_at', { ascending: false });

                if (error) throw error;
                displayArchivedArtworks(data || []);

            } catch (error) {
                console.error('Error fetching archived artworks:', error);
            }
        }

        function displayArchivedArtworks(archivedArtworks) {
            const grid = document.getElementById('archivedArtworksGrid');

            if (archivedArtworks.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ðŸ“¦</div>
                        <h4>No archived artworks</h4>
                        <p>Archived works are hidden from your main collection but preserved.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = archivedArtworks.map(artwork => `
                <div class="artwork-card" style="opacity: 0.8;">
                    <div class="artwork-image">
                        <img src="${artwork.image_url}" alt="${artwork.title}">
                    </div>
                    <div class="artwork-info">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <h4 class="artwork-title">${artwork.title || 'Untitled'}</h4>
                                <div class="artwork-details">
                                    ${artwork.year ? `<div>${artwork.year}</div>` : ''}
                                    ${artwork.medium ? `<div>${artwork.medium}</div>` : ''}
                                    ${artwork.dimensions ? `<div>${artwork.dimensions}</div>` : ''}
                                </div>
                            </div>
                            <div class="artwork-actions" style="margin-left: 1rem; display: flex; flex-direction: column; gap: 0.5rem;">
                                <button onclick="restoreArtwork('${artwork.id}')" style="color: #4CAF50; text-decoration: underline; background: none; border: none; cursor: pointer; font-size: 0.7rem; white-space: nowrap;">Restore</button>
                                <button onclick="permanentlyDeleteArtwork('${artwork.id}')" class="delete-btn" style="color: #ccc; text-decoration: underline; background: none; border: none; cursor: pointer; font-size: 0.7rem; white-space: nowrap;">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function restoreArtwork(artworkId) {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();

                const { error } = await supabaseClient
                    .from('artworks')
                    .update({ is_archived: false })
                    .eq('id', artworkId)
                    .eq('artist_id', user.id);

                if (error) throw error;

                alert('Artwork restored to your collection!');
                fetchUserArtworks();
                fetchArchivedArtworks();
                cachedArtworksData = null;

                // Log activity
                await logActivity(
                    ACTIVITY_TYPES.ARTWORK_RESTORE,
                    'Restored artwork',
                    `Restored artwork to your collection`,
                    { artwork_id: artworkId }
                );

            } catch (error) {
                console.error('Error restoring artwork:', error);
                alert('Error restoring artwork');
            }
        }

        async function permanentlyDeleteArtwork(artworkId) {
            if (!confirm('Permanently delete this artwork? This cannot be undone.')) return;

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();

                const { error } = await supabaseClient
                    .from('artworks')
                    .delete()
                    .eq('id', artworkId)
                    .eq('artist_id', user.id);

                if (error) throw error;

                alert('Artwork permanently deleted!');
                fetchArchivedArtworks();

            } catch (error) {
                console.error('Error deleting artwork:', error);
                alert('Error deleting artwork');
            }
        }
        
        function displayArtworks() {
            const grid = document.getElementById('artworksGrid');

            if (currentArtworks.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
    <div class="empty-icon">
        <svg width="80" height="80" viewBox="0 0 80 80" style="margin-bottom: 1.5rem;">
            <rect x="10" y="10" width="60" height="60" fill="none" stroke="#ddd" stroke-width="1.5"/>
            <line x1="25" y1="25" x2="55" y2="55" stroke="#ddd" stroke-width="1"/>
            <line x1="55" y1="25" x2="25" y2="55" stroke="#ddd" stroke-width="1"/>
        </svg>
    </div>
    <h4>No artworks yet</h4>
    <p>Add your first artwork to start building your archive</p>
    <button class="cta-button" onclick="showUploadForm()">Upload Your First Piece</button>
</div>
                `;
                return;
            }

            grid.innerHTML = `<div class="artworks-grid large">` + currentArtworks.map(artwork => `
                <div class="artwork-card">
                    <div class="artwork-image">
                        <img src="${artwork.image_url}" alt="${artwork.title}">
                    </div>
                    <div class="artwork-info">
                        <div class="artwork-content-container">
    <div class="artwork-text-content">
        <h4 class="artwork-title">${artwork.title || 'Untitled'}</h4>
        <div class="artwork-details">
            ${artwork.year ? `<div>${artwork.year}</div>` : ''}
            ${artwork.medium ? `<div>${artwork.medium}</div>` : ''}
            ${artwork.dimensions ? `<div>${artwork.dimensions}</div>` : ''}
            ${artwork.description ? `<div class="artwork-description">${artwork.description}</div>` : ''}
        </div>
    </div>
    <div class="artwork-actions" style="display: flex; gap: 0.5rem;">
    <button onclick="editArtwork('${artwork.id}')" class="delete-btn" style="margin: 0;">Edit</button>
    <button onclick="archiveOrDeleteArtwork('${artwork.id}')" class="delete-btn" style="margin: 0;">Delete</button>
</div>
</div>
                    </div>
                </div>
            `).join('') + `</div>`;
        }

        function showArchivedPopup() {
            if (document.getElementById('dashboard-section').style.display === 'block') {
                document.getElementById('archivedPopup').style.display = 'flex';
                fetchArchivedArtworks();
            }
        }

        function hideArchivedPopup() {
            document.getElementById('archivedPopup').style.display = 'none';
        }

        function copyPortfolioLink() {
            const portfolioLinkInput = document.getElementById('portfolioLink');
            if (portfolioLinkInput && portfolioLinkInput.value) {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(portfolioLinkInput.value)
                        .then(() => {
                            alert('âœ… Portfolio link copied to clipboard!');
                        })
                        .catch(err => {
                            console.error('Failed to copy:', err);
                            fallbackCopy();
                        });
                } else {
                    fallbackCopy();
                }
                
                function fallbackCopy() {
                    try {
                        portfolioLinkInput.select();
                        portfolioLinkInput.setSelectionRange(0, 99999);
                        const successful = document.execCommand('copy');
                        if (successful) {
                            alert('âœ… Portfolio link copied to clipboard!');
                        } else {
                            alert('âŒ Copy failed. Please manually select and copy the link.');
                        }
                    } catch (err) {
                        console.error('Fallback copy failed:', err);
                        alert('âŒ Copy failed. Please manually select and copy the link.');
                    }
                }
            } else {
                alert('âŒ No portfolio link to copy. Please save your profile with a username first.');
            }
        }

        function showStyleBrowser() {
            document.getElementById('styleBrowserModal').style.display = 'flex';
            console.log('Style browser opened');
        }

        function hideStyleBrowser() {
            document.getElementById('styleBrowserModal').style.display = 'none';
        }

        function previewStyle(styleId) {
            console.log('Previewing style:', styleId);
            const style = STYLE_PRESETS[styleId];

            if (style) {
                alert(`Preview: ${style.name}\n\nFonts: ${style.fonts.primary} + ${style.fonts.secondary}\nColors: ${style.colors.bg} / ${style.colors.text}\nLayout: ${style.layout}`);
            }
        }

        async function applyStyle(styleId) {
            console.log('Applying style:', styleId);
            const style = STYLE_PRESETS[styleId];

            if (!style) return;

            try {
                // ONLY target portfolio page, not entire body
                const portfolioPage = document.getElementById('portfolioPage');
                if (portfolioPage) {
                    portfolioPage.classList.remove('style-applied');
                    portfolioPage.classList.remove('style-minimal-dark', 'style-gallery-bright', 'style-warm-modern', 'style-bold-minimal');
                    portfolioPage.classList.add('style-applied', `style-${styleId}`);
                }

                // Rest of your existing code...
                alert(`âœ… ${style.name} applied!`);
                hideStyleBrowser();

            } catch (error) {
                console.error('Style application error:', error);
                alert('Error applying style');
            }
        }

        function toggleFavorite(styleId) {
            console.log('Toggling favorite for:', styleId);
            // Using star system like your existing app
            const starBtn = event.target;
            starBtn.textContent = starBtn.textContent === 'â˜†' ? 'â˜…' : 'â˜†';
        }

        function previewStyle(styleId) {
            console.log('Previewing style:', styleId);
            // Will implement preview later
        }

        function toggleFavorite(styleId) {
            console.log('Toggling favorite for:', styleId);
            // Will implement favorites later
        }

        function previewStyle(styleId) {
            console.log('Previewing style:', styleId);
            alert('Preview for ' + styleId + ' - functionality coming soon!');
        }

        function toggleFavorite(styleId) {
            console.log('Toggling favorite for:', styleId);
            // Using star system like your existing app
            const starBtn = event.target;
            starBtn.textContent = starBtn.textContent === 'â˜†' ? 'â˜…' : 'â˜†';
        }

        // PROFILE SETTINGS FUNCTIONS
        function addSocialPlatform(platform = '', username = '') {
            const container = document.getElementById('socialPlatformsContainer');

            // Remove empty message if it exists when adding a platform
            if (container.innerHTML.includes('No social platforms')) {
                container.innerHTML = '';
            }

            const platformId = Date.now();

            const platformHtml = `
                <div class="social-platform-item" id="platform-${platformId}">
                    <div class="form-grid" style="grid-template-columns: 1fr 2fr auto; gap: 1rem; align-items: end;">
                        <div class="form-group">
                            <label>Platform</label>
                            <select class="platform-select" onchange="updatePlatformExample(this)">
                                <option value="">Select platform...</option>
                                ${availablePlatforms.map(p => `<option value="${p}" ${p === platform ? 'selected' : ''}>${p.charAt(0).toUpperCase() + p.slice(1)}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="platform-username-label">Username</label>
                            <input type="text" class="platform-username" value="${username}" placeholder="yourusername">
                        </div>
                        <div class="form-group">
                            <button type="button" onclick="removeSocialPlatform('${platformId}')" class="delete-btn" style="color: #ccc; text-decoration: underline; background: none; border: none; cursor: pointer; font-size: 0.7rem; padding: 0; white-space: nowrap;">Remove</button>
                        </div>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', platformHtml);

            // If a platform was pre-selected, update its example placeholder
            if (platform) {
                const select = container.querySelector(`#platform-${platformId} .platform-select`);
                updatePlatformExample(select);
            }
        }

        function updatePlatformExample(select) {
            const platform = select.value;
            const input = select.closest('.social-platform-item').querySelector('.platform-username');
            const label = select.closest('.social-platform-item').querySelector('.platform-username-label');

            if (platform === 'instagram') input.placeholder = 'yourusername';
            else if (platform === 'arena') input.placeholder = 'your-channel';
            else if (platform === 'substack') input.placeholder = 'your-publication';
            else if (platform === 'upscrolled') input.placeholder = 'your-profile';
            else input.placeholder = 'yourusername';

            label.textContent = platform ? `${platform.charAt(0).toUpperCase() + platform.slice(1)} Username` : 'Username';
        }

        function removeSocialPlatform(id) {
            const element = document.getElementById(`platform-${id}`);
            if (element) element.remove();

            // Check if no platforms left, show empty message
            const container = document.getElementById('socialPlatformsContainer');
            if (container.children.length === 0) {
                container.innerHTML = '<p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">No social platforms added yet</p>';
            }
        }

        function loadSocialPlatforms(socialData) {
            const container = document.getElementById('socialPlatformsContainer');

            // SAFE CLEAR: Only clear the platforms container to prevent duplicates
            container.innerHTML = '';

            if (socialData) {
                const platforms = socialData.split('\n').filter(line => line.trim());
                platforms.forEach(line => {
                    const [platform, ...usernameParts] = line.split(':');
                    if (platform && usernameParts.length) {
                        const username = usernameParts.join(':').trim();
                        addSocialPlatform(platform.trim(), username);
                    }
                });
            }

            // If no platforms after loading, show empty state
            if (container.children.length === 0) {
                container.innerHTML = '<p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">No social platforms added yet</p>';
            }
        }

        function getSocialPlatformsData() {
            const items = document.querySelectorAll('.social-platform-item');
            const platforms = [];

            items.forEach(item => {
                const platform = item.querySelector('.platform-select').value;
                const username = item.querySelector('.platform-username').value.trim();
                if (platform && username) {
                    platforms.push(`${platform}:${username}`);
                }
            });

            return platforms.join('\n');
        }

        function displaySocialIcons(socialLinks) {
            if (!socialLinks) return '';

            const platforms = socialLinks.split('\n').filter(line => line.trim());
            let html = '<div style="display: flex; gap: 1.5rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;">';

            platforms.forEach(line => {
                const [platform, ...usernameParts] = line.split(':');
                const username = usernameParts.join(':').trim();
                if (platform && username && socialIcons[platform]) {
                    const profileUrl = getSocialProfileUrl(platform, username);
                    html += `<a href="${profileUrl}" target="_blank" style="color: #000; text-decoration: none; transition: opacity 0.2s;" title="${platform}: ${username}" onmouseover="this.style.opacity='0.7'" onmouseout="this.style.opacity='1'">${socialIcons[platform]}</a>`;
                }
            });

            html += '</div>';
            return html;
        }

        function getSocialProfileUrl(platform, username) {
            const urls = {
                instagram: `https://instagram.com/${username}`,
                twitter: `https://twitter.com/${username}`,
                tiktok: `https://tiktok.com/@${username}`,
                linkedin: `https://linkedin.com/in/${username}`,
                facebook: `https://facebook.com/${username}`,
                youtube: `https://youtube.com/${username}`,
                github: `https://github.com/${username}`,
                discord: `https://discord.gg/${username}`,
                patreon: `https://patreon.com/${username}`,
                substack: `https://${username}.substack.com`,
                arena: `https://are.na/${username}`,
                threads: `https://threads.net/@${username}`,
                bluesky: `https://bsky.app/profile/${username}`,
                vimeo: `https://vimeo.com/${username}`,
                spotify: `https://open.spotify.com/user/${username}`,
                upscrolled: `https://upscrolled.com/${username}`
            };
            return urls[platform] || '#';
        }

        async function loadProfileData() {
            console.log("ðŸ” [DEBUG] loadProfileData STARTED");

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                console.log("ðŸ” [DEBUG] Got user:", user?.id);

                if (!user) {
                    showSection('login');
                    return;
                }

                loadCollectionsInProfile();

                // Fetch profile data
                console.log("ðŸ” [DEBUG] Before Supabase query");
                const { data: profile, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', user.id)
                    .single();
                console.log("ðŸ” [DEBUG] After Supabase query");

                console.log("ðŸ” [DEBUG] Profile data:", profile); // â† ADD THIS
                console.log("ðŸ” [DEBUG] Error:", error); // â† ADD THIS

                if (error) {
                    console.log("ðŸ” [DEBUG] Profile doesn't exist, creating default...");
                    // Create default profile
                    const { data: newProfile, error: createError } = await supabaseClient
                        .from('profiles')
                        .insert([{ 
                            id: user.id,
                            username: user.email.split('@')[0],
                            full_name: user.user_metadata?.full_name || '',
                            created_at: new Date().toISOString()
                        }])
                        .select()
                        .single();

                    if (createError) throw createError;

                    console.log("ðŸ” [DEBUG] Created default profile:", newProfile);
                    // Now populate form with the new profile
                    profile = newProfile;
                }

                // Populate form with existing data
                if (profile) {
                    console.log("ðŸ” [DEBUG] Populating form with profile data");
                    document.getElementById('username').value = profile.username || '';
                    document.getElementById('portfolioLink').value = window.location.origin + '/#/trac/' + (profile.username || '');
                    document.getElementById('profileFullName').value = profile.full_name || '';
                    document.getElementById('bio').value = profile.bio || '';
                    document.getElementById('website').value = profile.website || '';
                    document.getElementById('contactEmail').value = profile.contact_email || '';

                    // Show current profile photo
                    if (profile.profile_photo_url) {
                        document.getElementById('profilePhotoPreview').innerHTML = `
                            <img src="${profile.profile_photo_url}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;" alt="Current profile photo">
                            <div style="color: green; font-size: 0.8rem; margin-top: 0.5rem;">âœ“ Profile photo uploaded</div>
                        `;
                    }

                    // Show current CV status
                    if (profile.has_cv) {
                        document.getElementById('cvCurrentFile').innerHTML = `
                            <span style="color: green;">âœ“ CV uploaded and stored</span>
                            <br><small style="color: #666;">CV button will appear in portfolio header</small>
                        `;
                    } else {
                        document.getElementById('cvCurrentFile').innerHTML = '<span style="color: #666;">No CV uploaded yet</span>';
                    }

                    // Load social platforms
                    if (profile.social_links) {
                        loadSocialPlatforms(profile.social_links);
                    }

                    if (profile.image_size) {
                        document.querySelector(`input[name="imageSize"][value="${profile.image_size}"]`).checked = true;
                    } else {
                        document.querySelector('input[name="imageSize"][value="medium"]').checked = true;
                    }

                    console.log("âœ… [DEBUG] Form populated successfully");
                } else {
                    console.log("âŒ [DEBUG] No profile data available");
                }

            } catch (error) {
                console.error("ðŸ’¥ [DEBUG] loadProfileData ERROR:", error);
                alert('Error loading profile data');
                
            }
        }

        // Add this function to edit collections
        async function editCollection(collectionId) {
            console.log("ðŸ” [DEBUG] editCollection called with ID:", collectionId);

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                console.log("ðŸ” [DEBUG] User:", user?.id);

                if (!user) {
                    console.log("âŒ [DEBUG] No user found");
                    return;
                }

                // Fetch collection data
                console.log("ðŸ” [DEBUG] Fetching collection data...");
                const { data: collection, error } = await supabaseClient
                    .from('collections')
                    .select(`
                        *,
                        artwork_collections (
                            artwork_id
                        )
                    `)
                    .eq('id', collectionId)
                    .eq('artist_id', user.id)
                    .single();

                console.log("ðŸ” [DEBUG] Collection data:", collection);
                console.log("ðŸ” [DEBUG] Collection error:", error);

                if (error) {
                    console.log("âŒ [DEBUG] Supabase error:", error);
                    throw error;
                }

                if (!collection) {
                    console.log("âŒ [DEBUG] No collection found");
                    throw new Error('Collection not found');
                }

                // Populate the form with existing data
                console.log("ðŸ” [DEBUG] Populating form...");
                document.getElementById('collectionTitle').value = collection.name;
                document.getElementById('collectionStatement').value = collection.description || '';

                // Load artworks and pre-select current ones
                console.log("ðŸ” [DEBUG] Loading artworks for edit...");
                await loadAvailableArtworks(collection.artwork_collections || []);

                // Change form to edit mode
                console.log("ðŸ” [DEBUG] Switching to edit mode...");
                document.getElementById('collectionForm').dataset.mode = 'edit';
                document.getElementById('collectionForm').dataset.collectionId = collectionId;
                document.querySelector('#createCollectionForm .form-header h4').textContent = 'Edit Collection';

                document.querySelector('#collectionForm button[type="submit"]').textContent = 'Update Collection';

                console.log("ðŸ” [DEBUG] Showing form...");
                showCreateCollectionForm();

                console.log("âœ… [DEBUG] Edit collection flow completed");

            } catch (error) {
                console.error("âŒ [DEBUG] Error in editCollection:", error);
                alert('Error loading collection for editing: ' + error.message);
            }
        }

        async function saveProfile(event) {
            event.preventDefault();

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) throw new Error('Not authenticated');

                const cvFileInput = document.getElementById('cvUpload');
                const cvFile = cvFileInput.files[0];
                let cvUrl = null;
                let hasCV = false;

                // Handle CV file upload if a new file is selected
                if (cvFile) {
                    console.log("ðŸ“„ Uploading CV file:", cvFile.name);

                    // Validate file type
                    const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
                    if (!allowedTypes.includes(cvFile.type)) {
                        alert('âŒ Please upload a PDF, DOC, or DOCX file for your CV.');
                        return;
                    }

                    // Validate file size (5MB max)
                    if (cvFile.size > 5 * 1024 * 1024) {
                        alert('âŒ CV file must be smaller than 5MB.');
                        return;
                    }

                    // Upload to Supabase Storage
                    const cvFileName = `${user.id}/cv_${Date.now()}_${cvFile.name}`;
                    const { data: cvData, error: cvError } = await supabaseClient.storage
                        .from('cv-files')
                        .upload(cvFileName, cvFile);

                    if (cvError) {
                        console.error('CV upload error:', cvError);
                        throw new Error('Failed to upload CV: ' + cvError.message);
                    }

                    // Get public URL for artist reference
                    const { data: { publicUrl } } = supabaseClient.storage
                        .from('cv-files')
                        .getPublicUrl(cvData.path);

                    cvUrl = publicUrl;
                    hasCV = true;
                    console.log("âœ… CV uploaded successfully");
                } else {
                    // No new CV file - check existing CV status
                    const { data: currentProfile } = await supabaseClient
                        .from('profiles')
                        .select('has_cv, cv_url')
                        .eq('id', user.id)
                        .single();

                    hasCV = currentProfile?.has_cv || false;
                    cvUrl = currentProfile?.cv_url || null;
                }

                // ADD PROFILE PHOTO UPLOAD RIGHT HERE:
                const profilePhotoFileInput = document.getElementById('profilePhoto');
                const profilePhotoFile = profilePhotoFileInput.files[0];
                let profilePhotoUrl = null;
                let hasProfilePhoto = false;

                // Handle profile photo upload if a new file is selected
                if (profilePhotoFile) {
                    console.log("ðŸ–¼ï¸ Uploading profile photo:", profilePhotoFile.name);

                    // Validate file type
                    if (!profilePhotoFile.type.startsWith('image/')) {
                        alert('âŒ Please select an image file for your profile photo.');
                        return;
                    }

                    // Validate file size (5MB max)
                    if (profilePhotoFile.size > 5 * 1024 * 1024) {
                        alert('âŒ Profile photo must be smaller than 5MB.');
                        return;
                    }

                    // Upload to Supabase Storage
                    const profilePhotoName = `${user.id}/profile_photo_${Date.now()}_${profilePhotoFile.name}`;
                    const { data: photoData, error: photoError } = await supabaseClient.storage
                        .from('artwork-images')  // Using same bucket as artworks
                        .upload(profilePhotoName, profilePhotoFile);

                    if (photoError) {
                        console.error('Profile photo upload error:', photoError);
                        throw new Error('Failed to upload profile photo: ' + photoError.message);
                    }

                    // Get public URL
                    const { data: { publicUrl } } = supabaseClient.storage
                        .from('artwork-images')
                        .getPublicUrl(photoData.path);

                    profilePhotoUrl = publicUrl;
                    hasProfilePhoto = true;
                    console.log("âœ… Profile photo uploaded successfully");
                } else {
                    // No new profile photo - check existing photo status
                    const { data: currentProfile } = await supabaseClient
                        .from('profiles')
                        .select('has_profile_photo, profile_photo_url')
                        .eq('id', user.id)
                        .single();

                    hasProfilePhoto = currentProfile?.has_profile_photo || false;
                    profilePhotoUrl = currentProfile?.profile_photo_url || null;
                }

                console.log("ðŸ” SOCIAL DATA SAVING:", getSocialPlatformsData());

                const profileData = {
                    username: document.getElementById('username').value,
                    full_name: document.getElementById('profileFullName').value,
                    bio: document.getElementById('bio').value,
                    website: document.getElementById('website').value,
                    contact_email: document.getElementById('contactEmail').value,
                    social_links: getSocialPlatformsData(),
                    has_cv: hasCV,
                    cv_url: cvUrl,
                    has_profile_photo: hasProfilePhoto,
                    profile_photo_url: profilePhotoUrl,
                    image_size: document.querySelector('input[name="imageSize"]:checked').value
                };

                const { error } = await supabaseClient
                    .from('profiles')
                    .upsert({ 
                        id: user.id,
                        ...profileData
                    });

                if (error) throw error;

                alert('âœ… Profile saved successfully!' + (cvFile ? ' CV uploaded.' : ''));
                // Log activity
                await logActivity(
                    ACTIVITY_TYPES.PROFILE_UPDATE,
                    'Updated profile',
                    'Modified profile information'
                );

                // Clear cache to force refresh
                cachedPortfolioData = null;

                // Update CV status display
                if (hasCV) {
                    document.getElementById('cvCurrentFile').innerHTML = `
                        <span style="color: green;">âœ“ CV uploaded and stored</span>
                        <br><small style="color: #666;">CV button will appear in portfolio header</small>
                    `;
                } else {
                    document.getElementById('cvCurrentFile').innerHTML = '<span style="color: #666;">No CV uploaded yet</span>';
                }

                // Reload portfolio if it's currently visible
                if (document.getElementById('portfolio-section').style.display === 'block') {
                    loadPortfolio();
                }

            } catch (error) {
                console.error('Error saving profile:', error);
                alert('Error saving profile: ' + error.message);
            }
        }

        // Image Upload Functions
        let selectedImageFile = null;

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageFile(files[0]);
            }
        }

        function showImageUpload() {
            document.getElementById('uploadZone').style.display = 'block';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imagePreview').innerHTML = '';
        }

        function handleImageSelect(e) {
            if (e.target.files.length > 0) {
                handleImageFile(e.target.files[0]);
            }
        }

        function handleImageFile(file) {
            // Validate file type and size
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file (JPG, PNG, WebP)');
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                alert('Image must be smaller than 5MB');
                return;
            }

            selectedImageFile = file;

            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('uploadPlaceholder').style.display = 'none';
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('imagePreview').innerHTML = `
                    <img src="${e.target.result}" alt="Preview" style="max-width: 100%; max-height: 300px; border-radius: 0;">
                    <div style="margin-top: 1rem; font-size: 0.8rem; color: #666;">
                        ${file.name} (${Math.round(file.size / 1024)}KB)
                        <button type="button" onclick="clearImageSelection()" style="margin-left: 1rem; color: #ff4444; background: none; border: none; cursor: pointer;">
                            Remove
                        </button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

            function togglePassword(inputId) {
                const input = document.getElementById(inputId);
                const button = input.nextElementSibling;
                const svg = button.querySelector('svg');

                if (input.type === 'password') {
                    input.type = 'text';
                    svg.innerHTML = `
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                        <line x1="1" y1="1" x2="23" y2="23"></line>
                    `;
                } else {
                    input.type = 'password';
                    svg.innerHTML = `
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    `;
                }
            }
        
        // Collection Management
        let currentCollections = [];

        // Show/hide collection form
        function showCreateCollectionForm() {
            document.getElementById('createCollectionForm').style.display = 'block';
            loadAvailableArtworks(); // â† This one loads the artworks!
        }

        function hideCreateCollectionForm() {
            document.getElementById('createCollectionForm').style.display = 'none';
            document.getElementById('collectionForm').reset();
            document.querySelector('#createCollectionForm .form-header h4').textContent = 'Create New Collection';
            document.querySelector('#createCollectionForm .btn-primary').textContent = 'Create Collection';
            }
        
        // Load artworks for collection selection
        async function loadAvailableArtworks(currentArtworkIds = []) {
            console.log("ðŸ” [DEBUG] Starting loadAvailableArtworks");
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                console.log("ðŸ” [DEBUG] User:", user?.id);

                const { data: artworks, error } = await supabaseClient
                    .from('artworks')
                    .select('id, title')
                    .eq('artist_id', user.id)
                    .order('created_at', { ascending: false });

                console.log("ðŸ” [DEBUG] Artworks fetched:", artworks);
                console.log("ðŸ” [DEBUG] Error:", error);

                if (error) throw error;

                const container = document.getElementById('availableArtworks');
                console.log("ðŸ” [DEBUG] Container element:", container);

                container.innerHTML = artworks.map(artwork => {
                    const isSelected = currentArtworkIds.some(item => item.artwork_id === artwork.id);
                    return `
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; font-size: 0.8rem;">
                            <input type="checkbox" name="artworkIds" value="${artwork.id}" ${isSelected ? 'checked' : ''}>
                            ${artwork.title || 'Untitled'}
                        </label>
                    `;
                }).join('');

                console.log("âœ… [DEBUG] Artworks loaded into form");

            } catch (error) {
                console.error("âŒ [DEBUG] Error loading artworks:", error);
            }
        }

        // Create new collection
        async function createCollection(event) {
            event.preventDefault();

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) throw new Error('Not authenticated');

                const formData = new FormData(event.target);
                const title = formData.get('name');
                const statement = formData.get('statement');
                const artworkIds = formData.getAll('artworkIds');
                const isEdit = event.target.dataset.mode === 'edit';
                const collectionId = event.target.dataset.collectionId;

                if (!title) {
                    alert('Please enter a collection title');
                    return;
                }

                if (isEdit) {
                    // UPDATE EXISTING COLLECTION
                    const { error: updateError } = await supabaseClient
                        .from('collections')
                        .update({
                            name: title,
                            description: statement
                        })
                        .eq('id', collectionId)
                        .eq('artist_id', user.id);

                    if (updateError) throw updateError;

                    // Update artwork connections
                    const { error: deleteError } = await supabaseClient
                        .from('artwork_collections')
                        .delete()
                        .eq('collection_id', collectionId);

                    if (deleteError) throw deleteError;

                    // Add new connections
                    if (artworkIds.length > 0) {
                        const collectionArtworks = artworkIds.map(artworkId => ({
                            collection_id: collectionId,
                            artwork_id: artworkId
                        }));

                        const { error: linkError } = await supabaseClient
                            .from('artwork_collections')
                            .insert(collectionArtworks);

                        if (linkError) throw linkError;
                    }

                    alert('âœ… Collection updated!');

                } else {
                    // CREATE NEW COLLECTION
                    const { data: collection, error: collectionError } = await supabaseClient
                        .from('collections')
                        .insert([{
                            name: title,
                            description: statement,
                            artist_id: user.id,
                            is_public: true
                        }])
                        .select()
                        .single();

                    if (collectionError) throw collectionError;

                    // Add artworks to collection
                    if (artworkIds.length > 0) {
                        const collectionArtworks = artworkIds.map(artworkId => ({
                            collection_id: collection.id,
                            artwork_id: artworkId
                        }));

                        const { error: linkError } = await supabaseClient
                            .from('artwork_collections')
                            .insert(collectionArtworks);

                        if (linkError) throw linkError;
                    }

                    alert('âœ… Collection created!');
                }

                hideCreateCollectionForm();
                loadCollectionsInProfile(); // Refresh the collections list
                cachedCollectionsData = null;
                cachedPortfolioData = null;

                if (document.getElementById('portfolio-section').style.display === 'block') {
                    loadPortfolio();
                }

            } catch (error) {
                console.error('Error saving collection:', error);
                alert('Error saving collection: ' + error.message);
            }
        }

        function clearImageSelection() {
            selectedImageFile = null;
            document.getElementById('uploadPlaceholder').style.display = 'block';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('imageInput').value = '';
        }

        // Make upload zone clickable - SAFE VERSION
        document.addEventListener('click', function(e) {
            if (e.target.id === 'uploadZone' || e.target.closest('#uploadZone')) {
                document.getElementById('imageInput').click();
            }
        });

        // Event Image Upload Variables
        let selectedEventImageFile = null;

        // Event Image Upload Functions
        function handleEventDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleEventDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleEventImageFile(files[0]);
            }
        }

        function handleEventImageSelect(e) {
            if (e.target.files.length > 0) {
                handleEventImageFile(e.target.files[0]);
            }
        }

        function handleEventImageFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file (JPG, PNG, WebP)');
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                alert('Image must be smaller than 5MB');
                return;
            }

            selectedEventImageFile = file;

            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('eventUploadPlaceholder').style.display = 'none';
                document.getElementById('eventImagePreview').style.display = 'block';
                document.getElementById('eventImagePreview').innerHTML = `
                    <img src="${e.target.result}" alt="Preview" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                    <div style="margin-top: 1rem; font-size: 0.8rem; color: #666;">
                        ${file.name} (${Math.round(file.size / 1024)}KB)
                        <button type="button" onclick="clearEventImageSelection()" style="margin-left: 1rem; color: #ff4444; background: none; border: none; cursor: pointer;">
                            Remove
                        </button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function clearEventImageSelection() {
            selectedEventImageFile = null;
            document.getElementById('eventUploadPlaceholder').style.display = 'block';
            document.getElementById('eventImagePreview').style.display = 'none';
            document.getElementById('eventImagePreview').innerHTML = '';
            document.getElementById('eventImageInput').value = '';
        }

        // Make event upload zone clickable
        document.addEventListener('DOMContentLoaded', function() {
            const eventUploadZone = document.getElementById('eventUploadZone');
            if (eventUploadZone) {
                eventUploadZone.addEventListener('click', function() {
                    document.getElementById('eventImageInput').click();
                });
            }
        });
        
        // PORTFOLIO FUNCTIONS
        async function loadPortfolio() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) {
                    showSection('login');
                    return;
                }

                // Use cached data if available
                if (cachedPortfolioData && cachedArtworksData && cachedCollectionsData && cachedEventsData) {
                    displayPortfolio(cachedPortfolioData, cachedArtworksData, cachedCollectionsData, cachedEventsData);
                    return;
                }

                console.time('Portfolio Load Time');

                // PARALLEL QUERIES - Fetch fresh data all at once
                const [profileResult, artworksResult, collectionsResult, eventsResult] = await Promise.all([
                    supabaseClient
                        .from('profiles')
                        .select('username, full_name, bio, profile_photo_url, has_cv, image_size, social_links')
                        .eq('id', user.id)
                        .single(),

                    supabaseClient
                        .from('artworks')
                        .select('*')
                        .eq('artist_id', user.id)
                        .eq('is_public', true)
                        .order('created_at', { ascending: false }),

                    supabaseClient
                        .from('collections')
                        .select(`
                            *,
                            artwork_collections (
                                artworks (*)
                            )
                        `)
                        .eq('artist_id', user.id)
                        .eq('is_public', true)
                        .order('created_at', { ascending: false }),

                    // ADD EVENTS QUERY HERE:
                    supabaseClient
                        .from('events')
                        .select('*')
                        .eq('artist_id', user.id)
                        .eq('is_public', true)
                        .gte('event_date', new Date().toISOString().split('T')[0]) // Only future events
                        .order('event_date', { ascending: true })
                ]);

                // Handle errors
                if (profileResult.error) throw profileResult.error;
                if (artworksResult.error) throw artworksResult.error;
                if (collectionsResult.error) throw collectionsResult.error;
                if (eventsResult.error) throw eventsResult.error; // ADD THIS LINE

                // Update cache
                cachedPortfolioData = profileResult.data;
                cachedArtworksData = artworksResult.data;
                cachedCollectionsData = collectionsResult.data;
                cachedEventsData = eventsResult.data; // ADD THIS LINE

                console.timeEnd('Portfolio Load Time');

                displayPortfolio(cachedPortfolioData, cachedArtworksData, cachedCollectionsData, cachedEventsData);

            } catch (error) {
                console.error('Error loading portfolio:', error);
                document.getElementById('portfolioPage').innerHTML = `
                    <div style="padding: 2rem; text-align: center;">
                        <h1>Error loading portfolio</h1>
                        <p>Please try again later.</p>
                    </div>
                `;
            }
        }

        async function loadPublicPortfolio(username) {
            try {
                console.log("ðŸ” Loading public profile for:", username);

                // HIDE login section, SHOW portfolio section
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('portfolio-section').style.display = 'block';

                // Show loading state
                document.getElementById('portfolioPage').innerHTML = `
                    <div style="padding: 2rem; text-align: center;">
                        <h1>Loading portfolio...</h1>
                    </div>
                `;

                // Fetch profile by username FIRST
                const { data: profile, error } = await supabaseClient
                    .from('profiles')
                    .select('id, username, full_name, bio, profile_photo_url, has_cv, social_links')
                    .eq('username', username)
                    .single();

                if (error || !profile) {
                    console.error('Profile not found:', error);
                    document.getElementById('portfolioPage').innerHTML = `
                        <div style="padding: 2rem; text-align: center;">
                            <h1>Artist Not Found</h1>
                            <p>The artist "${username}" doesn't exist or hasn't set up their portfolio yet.</p>
                        </div>
                    `;
                    return;
                }

                // NOW fetch artworks using the profile.id we already have
                const { data: artworks, error: artworksError } = await supabaseClient
                    .from('artworks')
                    .select('*')
                    .eq('is_public', true)
                    .eq('artist_id', profile.id)  // Use the profile ID we already fetched
                    .order('created_at', { ascending: false });

                if (artworksError) throw artworksError;

                // Use the same display function but for public view
                displayPortfolio(profile, artworks || []);

            } catch (error) {
                console.error('Error loading public portfolio:', error);
                document.getElementById('portfolioPage').innerHTML = `
                    <div style="padding: 2rem; text-align: center;">
                        <h1>Error loading portfolio</h1>
                        <p>Please try again later.</p>
                    </div>
                `;
            }
        }

        function displayPortfolio(profile, artworks, collections = [], events = []) {
            console.log("ðŸŽ¨ Building clean portfolio layout");

            // Group artworks by collection
            const artworksByCollection = {};
            const standaloneArtworks = [];

            // Separate artworks that belong to collections vs standalone
            artworks.forEach(artwork => {
                let inCollection = false;
                collections.forEach(collection => {
                    if (collection.artwork_collections) {
                        collection.artwork_collections.forEach(item => {
                            if (item.artworks && item.artworks.id === artwork.id) {
                                if (!artworksByCollection[collection.id]) {
                                    artworksByCollection[collection.id] = {
                                        collection: collection,
                                        artworks: []
                                    };
                                }
                                artworksByCollection[collection.id].artworks.push(artwork);
                                inCollection = true;
                            }
                        });
                    }
                });
                if (!inCollection) {
                    standaloneArtworks.push(artwork);
                }
            });

            console.log("ðŸ” SOCIAL LINKS DATA:", profile.social_links);

            const portfolioHTML = `
            <header class="portfolio-header">
                <div class="header-container">
                    <div class="header-left">
                        <div class="artist-name">${profile.full_name || profile.username}</div>
                        <nav class="gallery-nav">
                            <a href="#" class="nav-item" onclick="showSection('dashboard')">Dashboard</a>
                        </nav>
                    </div>
                    <div class="header-right">
                        <nav class="portfolio-nav">
    <a href="#" class="nav-item active" data-tab="works">Works</a>
    <a href="#" class="nav-item" data-tab="profile">Profile</a>
    <a href="#" class="nav-item" data-tab="events">Events</a>
</nav>

                        <!-- CV INDICATOR - RESTORED -->
                        ${profile.has_cv ? `
                            <span style="color: #ccc; font-size: 0.7rem; letter-spacing: 0.1em; cursor: pointer; margin-right: 1rem;" 
                                  onclick="showCVRequestForm()"
                                  title="CV available upon request">
                                CV
                            </span>
                        ` : ''}

                        <button class="icon-button" onclick="signOut()" title="Sign Out">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M6 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V3.33333C2 2.97971 2.14048 2.64057 2.39052 2.39052C2.64057 2.14048 2.97971 2 3.33333 2H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10.6667 11.3333L14 7.99996L10.6667 4.66663" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 8H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </header>

            <main class="gallery-main">
                <!-- Works Section - Clean layout -->
                <section id="works-section" class="portfolio-tab">
                    <section class="artworks-section">
                        <!-- REMOVED: Redundant "Works" header -->

                        <!-- Show standalone artworks first -->
                        ${standaloneArtworks.length > 0 ? `
                            <div class="artworks-grid ${profile.image_size || 'medium'}">
                                ${standaloneArtworks.map(artwork => `
                                    <div class="artwork-card">
                                        <div class="artwork-image">
                                            <img src="${artwork.image_url}" alt="${artwork.title}">
                                        </div>
                                        <div class="artwork-info">
                                            <h3 class="artwork-title">${artwork.title || 'Untitled'}</h3>
                                            <div class="artwork-details">
                                                ${artwork.year ? `<div>${artwork.year}</div>` : ''}
                                                ${artwork.medium ? `<div>${artwork.medium}</div>` : ''}
                                                ${artwork.dimensions ? `<div>${artwork.dimensions}</div>` : ''}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}

                        <!-- Show collections with contained layout -->
                        ${Object.keys(artworksByCollection).length > 0 ? 
                            Object.values(artworksByCollection).map(collectionData => `
                                <div class="collection-section" style="margin-top: 4rem;">
                                    <!-- Text Container - Matches image grid width -->
                                    <div style="max-width: 1400px; margin: 0 auto; padding: 0 2rem;">
                                        <!-- Collection Title (Left, Bold, Italic) -->
                                        <div style="margin-bottom: 1.5rem;">
                                            <h2 style="font-style: italic; font-weight: 600; font-size: 1.5rem; letter-spacing: -0.02em; text-align: left;">
                                                ${collectionData.collection.name || collectionData.collection.title || 'Untitled Collection'}
                                            </h2>
                                        </div>

                                        <!-- Artist Statement (Left-aligned, contained) -->
                                        ${collectionData.collection.description ? `
                                            <div style="margin-bottom: 3rem; max-width: 800px;">
                                                <p style="font-size: 1rem; line-height: 1.6; color: #333; text-align: left; word-wrap: break-word;">${collectionData.collection.description}</p>
                                            </div>
                                        ` : ''}
                                    </div>

                                    <!-- Artworks Grid -->
                                    <div class="artworks-grid ${profile.image_size || 'medium'}">
                                        ${collectionData.artworks.map(artwork => `
                                            <div class="artwork-card">
                                                <div class="artwork-image">
                                                    <img src="${artwork.image_url}" alt="${artwork.title}">
                                                </div>
                                                <div class="artwork-info">
                                                    <h3 class="artwork-title">${artwork.title || 'Untitled'}</h3>
                                                    <div class="artwork-details">
                                                        ${artwork.year ? `<div>${artwork.year}</div>` : ''}
                                                        ${artwork.medium ? `<div>${artwork.medium}</div>` : ''}
                                                        ${artwork.dimensions ? `<div>${artwork.dimensions}</div>` : ''}
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('') 
                        : ''}

                        <!-- Empty state -->
                        ${artworks.length === 0 ? `
                            <div class="empty-state">
                                <div class="empty-icon">ðŸŽ¨</div>
                                <h4>No public artworks yet</h4>
                                <p>This artist hasn't shared any works publicly.</p>
                            </div>
                        ` : ''}
                    </section>
                </section>

                <!-- Profile Section -->
<section id="profile-section" class="portfolio-tab" style="display: none;">
    <div class="hero-section">
        <div class="hero-container">
            <div style="max-width: 1000px; margin: 0 auto;">
                <!-- Profile Content - Photo left, Bio right -->
                <div style="display: flex; gap: 3rem; align-items: flex-start;">
                    <!-- Profile Photo -->
                    <div style="flex-shrink: 0;">
                        ${profile.profile_photo_url ? `
                            <img src="${profile.profile_photo_url}" 
     style="max-width: 300px; width: 100%; height: auto; border: 1px solid #e5e5e5;" 
     alt="${profile.full_name || profile.username}">
                        ` : `
                            <div style="width: 200px; height: 200px; background: #f5f5f5; border-radius: 12px; display: flex; align-items: center; justify-content: center; border: 1px solid #e5e5e5;">
                                <svg width="80" height="80" viewBox="0 0 80 80">
                                    <circle cx="40" cy="30" r="15" fill="none" stroke="#ddd" stroke-width="2"/>
                                    <path d="M 20 60 Q 40 75 60 60" fill="none" stroke="#ddd" stroke-width="2"/>
                                </svg>
                            </div>
                        `}
                    </div>

                    <!-- Bio Content - Left-aligned, contained -->
                    <div style="flex: 1;">
                        ${profile.bio ? `
                            <div style="text-align: left;">
                                <h3 style="margin-bottom: 1rem; font-weight: 500; font-size: 1.1rem;">About</h3>
                                <p style="line-height: 1.6; color: #333; font-size: 1rem; max-width: 100%; word-wrap: break-word;">
                                    ${profile.bio}
                                </p>
                            </div>
                        ` : `
                            <p style="color: #666; font-style: italic; text-align: left;">Artist profile</p>
                        `}
                    </div>
                </div>

                <!-- Social Links - Centered below -->
                ${profile.social_links ? `
                    <div style="text-align: center; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #f0f0f0;">
                        ${displaySocialIcons(profile.social_links)}
                    </div>
                ` : ''}
            </div>
        </div>
    </div>
</section>

                <!-- Events Tab -->
<section id="events-section" class="portfolio-tab" style="display: none;">
    <section class="artworks-section">
        <!-- Events Grid - MATCHES ARTWORK STYLE EXACTLY -->
        ${events && events.length > 0 ? `
            <div class="artworks-grid ${profile.image_size || 'medium'}">
                ${events.map(event => {
                    const eventDate = new Date(event.event_date);
                    const formattedDate = eventDate.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        year: 'numeric' 
                    });
                    
                    return `
                        <div class="artwork-card">
                            ${event.image_url ? `
    <div class="artwork-image">
        <img src="${event.image_url}" alt="${event.title}">
    </div>
` : `
    <div class="artwork-image">
        <svg width="100%" height="300" viewBox="0 0 300 300" style="background: #f5f5f5;">
            <circle cx="150" cy="120" r="40" fill="none" stroke="#ddd" stroke-width="2"/>
            <rect x="100" y="170" width="100" height="60" fill="none" stroke="#ddd" stroke-width="2"/>
            <line x1="100" y1="200" x2="200" y2="200" stroke="#ddd" stroke-width="1"/>
            <text x="150" y="190" text-anchor="middle" fill="#999" font-family="Arial" font-size="12">EVENT</text>
            <text x="150" y="210" text-anchor="middle" fill="#999" font-family="Arial" font-size="10">IMAGE</text>
        </svg>
    </div>
`}
                            
                            <div class="artwork-info">
                                <!-- Event Type -->
                                <div style="font-size: 0.7rem; color: #666; margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 0.05em;">
                                    ${event.event_type === 'exhibition' ? 'Exhibition' : 
                                      event.event_type === 'show' ? 'Show' :
                                      event.event_type === 'opening' ? 'Opening' :
                                      event.event_type === 'deadline' ? 'Deadline' : 'Event'}
                                </div>
                                
                                <!-- Event Title -->
                                <h3 class="artwork-title">${event.title}</h3>
                                
                                <!-- Event Details - CONTAINED LIKE ARTWORK INFO -->
                                <div class="artwork-details">
                                    <div>${formattedDate}${event.event_time ? ` â€¢ ${event.event_time}` : ''}</div>
                                    ${event.location ? `<div>${event.location}</div>` : ''}
                                    ${event.description ? `
                                        <div class="artwork-description">${event.description}</div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        ` : `
            <div class="empty-state">
    <div class="empty-icon">
        <svg width="80" height="80" viewBox="0 0 80 80" style="margin-bottom: 1.5rem;">
            <rect x="15" y="15" width="50" height="35" fill="none" stroke="#ddd" stroke-width="1.5"/>
            <rect x="20" y="55" width="40" height="15" fill="none" stroke="#ddd" stroke-width="1"/>
            <line x1="30" y1="20" x2="50" y2="20" stroke="#ddd" stroke-width="1"/>
            <line x1="30" y1="25" x2="50" y2="25" stroke="#ddd" stroke-width="1"/>
        </svg>
    </div>
    <h4>No upcoming events</h4>
    <p>There are no scheduled events at the moment.</p>
</div>
        `}
    </section>
</section>

                <footer style="text-align: center; padding: 1.5rem 0; color: #999; font-size: 0.7rem; border-top: 1px solid #f0f0f0; margin-top: 3rem;">
                    <p>Powered by TRAC</p>
                </footer>
            </main>
        `;

            document.getElementById('portfolioPage').innerHTML = portfolioHTML;

            // Navigation handler
            const navItems = document.querySelectorAll('.portfolio-nav .nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');

                    const tabName = this.getAttribute('data-tab');
                    document.querySelectorAll('.portfolio-tab').forEach(tab => {
                        tab.style.display = tab.id === `${tabName}-section` ? 'block' : 'none';
                    });
                });
            });
        }

        // View collection (for later - will integrate with portfolio)
        function viewCollection(collectionId) {
            // This will load the collection in portfolio view
            console.log("View collection:", collectionId);
            // We'll implement this in portfolio next
        }

        // CV Request Functions
        function showCVRequestForm() {
            document.getElementById('cvRequestModal').style.display = 'flex';
        }

        function hideCVRequestForm() {
            document.getElementById('cvRequestModal').style.display = 'none';
            document.getElementById('cvRequestForm').reset();
        }

        async function submitCVRequest(event) {
            event.preventDefault();
            const formData = new FormData(event.target);

            // For now, just show success message
            alert('âœ… CV request sent! The artist will contact you soon.');
            hideCVRequestForm();

            // Later: Add email integration here
        }

        // ... all your existing functions above ...

        // ADD AI STYLE FUNCTIONS RIGHT HERE - BEFORE EVENT LISTENERS

        function generateAIStyles() {
            currentPage++;
            const newStyles = generateStyleCombinations(6);
            generatedStyles = [...generatedStyles, ...newStyles];
            displayGeneratedStyles();
        }

        function generateStyleCombinations(count) {
            const combinations = [];
            for (let i = 0; i < count; i++) {
                const font = STYLE_COMPONENTS.fonts[Math.floor(Math.random() * STYLE_COMPONENTS.fonts.length)];
                const colors = STYLE_COMPONENTS.colorSchemes[Math.floor(Math.random() * STYLE_COMPONENTS.colorSchemes.length)];
                const layout = STYLE_COMPONENTS.layouts[Math.floor(Math.random() * STYLE_COMPONENTS.layouts.length)];
                const sections = STYLE_COMPONENTS.sections[Math.floor(Math.random() * STYLE_COMPONENTS.sections.length)];

                combinations.push({
                    id: `ai-style-${Date.now()}-${i}`,
                    name: `AI Style ${currentPage}-${i+1}`,
                    fonts: font,
                    colors: colors,
                    layout: layout,
                    sections: sections
                });
            }
            return combinations;
        }

        function displayGeneratedStyles() {
            const container = document.createElement('div');
            container.className = 'ai-styles-grid';
            container.style.marginTop = '2rem';

            generatedStyles.forEach(style => {
                const styleCard = createStyleCard(style);
                container.appendChild(styleCard);
            });

            const existingAI = document.querySelector('.ai-styles-grid');
            if (existingAI) existingAI.remove();

            document.getElementById('styleBrowserGrid').appendChild(container);
        }

        function createStyleCard(style) {
            const card = document.createElement('div');
            card.className = 'style-card';
            card.style.border = '1px solid #e5e5e5';
            card.style.borderRadius = '8px';
            card.style.padding = '1.5rem';
            card.style.transition = 'all 0.2s';

            card.innerHTML = `
                <div style="background: ${style.colors.bg}; color: ${style.colors.accent}; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: '${style.fonts.primary}', sans-serif; cursor: pointer;" onclick="previewAIStyle('${style.id}')">
                    <div style="font-size: 1.2rem; font-weight: bold;">${style.name}</div>
                    <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">AI Generated</div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span style="font-weight: 500;">${style.name}</span>
                    <button type="button" class="heart-btn" onclick="toggleFavorite('${style.id}')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
                </div>
                <button type="button" onclick="applyAIStyle('${style.id}')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">
                    Apply Style
                </button>
            `;

            return card;
        }

        function previewAIStyle(styleId) {
            const style = generatedStyles.find(s => s.id === styleId);
            if (style) {
                alert(`Preview: ${style.name}\nFonts: ${style.fonts.primary} + ${style.fonts.secondary}\nLayout: ${style.layout}`);
            }
        }

        function applyAIStyle(styleId) {
            const style = generatedStyles.find(s => s.id === styleId);
            if (style) {
                const portfolioPage = document.getElementById('portfolioPage');
                if (portfolioPage) {
                    portfolioPage.classList.remove('style-applied');
                    portfolioPage.classList.add('style-applied');
                    document.documentElement.style.setProperty('--bg-color', style.colors.bg);
                    document.documentElement.style.setProperty('--text-color', style.colors.text);
                    document.documentElement.style.setProperty('--accent-color', style.colors.accent);
                    document.documentElement.style.setProperty('--border-color', style.colors.border);
                }
                alert(`âœ… ${style.name} applied!`);
                hideStyleBrowser();
            }
        }

        function updateFavoriteHearts() {
            document.querySelectorAll('.heart-btn').forEach(btn => {
                const styleId = btn.getAttribute('onclick').match(/toggleFavorite\('([^']+)'\)/)[1];
                btn.textContent = favoriteStyles.includes(styleId) ? 'â˜…' : 'â˜†';
            });
        }

        function showFavorites() {
            alert("Favorites view - coming soon");
        }

        function showAllStyles() {
            alert("Back to all styles - coming soon");
        }
        
        // EVENT LISTENERS
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();

            // Form switching
            document.getElementById('switchToSignUp').addEventListener('click', function(e) {
                e.preventDefault();
                showSignUpForm();
            });

            document.getElementById('switchToSignIn').addEventListener('click', function(e) {
                e.preventDefault();
                showSignInForm();
            });

            // CV Request Form
            document.getElementById('cvRequestForm').addEventListener('submit', submitCVRequest);

            // Event form submission
            document.getElementById('eventForm').addEventListener('submit', createEvent);
            
            // Sign in functionality
            document.getElementById('signInButton').addEventListener('click', async function() {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const message = document.getElementById('message');

                if (!email || !password) {
                    message.innerHTML = "âŒ Please enter email and password";
                    return;
                }

                message.innerHTML = "ðŸ”„ Signing in...";

                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) {
                    message.innerHTML = "âŒ " + error.message;
                } else {
                    message.innerHTML = "âœ… Success! Redirecting...";
                    showSection('dashboard');
                }
            });

            // Sign up functionality
            document.getElementById('signUpButton').addEventListener('click', async function() {
                const fullName = document.getElementById('signupFullName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const agreeTerms = document.getElementById('agreeTerms').checked;
                const message = document.getElementById('signupMessage');

                if (!fullName || !email || !password || !confirmPassword) {
                    message.innerHTML = "âŒ Please fill in all fields";
                    return;
                }

                if (password !== confirmPassword) {
                    message.innerHTML = "âŒ Passwords do not match";
                    return;
                }

                if (!agreeTerms) {
                    message.innerHTML = "âŒ Please agree to the Terms of Service and Privacy Policy";
                    return;
                }

                message.innerHTML = "ðŸ”„ Creating your TRAC account...";

                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: fullName
                        }
                    }
                });

                if (error) {
                    message.innerHTML = "âŒ " + error.message;
                } else {
                    message.innerHTML = "âœ… Account created! Please check your email to verify your account.";
                    setTimeout(() => {
                        showSignInForm();
                        document.getElementById('email').value = email;
                        document.getElementById('password').value = '';
                    }, 4000);
                }
            });

            // Artwork form submission
            const artworkForm = document.getElementById('artworkUploadForm');
            if (artworkForm) {
                artworkForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await uploadArtwork();
                });
            }

            // Profile form submission
            const profileForm = document.getElementById('profileSettingsForm');
            if (profileForm) {
                profileForm.addEventListener('submit', saveProfile);
                
                // Prevent Enter key from accidentally submitting the form
                profileForm.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA' && e.target.type !== 'submit') {
                        e.preventDefault();
                        return false;
                    }
                });
            }

            // Collection form submission
            document.getElementById('collectionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                e.stopPropagation();
                createCollection(e);
            });

            // Timeline filter event listeners
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('timeline-filter')) {
                    // Remove active class from all buttons
                    document.querySelectorAll('.timeline-filter').forEach(btn => {
                        btn.classList.remove('active');
                    });

                    // Add active class to clicked button
                    e.target.classList.add('active');

                    // Load history with selected filter
                    const hours = parseInt(e.target.getAttribute('data-hours'));
                    loadActivityHistory(hours);
                }
            });
        });
    </script>

    <!-- CV Request Modal -->
    <div id="cvRequestModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="margin: 0;">Request Artist CV</h3>
                <button onclick="hideCVRequestForm()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">Ã—</button>
            </div>

            <form id="cvRequestForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Company/Gallery *</label>
                        <input type="text" name="company" required>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" name="phone">
                    </div>
                </div>

                <div class="form-group">
                    <label>Message (Optional)</label>
                    <textarea name="message" rows="3" placeholder="Tell the artist about your interest..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideCVRequestForm()">Cancel</button>
                    <button type="submit" class="btn-primary">Send Request</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Activity History Popup -->
    <div id="activityHistoryPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3 style="margin: 0;">Activity History</h3>
                <button onclick="hideActivityHistory()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">Ã—</button>
            </div>

            <!-- Timeline Filters -->
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                <button class="timeline-filter active" data-hours="1">Last Hour</button>
                <button class="timeline-filter" data-hours="24">Last Day</button>
                <button class="timeline-filter" data-hours="168">Last Week</button>
                <button class="timeline-filter" data-hours="720">Last Month</button>
                <button class="timeline-filter" data-hours="0">All Time</button>
            </div>

            <div id="activityHistoryList">
                <div class="activity-item">
                    <div class="activity-dot"></div>
                    <div class="activity-content">
                        <p>Loading history...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Artwork Popup -->
    <div id="artworkPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3 style="margin: 0;">Add New Artwork</h3>
                <button onclick="hideArtworkPopup()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">Ã—</button>
            </div>
            
                    <!-- Form Fields -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="title">Title *</label>
                            <input type="text" id="title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="year">Year</label>
                            <input type="number" id="year" name="year" min="1900" max="2030">
                        </div>
                        <div class="form-group">
                            <label for="medium">Medium</label>
                            <input type="text" id="medium" name="medium" placeholder="Oil on canvas, etc.">
                        </div>
                        <div class="form-group">
                            <label for="dimensions">Dimensions</label>
                            <input type="text" id="dimensions" name="dimensions" placeholder="24 Ã— 36 in">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="10" placeholder="Describe the artwork..." style="width: 100%; min-height: 200px; resize: vertical;"></textarea>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="isPublic" name="isPublic" checked>
                            Make this artwork public on your portfolio
                        </label>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideArtworkPopup()">Cancel</button>
                    <button type="submit" class="btn-primary">Add Artwork</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Event Form Popup -->
    <div id="addEventPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3 style="margin: 0;">Add New Event</h3>
                <button onclick="hideAddEventForm()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">Ã—</button>
            </div>

            <form id="eventForm">
                <div class="form-body">
                    <!-- Image Upload -->
                    <div class="form-group">
                        <label>Event Poster/Image (Optional)</label>
                        <div class="upload-zone" id="eventUploadZone" ondragover="handleEventDragOver(event)" ondrop="handleEventDrop(event)" style="margin-bottom: 1rem;">
                            <div class="upload-placeholder" id="eventUploadPlaceholder">
                                <span>Drag & drop event poster here</span>
                                <span class="upload-subtitle">or click to browse (JPG, PNG, WebP - max 5MB)</span>
                            </div>
                            <input type="file" id="eventImageInput" accept="image/*" style="display: none;" onchange="handleEventImageSelect(event)">
                            <div id="eventImagePreview" class="image-preview" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="eventTitle">Event Title *</label>
                            <input type="text" id="eventTitle" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="eventType">Event Type</label>
                            <select id="eventType" name="eventType">
                                <option value="exhibition">Exhibition</option>
                                <option value="show">Show</option>
                                <option value="opening">Opening Reception</option>
                                <option value="deadline">Application Deadline</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="eventDate">Event Date *</label>
                            <input type="date" id="eventDate" name="eventDate" required>
                        </div>
                        <div class="form-group">
                            <label for="eventTime">Event Time (Optional)</label>
                            <input type="time" id="eventTime" name="eventTime">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="eventLocation">Location</label>
                        <input type="text" id="eventLocation" name="location" placeholder="Gallery name, venue, or online">
                    </div>

                    <div class="form-group">
                        <label for="eventDescription">Description</label>
                        <textarea id="eventDescription" name="description" rows="4" placeholder="Describe the event..."></textarea>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" name="isPublic" checked>
                            Make this event public on your portfolio
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideAddEventForm()">Cancel</button>
                    <button type="submit" class="btn-primary">Add Event</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Terms & Privacy Popups -->
    <div id="termsPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                <button onclick="hideTermsPopup()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; margin-right: 1rem;">â†</button>
                <h3 style="margin: 0;">Terms of Service</h3>
            </div>
            <div style="line-height: 1.6;">
                <p><strong>TRAC Artist Platform Terms of Service</strong></p>
                <p>Welcome to TRAC. By using our platform, you agree to these terms...</p>
                <div style="line-height: 1.6; max-height: 60vh; overflow-y: auto;">
                    <h4 style="margin-bottom: 1rem;">TRAC Artist Platform - Terms of Service</h4>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>1. Artist Ownership & Rights</h5>
                        <p>You retain all copyright and intellectual property rights to your artwork. TRAC serves as a portfolio and archival platform only.</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>2. Portfolio Service</h5>
                        <p>TRAC provides artists with a professional portfolio platform to showcase work to galleries, collectors, and the public. We do not claim any ownership or commercial rights to your content.</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>3. Content Responsibility</h5>
                        <p>You are responsible for all artwork, images, and content you upload. You confirm you have the rights to publish this content.</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>4. Future Services (Planned)</h5>
                        <p>TRAC may introduce additional services including:<br>
                        â€¢ Artwork registration & certification<br>
                        â€¢ Resale royalty tracking<br>
                        â€¢ Exhibition management<br>
                        â€¢ Additional terms will apply for premium features</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>5. Platform Usage</h5>
                        <p>TRAC is provided "as is" for artistic portfolio purposes. We reserve the right to remove content that violates these terms.</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>6. AI Training Prohibition</h5>
                        <p>TRAC will never use your artwork, images, or content to train artificial intelligence models, machine learning algorithms, or any AI systems. Your creative work remains exclusively for portfolio presentation and future TRAC services you explicitly opt into.</p>
                    </div>

                    <div style="font-size: 0.9rem; color: #666; border-top: 1px solid #eee; padding-top: 1rem;">
                        <p><strong>Last updated:</strong> ${new Date().toLocaleDateString()}</p>
                        <p>By using TRAC, you agree to these terms for portfolio services.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="privacyPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                <button onclick="hidePrivacyPopup()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; margin-right: 1rem;">â†</button>
                <h3 style="margin: 0;">Privacy Policy</h3>
            </div>
            <div style="line-height: 1.6;">
                <p><strong>TRAC Privacy Policy</strong></p>
                <p>Your privacy is important to us. This policy explains how we handle your data...</p>
                <div style="line-height: 1.6; max-height: 60vh; overflow-y: auto;">
                    <h4 style="margin-bottom: 1rem;">TRAC Privacy Policy</h4>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>1. Information We Collect</h5>
                        <p>â€¢ Account information (email, name)<br>
                        â€¢ Artwork images and metadata<br>
                        â€¢ Portfolio content and artist statements<br>
                        â€¢ Usage data for platform improvement</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>2. How We Use Your Information</h5>
                        <p>â€¢ Display your public portfolio<br>
                        â€¢ Provide artist dashboard services<br>
                        â€¢ Platform maintenance and improvements<br>
                        â€¢ Future feature development</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>3. Data Sharing</h5>
                        <p>â€¢ Your public portfolio is visible to anyone with the link<br>
                        â€¢ We do not sell your personal data<br>
                        â€¢ Gallery/collector requests may be forwarded (with consent)<br>
                        â€¢ Legal compliance when required</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>4. Future Services Data Usage</h5>
                        <p>For planned features like resale tracking, we may:<br>
                        â€¢ Monitor artwork sales data (with permission)<br>
                        â€¢ Process royalty payments<br>
                        â€¢ Provide certification services<br>
                        â€¢ Additional consents will be required</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>5. AI Training Protection</h5>
                        <p>We explicitly prohibit using your artwork, images, or creative content for:<br>
                        â€¢ AI model training<br>
                        â€¢ Machine learning datasets<br>
                        â€¢ Generative AI systems<br>
                        â€¢ Any automated content analysis beyond portfolio display<br>
                        Your artistic work is protected from commercial AI training in perpetuity.</p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h5>6. Your Rights</h5>
                        <p>â€¢ Access and download your data<br>
                        â€¢ Delete your account and content<br>
                        â€¢ Control portfolio visibility<br>
                        â€¢ Opt-out of future service features</p>
                    </div>

                    <div style="font-size: 0.9rem; color: #666; border-top: 1px solid #eee; padding-top: 1rem;">
                        <p><strong>Last updated:</strong> ${new Date().toLocaleDateString()}</p>
                        <p>We protect your artistic legacy and privacy.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STYLE BROWSER MODAL -->
    <div id="styleBrowserModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 1000px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3 style="margin: 0;">Browse Portfolio Styles</h3>
                <div>
                    <button onclick="showFavorites()" class="btn-secondary" style="margin-right: 1rem; font-size: 0.8rem; padding: 0.5rem 1rem;">â­ Favorites</button>
                    <button onclick="hideStyleBrowser()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">Ã—</button>
                </div>
            </div>

                <div id="styleBrowserGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
                    <!-- Guerrilla Minimal -->
                    <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; transition: all 0.2s;">
                        <div style="background: #0a0a0a; color: #ff0000; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: 'Helvetica', sans-serif; cursor: pointer;" onclick="previewStyle('guerrilla-minimal')">
                            <div style="font-size: 1.2rem; font-weight: bold;">Guerrilla Minimal</div>
                            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">Bold â€¢ Red Accent</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500;">Guerrilla Minimal</span>
                            <button type="button" class="heart-btn" onclick="toggleFavorite('guerrilla-minimal')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
                        </div>
                        <button type="button" onclick="applyStyle('guerrilla-minimal')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">Apply Style</button>
                    </div>

                    <!-- Elegant Gallery -->
                    <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; transition: all 0.2s;">
                        <div style="background: #f8f8f8; color: #2a2a2a; border: 1px solid #e0e0e0; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: 'Georgia', serif; cursor: pointer;" onclick="previewStyle('elegant-gallery')">
                            <div style="font-size: 1.2rem; font-weight: bold;">Elegant Gallery</div>
                            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">Clean â€¢ Professional</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500;">Elegant Gallery</span>
                            <button type="button" class="heart-btn" onclick="toggleFavorite('elegant-gallery')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
                        </div>
                        <button type="button" onclick="applyStyle('elegant-gallery')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">Apply Style</button>
                    </div>

                    <!-- Experimental Immersive -->
                    <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; transition: all 0.2s;">
                        <div style="background: #1a1a2e; color: #00b4d8; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: 'Space Grotesk', sans-serif; cursor: pointer;" onclick="previewStyle('experimental-immersive')">
                            <div style="font-size: 1.2rem; font-weight: bold;">Experimental Immersive</div>
                            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">Dark â€¢ Cyan Accent</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500;">Experimental Immersive</span>
                            <button type="button" class="heart-btn" onclick="toggleFavorite('experimental-immersive')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
                        </div>
                        <button type="button" onclick="applyStyle('experimental-immersive')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">Apply Style</button>
                    </div>
                    <!-- Monumental Sculptural -->
                    <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; transition: all 0.2s;">
                        <div style="background: #2c2c2c; color: #c0a080; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: 'Times New Roman', serif; cursor: pointer;" onclick="previewStyle('monumental-sculptural')">
                            <div style="font-size: 1.2rem; font-weight: bold;">Monumental Sculptural</div>
                            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">Classic â€¢ Bronze</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500;">Monumental Sculptural</span>
                            <button type="button" class="heart-btn" onclick="toggleFavorite('monumental-sculptural')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
                        </div>
                        <button type="button" onclick="applyStyle('monumental-sculptural')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">Apply Style</button>
                    </div>

                    <!-- Historical Layered -->
                    <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; transition: all 0.2s;">
                        <div style="background: #f5f1e6; color: #8b4513; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: 'Garamond', serif; cursor: pointer;" onclick="previewStyle('historical-layered')">
                            <div style="font-size: 1.2rem; font-weight: bold;">Historical Layered</div>
                            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">Vintage â€¢ Earth Tones</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500;">Historical Layered</span>
                            <button type="button" class="heart-btn" onclick="toggleFavorite('historical-layered')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
                        </div>
                        <button type="button" onclick="applyStyle('historical-layered')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">Apply Style</button>
                    </div>

                    <!-- Colorful Vibrant -->
                    <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; transition: all 0.2s;">
                        <div style="background: #ffffff; color: #ff6b6b; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: 'Arial', sans-serif; cursor: pointer;" onclick="previewStyle('colorful-vibrant')">
                            <div style="font-size: 1.2rem; font-weight: bold;">Colorful Vibrant</div>
                            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">Bright â€¢ Energetic</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500;">Colorful Vibrant</span>
                            <button type="button" class="heart-btn" onclick="toggleFavorite('colorful-vibrant')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
                        </div>
                        <button type="button" onclick="applyStyle('colorful-vibrant')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">Apply Style</button>
                    </div>

                    <!-- Abstract Expressionist -->
                    <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; transition: all 0.2s;">
                        <div style="background: #1e1e1e; color: #ff9500; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: 'Brush Script MT', cursive; cursor: pointer;" onclick="previewStyle('abstract-expressionist')">
                            <div style="font-size: 1.2rem; font-weight: bold;">Abstract Expressionist</div>
                            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">Dynamic â€¢ Organic</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500;">Abstract Expressionist</span>
                            <button type="button" class="heart-btn" onclick="toggleFavorite('abstract-expressionist')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
                        </div>
                        <button type="button" onclick="applyStyle('abstract-expressionist')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">Apply Style</button>
                    </div>

                    <!-- Storytelling Quilt -->
                    <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; transition: all 0.2s;">
                        <div style="background: #fff8e1; color: #7b1fa2; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: 'Georgia', serif; cursor: pointer;" onclick="previewStyle('storytelling-quilt')">
                            <div style="font-size: 1.2rem; font-weight: bold;">Storytelling Quilt</div>
                            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">Warm â€¢ Narrative</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500;">Storytelling Quilt</span>
                            <button type="button" class="heart-btn" onclick="toggleFavorite('storytelling-quilt')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
                        </div>
                        <button type="button" onclick="applyStyle('storytelling-quilt')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">Apply Style</button>
                    </div>

                    <!-- Contemporary Digital -->
                    <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; transition: all 0.2s;">
                        <div style="background: #000000; color: #00ff00; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: 'Inter', sans-serif; cursor: pointer;" onclick="previewStyle('contemporary-digital')">
                            <div style="font-size: 1.2rem; font-weight: bold;">Contemporary Digital</div>
                            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">Cyber â€¢ Neon</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 500;">Contemporary Digital</span>
                            <button type="button" class="heart-btn" onclick="toggleFavorite('contemporary-digital')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
                        </div>
                        <button type="button" onclick="applyStyle('contemporary-digital')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">Apply Style</button>
                    </div>

    <!-- Political Archival -->
    <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; transition: all 0.2s;">
        <div style="background: #ffffff; color: #cc0000; padding: 2rem; border-radius: 4px; margin-bottom: 1rem; text-align: center; font-family: 'Times New Roman', serif; cursor: pointer;" onclick="previewStyle('political-archival')">
            <div style="font-size: 1.2rem; font-weight: bold;">Political Archival</div>
            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem;">Bold â€¢ Contrast</div>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
            <span style="font-weight: 500;">Political Archival</span>
            <button type="button" class="heart-btn" onclick="toggleFavorite('political-archival')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem;">â˜†</button>
        </div>
        <button type="button" onclick="applyStyle('political-archival')" class="btn-secondary" style="width: 100%; padding: 0.5rem; font-size: 0.8rem;">Apply Style</button>
    </div>
                    <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e5e5e5;">
                        <button onclick="generateAIStyles()" class="btn-primary" style="padding: 1rem 2rem; font-size: 1rem;">
                            ðŸŽ¨ Generate More Styles
                        </button>
                        <p style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">
                            AI-powered style combinations based on your favorites
                        </p>
                    </div>

                    <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e5e5e5;">
                        <button onclick="generateAIStyles()" class="btn-primary" style="padding: 1rem 2rem; font-size: 1rem;">
                            Generate More Styles
                        </button>
                        <p style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">
                            AI-powered style combinations based on your favorites
                        </p>
                    </div>
</div>
</div>
</div>
</body>
</html>