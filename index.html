<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TRAC - Artist Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* BASIC RESET */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Space Grotesk', sans-serif; }
        body { 
            background: #ffffff; 
            color: #000000; 
            line-height: 1.6; 
            font-weight: 400;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* LOGIN STYLES */
        #login-section { 
            background: white; 
            min-height: 100vh; 
            display: grid; 
            place-items: center; 
            justify-content: center;
            padding: 2rem; 
        }
        .login-container { width: 100%; max-width: 440px; }
        .login-header { text-align: center; margin-bottom: 3rem; }
        .login-header h1 { font-size: 2rem; font-weight: 500; margin-bottom: 0.75rem; letter-spacing: -0.02em; }
        .login-header .tagline { color: #666; font-size: 1rem; font-weight: 400; }
        .auth-form { background: white; border: 1px solid #e5e5e5; border-radius: 12px; padding: 2.5rem; }
        .form-header { text-align: center; margin-bottom: 2.5rem; }
        .form-header h2 { font-size: 1.25rem; font-weight: 500; margin-bottom: 0.5rem; }
        .form-header p { color: #666; font-size: 0.9rem; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-size: 0.85rem; margin-bottom: 0.5rem; color: #333; font-weight: 500; }
        .form-group input { width: 100%; padding: 0.875rem; border: 1px solid #d1d1d1; border-radius: 8px; font-size: 0.9rem; font-family: inherit; transition: border-color 0.2s; background: white; }
        .form-group input:focus { outline: none; border-color: #000; }
        .auth-button { width: 100%; background: #000; color: white; border: none; padding: 1rem; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: opacity 0.2s; border-radius: 8px; margin-bottom: 1.5rem; }
        .auth-button:hover { opacity: 0.9; }
        .auth-button:disabled { opacity: 0.5; cursor: not-allowed; }
        .auth-switch { text-align: center; padding-top: 1.5rem; border-top: 1px solid #f0f0f0; }
        .auth-switch p { color: #666; font-size: 0.85rem; }
        .auth-switch a { color: #000; text-decoration: underline; }
        .message { margin: 1rem 0; padding: 0.875rem; border-radius: 8px; font-size: 0.85rem; text-align: center; }

        /* DASHBOARD HEADER */
        .gallery-header { background: white; border-bottom: 1px solid #e5e5e5; padding: 1rem 0; position: sticky; top: 0; z-index: 100; }
        .header-container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .header-left { display: flex; align-items: center; gap: 3rem; }
        .logo-container { background: #000000; border-radius: 12px; padding: 0.75rem 1.25rem; display: inline-flex; align-items: center; justify-content: center; }
        .gallery-logo { font-size: 2.2rem; font-weight: 600; letter-spacing: -0.02em; color: #ffffff; margin: 0; line-height: 1; }
        .gallery-nav { display: flex; gap: 2rem; }
        .nav-item { text-decoration: none; color: #666; font-size: 0.85rem; font-weight: 400; transition: color 0.2s; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; }
        .nav-item.active, .nav-item:hover { color: #000; }
        .header-right { display: flex; gap: 1rem; }
        .icon-button { background: none; border: none; padding: 0.5rem; cursor: pointer; color: #666; transition: color 0.2s; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .icon-button:hover { color: #000; background: #f5f5f5; }

        /* DASHBOARD CONTENT */
        .gallery-main { padding: 0; }
        .hero-section { padding: 3rem 0 2rem; text-align: center; }
        .hero-container { max-width: 800px; margin: 0 auto; padding: 0 2rem; }
        .hero-title { font-size: 2.25rem; font-weight: 500; margin-bottom: 0.75rem; letter-spacing: -0.02em; }
        .hero-subtitle { font-size: 1rem; color: #666; font-weight: 400; }
        .stats-section { padding: 2rem 0; border-bottom: 1px solid #e5e5e5; }
        .stats-container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; }
        .stat-item { text-align: center; }
        .stat-number { font-size: 2rem; font-weight: 400; margin-bottom: 0.5rem; letter-spacing: -0.02em; }
        .stat-label { font-size: 0.85rem; color: #666; text-transform: uppercase; letter-spacing: 0.05em; }
        .artworks-section { padding: 4rem 0; }
        .section-header { max-width: 1400px; margin: 0 auto 3rem; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .section-title { font-size: 1.25rem; font-weight: 500; letter-spacing: -0.02em; }
        .add-artwork-btn { background: #000; color: white; border: none; padding: 0.75rem 1.5rem; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: opacity 0.2s; border-radius: 8px; }
        .add-artwork-btn:hover { opacity: 0.9; }
        .add-artwork-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .artworks-grid {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            .artworks-grid {
                grid-template-columns: 1fr;
                padding: 0 0.5rem;
                gap: 1.5rem;
            }
        }
        .empty-state { grid-column: 1 / -1; text-align: center; padding: 4rem 2rem; }
        .empty-icon { font-size: 3rem; margin-bottom: 1.5rem; }
        .empty-state h4 { font-size: 1.1rem; font-weight: 500; margin-bottom: 0.5rem; }
        .empty-state p { color: #666; margin-bottom: 2rem; font-size: 0.9rem; }
        .cta-button { background: #000; color: white; border: none; padding: 1rem 2rem; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: opacity 0.2s; border-radius: 8px; }
        .cta-button:hover { opacity: 0.9; }
        .cta-button:disabled { opacity: 0.5; cursor: not-allowed; }
        .artwork-card { 
            word-wrap: break-word;
            overflow-wrap: break-word;
            transition: transform 0.2s ease;
        }
        .artwork-card:hover {
            transform: translateY(-2px);
        }
        .artwork-info {
            padding: 0;
            max-width: 100%;
            word-wrap: break-word;
        }
        .artwork-title { 
            font-size: 0.8rem;
            font-weight: 500; 
            margin-bottom: 0.2rem; 
        }
        .artwork-details { 
            color: #666; 
            font-size: 0.7rem;
            line-height: 1.2;
            max-width: 100%;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .artwork-details div {
            max-width: 100%;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .artwork-actions {
            margin-top: 1rem;
        }
        .delete-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 0.7rem;
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
        }
        .delete-btn:hover {
            color: #ff4444;
        }

        /* Events Styles */
        .event-card {
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 1.5rem;
            background: white;
            transition: box-shadow 0.2s ease;
        }
        .event-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .event-date {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        .event-title {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #000;
        }
        .event-location {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.75rem;
        }
        .event-description {
            font-size: 0.8rem;
            color: #333;
            line-height: 1.4;
            margin-bottom: 1rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
        }
        .event-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        
        /* Activity Section */
        .activity-section { 
            padding: 1.5rem 0; 
            border-top: 1px solid #e5e5e5; 
        }
        .activity-list { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 0 2rem; 
        }
        .activity-item { 
            display: flex; 
            gap: 0.75rem; 
            padding: 0.5rem 0; 
            border-bottom: 1px solid #f0f0f0; 
        }
        .activity-dot { 
            width: 6px; 
            height: 6px; 
            background: #000; 
            border-radius: 50%; 
            margin-top: 0.4rem; 
            flex-shrink: 0; 
        }
        .activity-content p { 
            margin-bottom: 0.2rem; 
            font-size: 0.75rem; 
            line-height: 1.3;
            color: #333;
        }
        .activity-time { 
            font-size: 0.65rem; 
            color: #666; 
        }

        /* UPLOAD FORM */
        .upload-form-container { max-width: 800px; margin: 0 auto 3rem; padding: 0 2rem; }
        .upload-form { background: white; border: 1px solid #e5e5e5; border-radius: 12px; overflow: hidden; }
        .upload-form .form-header { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 2rem; border-bottom: 1px solid #e5e5e5; margin: 0; }
        .upload-form .form-header h4 { font-size: 1.1rem; font-weight: 500; margin: 0; }
        .close-form { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 8px; }
        .close-form:hover { color: #000; background: #f5f5f5; }
        .form-body { padding: 2rem; }
        .upload-zone { border: 2px dashed #d1d1d1; border-radius: 12px; padding: 3rem 2rem; text-align: center; cursor: pointer; transition: all 0.3s ease; margin-bottom: 2rem; background: #fafafa; }
        .upload-zone:hover { border-color: #000; background: #f5f5f5; }
        .upload-zone.dragover { border-color: #000; background: #f0f0f0; }
        .upload-placeholder span { display: block; }
        .upload-placeholder span:first-child { font-size: 1rem; margin-bottom: 0.5rem; font-weight: 500; }
        .upload-subtitle { color: #666; font-size: 0.85rem; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
        .form-actions { display: flex; justify-content: flex-end; gap: 1rem; padding: 1.5rem 2rem; border-top: 1px solid #e5e5e5; background: #fafafa; }
        .btn-secondary { background: transparent; border: 1px solid #d1d1d1; padding: 0.75rem 1.5rem; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: all 0.2s; border-radius: 8px; }
        .btn-secondary:hover { background: #f5f5f5; }
        .btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: #000; color: white; border: none; padding: 0.75rem 1.5rem; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: opacity 0.2s; border-radius: 8px; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .image-preview { text-align: center; }
        .image-preview img { max-width: 100%; max-height: 300px; }

        /* PROFILE SETTINGS STYLES */
        .form-section { margin-bottom: 2rem; }
        .form-section h3 { font-size: 0.85rem; font-weight: 500; margin-bottom: 1rem; color: #000; text-transform: uppercase; letter-spacing: 0.05em; }
        .terms-group { display: flex; align-items: flex-start; gap: 0.75rem; margin: 2rem 0; padding: 1rem 0; border-top: 1px solid #f0f0f0; border-bottom: 1px solid #f0f0f0; }
        .terms-group input[type="checkbox"] { margin-top: 0.2rem; }
        .terms-group label { font-size: 0.85rem; color: #333; line-height: 1.4; }
        .terms-group a { color: #000; text-decoration: underline; }
        .social-platform-item { margin-bottom: 1.5rem; padding: 1rem; border: 1px solid #f0f0f0; border-radius: 8px; background: #fafafa; }

        /* PORTFOLIO STYLES */
        .portfolio-header { background: white; border-bottom: 1px solid #e5e5e5; padding: 1rem 0; position: sticky; top: 0; z-index: 100; }
        .portfolio-header .header-container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .portfolio-header .header-left { display: flex; align-items: center; gap: 3rem; }
        .portfolio-header .header-right { display: flex; gap: 2rem; align-items: center; }
        .artist-name { font-size: 1.5rem; font-weight: 500; color: #000; }
        .portfolio-nav { display: flex; gap: 2rem; }
        
        /* Mobile navigation */
        @media (max-width: 768px) {
            .portfolio-nav {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            .portfolio-nav .nav-item {
                font-size: 0.8rem;
                padding: 0.5rem 1rem;
                background: #f5f5f5;
                border-radius: 6px;
            }
        }

        /* PORTFOLIO LAYOUT CLASSES - COMPLETED */
        .portfolio-layout.grid-classic {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        .portfolio-layout.grid-masonry {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            grid-auto-rows: 10px;
            gap: 2rem;
        }

        .portfolio-layout.grid-masonry .artwork-card {
            grid-row-end: span 45;
        }

        .portfolio-layout.grid-masonry .artwork-card:nth-child(odd) {
            grid-row-end: span 40;
        }

        .portfolio-layout.grid-masonry .artwork-card:nth-child(3n) {
            grid-row-end: span 50;
        }

        .portfolio-layout.stacked-minimal {
            grid-template-columns: 1fr;
            max-width: 900px;
            margin: 0 auto;
            gap: 4rem;
        }

        .portfolio-layout.stacked-minimal .artwork-card {
            text-align: center;
            padding: 3rem 0;
            border-bottom: 1px solid var(--border-color, #e5e5e5);
        }

        .portfolio-layout.stacked-minimal .artwork-card:last-child {
            border-bottom: none;
        }

        .portfolio-layout.stacked-minimal .artwork-image {
            margin-bottom: 2rem;
        }

        .portfolio-layout.stacked-minimal .artwork-title {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .portfolio-layout.card-modern .artwork-card {
            background: var(--bg-color, white);
            border: 2px solid var(--border-color, #e5e5e5);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .portfolio-layout.card-modern .artwork-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .portfolio-layout.card-modern .artwork-info {
            padding: 1.5rem 0 0 0;
            border-top: 1px solid var(--border-color, #e5e5e5);
        }

        .portfolio-layout.magazine {
            grid-template-columns: 1fr 1fr;
            grid-template-areas: 
                "featured featured"
                "secondary secondary";
            gap: 3rem;
        }

        .portfolio-layout.magazine .artwork-card:first-child {
            grid-area: featured;
        }

        .portfolio-layout.magazine .artwork-card:first-child .artwork-image {
            max-height: 70vh;
        }

        .portfolio-layout.magazine .artwork-card:first-child .artwork-title {
            font-size: 2.5rem;
            text-align: center;
            margin: 2rem 0;
        }

        .portfolio-layout.portfolio-focused {
            grid-template-columns: 1fr;
            gap: 4rem;
        }

        .portfolio-layout.portfolio-focused .artwork-card:first-child {
            min-height: 80vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
        }

        .portfolio-layout.portfolio-focused .artwork-card:first-child .artwork-title {
            font-size: 3rem;
            margin: 3rem 0;
        }

        .portfolio-layout.portfolio-focused .artwork-card:not(:first-child) {
            max-width: 600px;
            margin: 0 auto;
        }

        /* PORTFOLIO Size Classes */
        .artworks-grid.small { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)) !important; }
        .artworks-grid.medium { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)) !important; }
        .artworks-grid.large { grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)) !important; }

        /* Natural image sizing */
        .artwork-image {
            width: 100%;
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        .artwork-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* PORTFOLIO STYLE PRESETS */
        .style-minimal-dark {
            --bg-color: #000000;
            --text-color: #ffffff;
            --accent-color: #666666;
            --border-color: #333333;
        }

        .style-gallery-bright {
            --bg-color: #ffffff;
            --text-color: #333333;
            --accent-color: #000000;
            --border-color: #e5e5e5;
        }

        .style-warm-modern {
            --bg-color: #f8f4e9;
            --text-color: #5a4a3a;
            --accent-color: #8b7355;
            --border-color: #e8e0d0;
        }

        .style-bold-minimal {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --accent-color: #ff6b6b;
            --border-color: #333333;
        }

        /* Style applied state */
        #portfolioPage.style-applied {
            background: var(--bg-color) !important;
            color: var(--text-color) !important;
            min-height: 100vh;
            position: relative;
            padding-bottom: 80px;
        }

        #portfolioPage.style-applied .portfolio-header {
            background: var(--bg-color) !important;
            border-bottom-color: var(--border-color) !important;
        }

        #portfolioPage.style-applied .artist-name,
        #portfolioPage.style-applied .portfolio-nav .nav-item {
            color: var(--text-color) !important;
        }

        #portfolioPage.style-applied .portfolio-nav .nav-item.active {
            color: var(--accent-color) !important;
        }

        /* PORTFOLIO TEXT STYLES */
        #portfolioPage {
            /* Header */
            --header-font-size: 24px;
            --nav-font-size: 14px;
            --header-font-family: 'Space Grotesk', sans-serif;

            /* Body */
            --titles-size: 20px;
            --desc-size: 16px;
            --artwork-size: 16px;
            --body-font-family: 'Space Grotesk', sans-serif;

            /* Footer */
            --footer-font-size: 14px;
            --footer-font-family: 'Space Grotesk', sans-serif;

            /* Colors */
            --artist-name-color: var(--text-color, #000000);
            --nav-color: var(--text-color, #666666);
            --titles-color: var(--text-color, #000000);
            --desc-color: var(--text-color, #333333);
            --artwork-details-color: var(--text-color, #333333);
            --footer-text-color: var(--text-color, #000000);

            /* Footer Contact */
            --show-footer-contact: false;
        }

        /* Header Color Applications */
        #portfolioPage.style-applied .artist-name {
            color: var(--artist-name-color);
            font-size: var(--header-font-size) !important;
            font-family: var(--header-font-family) !important;
        }

        #portfolioPage.style-applied .portfolio-nav .nav-item {
            color: var(--nav-color);
            font-size: var(--nav-font-size) !important;
            font-family: var(--header-font-family) !important;
        }

        /* Body Color Applications */
        #portfolioPage.style-applied .section-title,
        #portfolioPage.style-applied h2 {
            color: var(--titles-color);
            font-size: var(--titles-size) !important;
            font-family: var(--body-font-family) !important;
        }

        #portfolioPage.style-applied .artwork-details,
        #portfolioPage.style-applied .artwork-description,
        #portfolioPage.style-applied p {
            color: var(--desc-color);
            font-size: var(--desc-size) !important;
            font-family: var(--body-font-family) !important;
            line-height: 1.6 !important;
        }

        #portfolioPage.style-applied .artwork-title,
        #portfolioPage.style-applied .artwork-details,
        #portfolioPage.style-applied .artwork-details div {
            color: var(--artwork-details-color);
            font-size: var(--artwork-size) !important;
            font-family: var(--body-font-family) !important;
        }

        /* Footer Styles */
        footer {
            font-size: var(--footer-font-size) !important;
            font-family: var(--footer-font-family) !important;
            color: var(--footer-text-color) !important;
        }

        footer p {
            font-size: var(--footer-font-size) !important;
            font-family: var(--footer-font-family) !important;
        }

        /* Show event descriptions in portfolio */
        #portfolioPage .artwork-card .artwork-description {
            display: block !important;
            font-size: 0.8rem !important;
            color: #666 !important;
            margin-top: 0.5rem !important;
            line-height: 1.3 !important;
        }

        /* Mobile touch targets */
        @media (max-width: 768px) {
            .auth-button, 
            .add-artwork-btn,
            .btn-primary,
            .btn-secondary,
            .cta-button {
                padding: 1rem 1.5rem !important;
                min-height: 44px !important;
                font-size: 1rem !important;
            }

            .delete-btn,
            .icon-button {
                padding: 0.75rem !important;
                min-height: 44px !important;
                min-width: 44px !important;
            }

            .artworks-grid {
                grid-template-columns: 1fr !important;
                padding: 0 0.5rem !important;
                gap: 1.5rem !important;
            }
        }

        /* STYLE EDITOR STYLES */
        .style-editor-panel {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 12px 0 0 12px;
            padding: 1.5rem;
            width: 320px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .style-editor-tab {
            flex: 1;
            padding: 0.5rem;
            background: #f5f5f5;
            color: #666;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .style-editor-tab.active {
            background: #000;
            color: white;
        }

        .style-tab-content {
            display: block;
        }

        /* Toast notifications */
        #global-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333333;
            color: white;
            border: 1px solid #666666;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Event image sizing fixes */
        #portfolioPage .event-card .artwork-image {
            width: 100% !important;
            height: auto !important;
            min-height: auto !important;
            max-height: none !important;
        }

        #portfolioPage .event-card .artwork-image img {
            width: 100% !important;
            height: auto !important;
            object-fit: cover !important;
        }

        /* SVG Icon Styles */
        .social-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .social-icon:hover {
            background: #f5f5f5;
            transform: translateY(-1px);
        }

        .social-icon svg {
            width: 16px;
            height: 16px;
        }

        .icon-button svg {
            width: 16px;
            height: 16px;
        }

        /* Empty state icon styles */
        .empty-icon svg {
            opacity: 0.7;
        }

        .empty-state:hover .empty-icon svg {
            opacity: 0.9;
        }

        /* Loading states */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- LOGIN SECTION -->
    <div id="login-section">
        <div class="login-container">
            <div class="login-header">
                <div style="margin-bottom: 1.5rem;">
                    <div style="background: #000000; border-radius: 12px; padding: 1rem 1.5rem; display: inline-flex; align-items: center; justify-content: center;">
                        <h1 style="font-size: 3rem; font-weight: 600; letter-spacing: -0.02em; color: #ffffff; margin: 0; line-height: 1;">TRAC</h1>
                    </div>
                </div>
                <h1 style="font-size: 2rem; margin-bottom: 0.75rem;">Artist Portal</h1>
                <p class="tagline">Sign up or sign in to access your artist dashboard</p>
            </div>

            <!-- Sign In Form -->
            <div id="signInForm" class="auth-form">
                <div class="form-header">
                    <h2>Welcome back</h2>
                    <p>Sign in to your dashboard</p>
                </div>

                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Enter your email">
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <div style="position: relative;">
                        <input type="password" id="password" placeholder="Enter your password" style="padding-right: 2.5rem;">
                        <button type="button" onclick="togglePassword('password')" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer; padding: 0.25rem; width: 20px; height: 20px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                </div>

                <button id="signInButton" class="auth-button" onclick="signIn()">
                    <span id="signInText">Sign in</span>
                </button>

                <div style="text-align: center; margin: 1rem 0;">
                    <a href="#" onclick="requestPasswordReset()" style="color: #666; font-size: 0.8rem; text-decoration: underline;">
                        Forgot your password?
                    </a>
                </div>

                <div class="auth-switch">
                    <p>Don't have an account? <a href="#" id="switchToSignUp">Sign up</a></p>
                </div>

                <div id="message" class="message"></div>
            </div>

            <!-- Sign Up Form -->
            <div id="signUpForm" class="auth-form" style="display: none;">
                <div class="form-header">
                    <h2>Create Artist Account</h2>
                    <p>Join TRAC as an artist to manage your artwork</p>
                </div>

                <div class="form-section">
                    <h3>Name & Email</h3>
                    <div class="form-group">
                        <input type="text" id="signupFullName" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <input type="email" id="signupEmail" placeholder="Enter your email">
                    </div>
                </div>

                <div class="form-section">
                    <h3>Password</h3>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <div style="position: relative;">
                            <input type="password" id="signupPassword" placeholder="Enter your password" style="padding-right: 2.5rem;">
                            <button type="button" onclick="togglePassword('signupPassword')" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer; padding: 0.25rem; width: 20px; height: 20px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <div style="position: relative;">
                            <input type="password" id="confirmPassword" placeholder="Confirm your password" style="padding-right: 2.5rem;">
                            <button type="button" onclick="togglePassword('confirmPassword')" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer; padding: 0.25rem; width: 20px; height: 20px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="terms-group">
                    <input type="checkbox" id="agreeTerms">
                    <label for="agreeTerms">
                        I agree to the <a href="#" onclick="showTermsPopup()" style="color: #000; text-decoration: underline;">Terms of Service</a> and <a href="#" onclick="showPrivacyPopup()" style="color: #000; text-decoration: underline;">Privacy Policy</a>
                    </label>
                </div>

                <button id="signUpButton" class="auth-button" onclick="signUp()">
                    <span id="signUpText">Create Artist Account</span>
                </button>

                <div class="auth-switch">
                    <p>Already have an account? <a href="#" id="switchToSignIn">Sign in</a></p>
                </div>

                <div id="signupMessage" class="message"></div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD SECTION -->
    <div id="dashboard-section" style="display: none;">
        <header class="gallery-header">
            <div class="header-container">
                <div class="header-left">
                    <div class="logo-container">
                        <h1 class="gallery-logo">TRAC</h1>
                    </div>
                    <nav class="gallery-nav">
                        <a href="#" class="nav-item active" onclick="showSection('dashboard')">Dashboard</a>
                        <a href="#" class="nav-item" onclick="showSection('settings')">Profile Settings</a>
                        <a href="#" class="nav-item" onclick="showSection('portfolio')">Portfolio</a>
                    </nav>
                </div>
                <div class="header-right">
                    <button class="icon-button" onclick="signOut()" title="Sign Out">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M6 14H3.333C2.98 14 2.641 13.86 2.391 13.61C2.14 13.36 2 13.02 2 12.667V3.333C2 2.98 2.14 2.641 2.391 2.391C2.641 2.14 2.98 2 3.333 2H6"></path>
                            <path d="M10.667 11.333L14 8l-3.333-3.333"></path>
                            <path d="M14 8H6"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <main class="gallery-main">
            <!-- Hero Section -->
            <section class="hero-section">
                <div class="hero-container">
                    <h2 class="hero-title">Your Art Archive</h2>
                    <p class="hero-subtitle">Manage and protect your artistic legacy</p>
                </div>
            </section>

            <!-- Stats Section -->
            <section class="stats-section">
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-number" id="artworksCount">0</div>
                        <div class="stat-label">Artworks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="collectionsCount">0</div>
                        <div class="stat-label">Collections</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="eventsCount">0</div>
                        <div class="stat-label">Events</div>
                    </div>
                </div>
            </section>

            <!-- Artworks Grid Section -->
            <section class="artworks-section">
                <div class="section-header">
                    <h3 class="section-title">Your Uploaded Works</h3>
                    <button class="add-artwork-btn" onclick="showUploadForm()">+ Add Artwork</button>
                </div>

                <!-- Artworks Grid -->
                <div id="artworksGrid" class="artworks-grid">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none" stroke="#ddd" stroke-width="1.5">
                                <rect x="10" y="10" width="60" height="60" rx="4" fill="none"/>
                                <line x1="25" y1="25" x2="55" y2="55" stroke="#ddd" stroke-width="1"/>
                                <line x1="55" y1="25" x2="25" y2="55" stroke="#ddd" stroke-width="1"/>
                                <circle cx="40" cy="40" r="8" fill="none"/>
                            </svg>
                        </div>
                        <h4>No artworks yet</h4>
                        <p>Add your first artwork to start building your archive</p>
                        <button class="cta-button" onclick="showUploadForm()">Upload Your First Piece</button>
                    </div>
                </div>
            </section>

            <!-- Upload Form -->
            <div id="uploadForm" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 10000;">
                <div class="upload-form">
                    <div class="form-header">
                        <h4>Add New Artwork</h4>
                        <button class="close-form" onclick="hideUploadForm()">×</button>
                    </div>
                    <form id="artworkUploadForm">
                        <div class="form-body">
                            <div class="upload-zone" id="uploadZone">
                                <div class="upload-placeholder" id="uploadPlaceholder">
                                    <span>Drag & drop artwork image here</span>
                                    <span class="upload-subtitle">or click to browse (JPG, PNG, WebP - max 5MB)</span>
                                </div>
                                <input type="file" id="imageInput" accept="image/*" style="display: none;">
                                <div id="imagePreview" class="image-preview" style="display: none;"></div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="title">Title *</label>
                                    <input type="text" id="title" name="title" required>
                                </div>
                                <div class="form-group">
                                    <label for="year">Year</label>
                                    <input type="number" id="year" name="year" min="1900" max="2030">
                                </div>
                                <div class="form-group">
                                    <label for="medium">Medium</label>
                                    <input type="text" id="medium" name="medium" placeholder="Oil on canvas, etc.">
                                </div>
                                <div class="form-group">
                                    <label for="dimensions">Dimensions</label>
                                    <input type="text" id="dimensions" name="dimensions" placeholder="24 × 36 in">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="description">Description</label>
                                <textarea id="description" name="description" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="isPublic" name="isPublic" checked>
                                    Make this artwork public on your portfolio
                                </label>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="hideUploadForm()">Cancel</button>
                            <button type="submit" class="btn-primary" id="uploadSubmitBtn">
                                <span id="uploadSubmitText">Add Artwork</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Archived Artworks Section -->
            <section class="artworks-section" style="border-top: 1px solid #e5e5e5; padding-top: 3rem;">
                <div class="section-header">
                    <h3 class="section-title">Your Archives</h3>
                    <button class="add-artwork-btn" onclick="showArchivedPopup()">View Archived Works</button>
                </div>
            </section>

            <!-- Your Events Section -->
            <section class="artworks-section" style="border-top: 1px solid #e5e5e5; padding-top: 3rem;">
                <div class="section-header">
                    <h3 class="section-title">Your Events</h3>
                    <button class="add-artwork-btn" onclick="showAddEventForm()">+ Add Event</button>
                </div>

                <div id="eventsGrid" class="artworks-grid">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none" stroke="#ddd" stroke-width="1.5">
                                <rect x="15" y="15" width="50" height="35" rx="2" fill="none"/>
                                <rect x="20" y="55" width="40" height="15" rx="1" fill="none"/>
                                <line x1="30" y1="20" x2="50" y2="20" stroke="#ddd" stroke-width="1"/>
                                <line x1="30" y1="25" x2="50" y2="25" stroke="#ddd" stroke-width="1"/>
                                <line x1="30" y1="30" x2="40" y2="30" stroke="#ddd" stroke-width="1"/>
                            </svg>
                        </div>
                        <h4>No upcoming events</h4>
                        <p>Add exhibitions, shows, or important dates to track your artistic calendar</p>
                        <button class="cta-button" onclick="showAddEventForm()">Add Your First Event</button>
                    </div>
                </div>
            </section>           

            <!-- Activity Section -->
            <section class="activity-section">
                <div class="section-header" style="margin-bottom: 1rem;">
                    <h3 class="section-title" style="font-size: 1rem;">Recent Activity</h3>
                    <button class="add-artwork-btn" onclick="showActivityHistory()" style="font-size: 0.8rem; padding: 0.5rem 1rem;">View History</button>
                </div>
                <div class="activity-list" id="activitiesList">
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <p>Loading activities...</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Archived Works Popup -->
        <div id="archivedPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center;">
            <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 1200px; width: 90%; max-height: 80vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h3 style="margin: 0;">Archived Works</h3>
                    <button onclick="hideArchivedPopup()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">×</button>
                </div>
                <div id="archivedArtworksGrid" class="artworks-grid large">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none" stroke="#ddd" stroke-width="1.5">
                                <rect x="15" y="15" width="50" height="50" rx="2" fill="none"/>
                                <rect x="20" y="20" width="40" height="15" rx="1" fill="none"/>
                                <line x1="25" y1="45" x2="55" y2="45" stroke="#ddd" stroke-width="1"/>
                                <line x1="25" y1="55" x2="55" y2="55" stroke="#ddd" stroke-width="1"/>
                                <line x1="25" y1="65" x2="45" y2="65" stroke="#ddd" stroke-width="1"/>
                            </svg>
                        </div>
                        <h4>No archived artworks</h4>
                        <p>Archived works are hidden from your main collection but preserved.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PROFILE SETTINGS SECTION -->
    <div id="settings-section" style="display: none;">
        <header class="gallery-header">
            <div class="header-container">
                <div class="header-left">
                    <div class="logo-container">
                        <h1 class="gallery-logo">TRAC</h1>
                    </div>
                    <nav class="gallery-nav">
                        <a href="#" class="nav-item" onclick="showSection('dashboard')">Dashboard</a>
                        <a href="#" class="nav-item active">Profile Settings</a>
                        <a href="#" class="nav-item" onclick="showSection('portfolio')">Portfolio</a>
                    </nav>
                </div>
                <div class="header-right">
                    <button class="icon-button" onclick="signOut()" title="Sign Out">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M6 14H3.333C2.98 14 2.641 13.86 2.391 13.61C2.14 13.36 2 13.02 2 12.667V3.333C2 2.98 2.14 2.641 2.391 2.391C2.641 2.14 2.98 2 3.333 2H6"></path>
                            <path d="M10.667 11.333L14 8l-3.333-3.333"></path>
                            <path d="M14 8H6"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <main class="gallery-main">
            <section class="hero-section">
                <div class="hero-container">
                    <h2 class="hero-title">Profile Settings</h2>
                    <p class="hero-subtitle">Manage your artist profile and portfolio settings</p>
                </div>
            </section>

            <section class="artworks-section">
                <div class="upload-form-container">
                    <div class="upload-form">
                        <div class="form-header">
                            <h4>Artist Profile</h4>
                        </div>
                        <form id="profileSettingsForm">
                            <div class="form-body">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="username">Username *</label>
                                        <input type="text" id="username" name="username" required>
                                        <small style="color: #666; font-size: 0.8rem;">This will be your portfolio URL: trac/username</small>
                                    </div>
                                    <div class="form-group">
                                        <label>Your Portfolio Link</label>
                                        <div style="display: flex; gap: 0.5rem;">
                                            <input type="text" id="portfolioLink" readonly style="flex: 1; background: #f5f5f5;">
                                            <button type="button" onclick="copyPortfolioLink()" class="btn-secondary">Copy</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="profileFullName">Full Name *</label>
                                    <input type="text" id="profileFullName" name="fullName" required>
                                </div>

                                <div class="form-group">
                                    <label for="profilePhoto">Profile Photo</label>
                                    <input type="file" id="profilePhoto" name="profilePhoto" accept="image/*">
                                    <div id="profilePhotoPreview" style="margin-top: 0.5rem;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="bio">Artist Bio</label>
                                    <textarea id="bio" name="bio" rows="10" placeholder="Tell your artistic story..."></textarea>
                                </div>

                                <div class="form-section">
                                    <h3>Contact</h3>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="website">Website</label>
                                            <input type="url" id="website" name="website" placeholder="https://...">
                                        </div>
                                        <div class="form-group">
                                            <label for="contactEmail">Contact Email</label>
                                            <input type="email" id="contactEmail" name="contactEmail">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3>Professional Materials</h3>
                                    <div class="form-group">
                                        <label for="cvUpload">Curriculum Vitae (CV)</label>
                                        <input type="file" id="cvUpload" name="cvUpload" accept=".pdf,.doc,.docx">
                                        <div id="cvCurrentFile" style="margin-top: 0.5rem;"></div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3>Social Media</h3>
                                    <div id="socialPlatformsContainer">
                                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">No social platforms added yet</p>
                                    </div>
                                    <button type="button" class="btn-secondary" onclick="addSocialPlatform()">+ Add Platform</button>
                                </div>

                                <div class="form-section">
                                    <h3>Portfolio Display</h3>
                                    <div class="form-group">
                                        <label>Artwork Image Size</label>
                                        <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                                <input type="radio" name="imageSize" value="small"> Small
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                                <input type="radio" name="imageSize" value="medium" checked> Medium
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                                <input type="radio" name="imageSize" value="large"> Large
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3>Portfolio Styles</h3>
                                    <div class="form-group">
                                        <button type="button" onclick="showStyleBrowser()" class="btn-secondary">Browse Portfolio Styles</button>
                                        <div id="currentStyleIndicator" style="display: none; padding: 1rem; background: #f8f8f8; border-radius: 8px; border: 1px solid #e5e5e5; margin-top: 1rem;">
                                            <div style="font-size: 0.9rem; color: #666; margin-bottom: 0.25rem;">Current Style</div>
                                            <div id="currentStyleName" style="font-weight: 500;">Loading...</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3>Portfolio Collections</h3>
                                    <div id="collectionsContainer">
                                        <!-- Collections will be listed here -->
                                    </div>
                                    <button type="button" class="btn-secondary" onclick="showCreateCollectionForm()">+ New Collection</button>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="showSection('dashboard')">Back to Dashboard</button>
                                <button type="submit" class="btn-primary" id="profileSubmitBtn">
                                    <span id="profileSubmitText">Save Profile</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- PORTFOLIO SECTION -->
    <div id="portfolio-section" style="display: none;">
        <div id="portfolioPage">
            <!-- Portfolio content loads here -->
            <div style="padding: 2rem; text-align: center;">
                <h1>Loading portfolio...</h1>
            </div>
        </div>
    </div>

    <!-- STYLE BROWSER MODAL -->
    <div id="styleBrowserModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 1000px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3 style="margin: 0;">Browse Portfolio Styles</h3>
                <button onclick="hideStyleBrowser()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">×</button>
            </div>
            <div id="styleBrowserGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
                <!-- Style cards will be loaded here -->
            </div>
        </div>
    </div>

    <!-- CREATE COLLECTION FORM -->
    <div id="createCollectionForm" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 10000;">
        <div class="upload-form">
            <div class="form-header">
                <h4>Create New Collection</h4>
                <button class="close-form" onclick="hideCreateCollectionForm()">×</button>
            </div>
            <form id="collectionForm">
                <div class="form-body">
                    <div class="form-group">
                        <label for="collectionTitle">Collection Title *</label>
                        <input type="text" id="collectionTitle" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="collectionStatement">Artist Statement</label>
                        <textarea id="collectionStatement" name="statement" rows="10" placeholder="Describe this body of work..."></textarea>
                    </div>
                    <div class="form-section">
                        <h3>Add Artworks to Collection</h3>
                        <div id="availableArtworks" style="max-height: 200px; overflow-y: auto; border: 1px solid #e5e5e5; padding: 1rem; border-radius: 8px;">
                            <!-- Artworks will be listed here -->
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideCreateCollectionForm()">Cancel</button>
                    <button type="submit" class="btn-primary" id="collectionSubmitBtn">
                        <span id="collectionSubmitText">Create Collection</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ADD EVENT FORM -->
    <div id="addEventPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3 style="margin: 0;">Add New Event</h3>
                <button onclick="hideAddEventForm()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">×</button>
            </div>
            <form id="eventForm">
                <div class="form-body">
                    <div class="form-group">
                        <label for="eventTitle">Event Title *</label>
                        <input type="text" id="eventTitle" name="title" required>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="eventType">Event Type</label>
                            <select id="eventType" name="eventType">
                                <option value="exhibition">Exhibition</option>
                                <option value="show">Show</option>
                                <option value="opening">Opening Reception</option>
                                <option value="deadline">Application Deadline</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="eventDate">Event Date *</label>
                            <input type="date" id="eventDate" name="eventDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="eventLocation">Location</label>
                        <input type="text" id="eventLocation" name="location" placeholder="Gallery name, venue, or online">
                    </div>
                    <div class="form-group">
                        <label for="eventDescription">Description</label>
                        <textarea id="eventDescription" name="description" rows="4" placeholder="Describe the event..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="eventImageUpload">Event Image</label>
                        <input type="file" id="eventImageUpload" name="eventImage" accept="image/*">
                        <div id="eventImagePreview" style="margin-top: 0.5rem;"></div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideAddEventForm()">Cancel</button>
                    <button type="submit" class="btn-primary" id="eventSubmitBtn">
                        <span id="eventSubmitText">Add Event</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ACTIVITY HISTORY POPUP -->
    <div id="activityHistoryPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3 style="margin: 0;">Activity History</h3>
                <button onclick="hideActivityHistory()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">×</button>
            </div>
            <div id="activityHistoryList">
                <div class="activity-item">
                    <div class="activity-dot"></div>
                    <div class="activity-content">
                        <p>Loading history...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TERMS & PRIVACY POPUPS -->
    <div id="termsPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                <button onclick="hideTermsPopup()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; margin-right: 1rem;">←</button>
                <h3 style="margin: 0;">Terms of Service</h3>
            </div>
            <div style="line-height: 1.6;">
                <p><strong>TRAC Artist Platform Terms of Service</strong></p>
                <p>Welcome to TRAC. By using our platform, you agree to these terms...</p>
            </div>
        </div>
    </div>

    <div id="privacyPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                <button onclick="hidePrivacyPopup()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; margin-right: 1rem;">←</button>
                <h3 style="margin: 0;">Privacy Policy</h3>
            </div>
            <div style="line-height: 1.6;">
                <p><strong>TRAC Privacy Policy</strong></p>
                <p>Your privacy is important to us. This policy explains how we handle your data...</p>
            </div>
        </div>
    </div>

    <!-- ARTWORK POPUP -->
    <div id="artworkPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; align-items: center; justify-content: center;">
        <div style="position: relative; max-width: 90vw; max-height: 90vh; display: flex; align-items: center; justify-content: center;">
            <button onclick="closeArtworkPopup()" style="position: absolute; top: -40px; right: 0; background: none; border: none; color: white; font-size: 2rem; cursor: pointer; z-index: 10001;">×</button>
            <img id="popupArtworkImage" src="" style="max-width: 100%; max-height: 100%; object-fit: contain; display: block;">
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0/dist/umd/supabase.min.js"></script>
    <script>
        // ==================== TRAC CORE SYSTEM ====================
        console.log("🎯 TRAC Artist Career OS loaded");

        // Supabase Configuration
        const supabaseUrl = 'https://vhgsayaugbepugssyary.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZoZ3NheWF1Z2JlcHVnc3N5YXJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2NjA5ODMsImV4cCI6MjA3ODIzNjk4M30.2a6qJqW3BrHZxHHhM5Hm9e0sU6Bts6dXmPFW5tbrW_A';
        let supabaseClient;

        // Global State Management
        let currentArtworks = [];
        let cachedPortfolioData = null;
        let cachedArtworksData = null;
        let cachedCollectionsData = null;
        let cachedEventsData = null;
        let selectedImageFile = null;
        let selectedEventImageFile = null;

        // Activity Types
        const ACTIVITY_TYPES = {
            ARTWORK_UPLOAD: 'artwork_upload',
            ARTWORK_ARCHIVE: 'artwork_archive', 
            ARTWORK_DELETE: 'artwork_delete',
            ARTWORK_RESTORE: 'artwork_restore',
            COLLECTION_CREATE: 'collection_create',
            COLLECTION_DELETE: 'collection_delete',
            PROFILE_UPDATE: 'profile_update',
            EVENT_CREATE: 'event_create'
        };

        // Style Presets System
        const STYLE_PRESETS = {
            'guerrilla-minimal': {
                id: 'guerrilla-minimal',
                name: 'Guerrilla Minimal',
                fonts: { primary: 'Helvetica', secondary: 'Courier New' },
                colors: { 
                    bg: '#0a0a0a', 
                    text: '#ffffff', 
                    accent: '#ff0000',
                    border: '#333333'
                },
                layout: 'stacked-minimal'
            },
            'elegant-gallery': {
                id: 'elegant-gallery',
                name: 'Elegant Gallery', 
                fonts: { primary: 'Georgia', secondary: 'Helvetica' },
                colors: { 
                    bg: '#f8f8f8', 
                    text: '#2a2a2a', 
                    accent: '#8b7355',
                    border: '#e0e0e0'
                },
                layout: 'grid-classic'
            },
            'experimental-immersive': {
                id: 'experimental-immersive',
                name: 'Experimental Immersive',
                fonts: { primary: 'Space Grotesk', secondary: 'Inter' },
                colors: { 
                    bg: '#1a1a2e', 
                    text: '#e6e6e6', 
                    accent: '#00b4d8',
                    border: '#2d3047'
                },
                layout: 'portfolio-focused'
            }
        };

        // Social Platforms Configuration
        const availablePlatforms = ['instagram', 'arena', 'twitter', 'tiktok', 'substack', 'linkedin', 'facebook', 'youtube', 'vimeo', 'spotify'];
        const socialIcons = {
            instagram: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                <circle cx="12" cy="12" r="5"></circle>
                <circle cx="18" cy="6" r="1"></circle>
            </svg>`,
            
            arena: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>`,
            
            twitter: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
            </svg>`,
            
            tiktok: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12a4 4 0 1 0 4 4V4a5 5 0 0 0 5 5"></path>
            </svg>`,
            
            substack: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="4" y="4" width="16" height="16" rx="2"></rect>
                <line x1="8" y1="8" x2="16" y2="8"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
                <line x1="8" y1="16" x2="12" y2="16"></line>
            </svg>`
        };

        let favoriteStyles = [];
        let generatedStyles = [];

                // ==================== CORE INITIALIZATION ====================
                async function initializeApp() {
                    try {
                        // Wait for Supabase to be available
                        if (typeof supabase === 'undefined') {
                            console.error('❌ Supabase library not loaded');
                            return;
                        }

                        supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
                        console.log("✅ Supabase client initialized");

                // Setup auth state change listener for profile auto-creation
                supabaseClient.auth.onAuthStateChange(async (event, session) => {
                    if (event === 'SIGNED_IN' && session?.user) {
                        await handleNewUser(session.user);
                    }
                });

                // Check authentication state
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (user) {
                    showSection('dashboard');
                } else {
                    showSection('login');
                }

                // Setup real-time subscriptions
                setupActivitiesRealtime();

            } catch (error) {
                console.error('Error initializing app:', error);
                showToast('Error initializing application', 'error');
            }
        }

        // ==================== PROFILE AUTO-CREATION ====================
        async function handleNewUser(user) {
            try {
                // Check if profile already exists
                const { data: existingProfile, error: checkError } = await supabaseClient
                    .from('profiles')
                    .select('id')
                    .eq('id', user.id)
                    .single();

                if (checkError && checkError.code !== 'PGRST116') { // PGRST116 = no rows returned
                    console.error('Error checking profile:', checkError);
                    return;
                }

                // Create profile if it doesn't exist
                if (!existingProfile) {
                    const { error } = await supabaseClient
                        .from('profiles')
                        .insert([
                            {
                                id: user.id,
                                username: user.email.split('@')[0],
                                full_name: user.user_metadata?.full_name || user.email.split('@')[0],
                                created_at: new Date().toISOString()
                            }
                        ]);
                    
                    if (error) {
                        console.error('Profile creation error:', error);
                    } else {
                        console.log('✅ Profile auto-created for user:', user.id);
                    }
                }
            } catch (error) {
                console.error('Error in handleNewUser:', error);
            }
        }

        // ==================== AUTHENTICATION SYSTEM ====================
        async function signIn() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const message = document.getElementById('message');
            const button = document.getElementById('signInButton');
            const buttonText = document.getElementById('signInText');

            if (!email || !password) {
                showToast('Please enter email and password', 'error');
                return;
            }

            // Set loading state
            button.disabled = true;
            buttonText.innerHTML = '<span class="loading-spinner"></span> Signing in...';

            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) {
                    showToast('Sign in failed: ' + error.message, 'error');
                } else {
                    showToast('Welcome back!');
                    showSection('dashboard');
                }
            } catch (error) {
                showToast('Sign in failed: ' + error.message, 'error');
            } finally {
                // Reset loading state
                button.disabled = false;
                buttonText.textContent = 'Sign in';
            }
        }

        async function signUp() {
            const fullName = document.getElementById('signupFullName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;
            const message = document.getElementById('signupMessage');
            const button = document.getElementById('signUpButton');
            const buttonText = document.getElementById('signUpText');

            if (!fullName || !email || !password || !confirmPassword) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }

            if (!agreeTerms) {
                showToast('Please agree to the Terms and Privacy Policy', 'error');
                return;
            }

            // Set loading state
            button.disabled = true;
            buttonText.innerHTML = '<span class="loading-spinner"></span> Creating account...';

            try {
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: { full_name: fullName }
                    }
                });

                if (error) {
                    showToast('Sign up failed: ' + error.message, 'error');
                } else {
                    showToast('Account created! Please check your email to verify.');
                    showSignInForm();
                }
            } catch (error) {
                showToast('Sign up failed: ' + error.message, 'error');
            } finally {
                // Reset loading state
                button.disabled = false;
                buttonText.textContent = 'Create Artist Account';
            }
        }

        async function signOut() {
            try {
                const { error } = await supabaseClient.auth.signOut();
                if (error) {
                    showToast('Error signing out', 'error');
                } else {
                    showToast('Signed out successfully');
                    showSection('login');
                }
            } catch (error) {
                showToast('Error signing out', 'error');
            }
        }

        // ==================== PORTFOLIO SYSTEM ====================
        async function loadPortfolio() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) {
                    showSection('login');
                    return;
                }

                // Clear cache for fresh data
                clearPortfolioCache();

                // Load all portfolio data in parallel
                const [profileResult, artworksResult, collectionsResult, eventsResult] = await Promise.all([
                    supabaseClient.from('profiles').select('*').eq('id', user.id).single(),
                    supabaseClient.from('artworks').select('*').eq('artist_id', user.id).eq('is_public', true).order('created_at', { ascending: false }),
                    supabaseClient.from('collections').select('*, artwork_collections(artworks(*))').eq('artist_id', user.id).eq('is_public', true),
                    supabaseClient.from('events').select('*').eq('artist_id', user.id).eq('is_public', true).gte('event_date', new Date().toISOString().split('T')[0])
                ]);

                // Handle errors gracefully
                const profile = profileResult.error ? await createDefaultProfile(user) : profileResult.data;
                const artworks = artworksResult.error ? [] : artworksResult.data;
                const collections = collectionsResult.error ? [] : collectionsResult.data;
                const events = eventsResult.error ? [] : eventsResult.data;

                // Update cache
                cachedPortfolioData = profile;
                cachedArtworksData = artworks;
                cachedCollectionsData = collections;
                cachedEventsData = events;

                // Apply any saved styles
                applySavedStyles(cachedPortfolioData);

                // Display portfolio
                displayPortfolio(cachedPortfolioData, cachedArtworksData, cachedCollectionsData, cachedEventsData);

            } catch (error) {
                console.error('Error loading portfolio:', error);
                showToast('Error loading portfolio', 'error');
                
                // Fallback: Show basic portfolio even if data fails
                const fallbackProfile = await createDefaultProfile({ id: 'fallback', email: 'user@example.com' });
                displayPortfolio(fallbackProfile, [], [], []);
            }
        }

        async function createDefaultProfile(user) {
            return {
                id: user.id,
                username: user.email.split('@')[0],
                full_name: user.user_metadata?.full_name || user.email.split('@')[0],
                bio: '',
                website: '',
                contact_email: user.email,
                portfolio_style: 'elegant-gallery',
                portfolio_layout: 'grid-classic',
                created_at: new Date().toISOString()
            };
        }

        function displayPortfolio(profile, artworks, collections = [], events = []) {
            const isOwner = true;

            const portfolioHTML = `
                <header class="portfolio-header">
                    <div class="header-container">
                        <div class="header-left">
                            <div class="artist-name">${profile.full_name || profile.username}</div>
                            <nav class="gallery-nav">
                                <a href="#" class="nav-item" onclick="showSection('dashboard')">Dashboard</a>
                            </nav>
                        </div>
                        <div class="header-right">
                            <nav class="portfolio-nav">
                                <a href="#" class="nav-item active" data-tab="works">Works</a>
                                <a href="#" class="nav-item" data-tab="profile">Profile</a>
                                <a href="#" class="nav-item" data-tab="events">Events</a>
                            </nav>
                            ${isOwner ? `
                                <button class="icon-button" onclick="toggleStyleEditor()" title="Customize Portfolio">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M8 2l2 4 4 1-2 4 2 4-4-1-2 4-2-4-4 1 2-4-2-4 4 1z"></path>
                                    </svg>
                                </button>
                                <button class="icon-button" onclick="signOut()" title="Sign Out">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M6 14H3.333C2.98 14 2.641 13.86 2.391 13.61C2.14 13.36 2 13.02 2 12.667V3.333C2 2.98 2.14 2.641 2.391 2.391C2.641 2.14 2.98 2 3.333 2H6"></path>
                                        <path d="M10.667 11.333L14 8l-3.333-3.333"></path>
                                        <path d="M14 8H6"></path>
                                    </svg>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </header>

                <main class="gallery-main">
                    <!-- Works Section -->
                    <section id="works-section" class="portfolio-tab">
                        <section class="artworks-section">
                            ${artworks.length > 0 ? `
                                <div class="artworks-grid portfolio-layout ${profile.portfolio_layout || 'grid-classic'}">
                                    ${artworks.map(artwork => `
                                        <div class="artwork-card">
                                            <div class="artwork-image">
                                                <img src="${artwork.image_url}" alt="${artwork.title}" onclick="openArtworkPopup('${artwork.image_url}')">
                                            </div>
                                            <div class="artwork-info">
                                                <h3 class="artwork-title">${artwork.title || 'Untitled'}</h3>
                                                <div class="artwork-details">
                                                    ${artwork.year ? `<div>${artwork.year}</div>` : ''}
                                                    ${artwork.medium ? `<div>${artwork.medium}</div>` : ''}
                                                    ${artwork.dimensions ? `<div>${artwork.dimensions}</div>` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="empty-state">
                                    <div class="empty-icon">
                                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none" stroke="#ddd" stroke-width="1.5">
                                            <rect x="10" y="10" width="60" height="60" rx="4" fill="none"/>
                                            <line x1="25" y1="25" x2="55" y2="55" stroke="#ddd" stroke-width="1"/>
                                            <line x1="55" y1="25" x2="25" y2="55" stroke="#ddd" stroke-width="1"/>
                                            <circle cx="40" cy="40" r="8" fill="none"/>
                                        </svg>
                                    </div>
                                    <h4>No public artworks yet</h4>
                                    <p>Add artworks and make them public to see them here.</p>
                                </div>
                            `}
                        </section>
                    </section>

                    <!-- Profile Section -->
                    <section id="profile-section" class="portfolio-tab" style="display: none;">
                        <div class="hero-section">
                            <div class="hero-container">
                                <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                                    ${profile.bio ? `
                                        <p style="font-size: 1.1rem; line-height: 1.6; color: #333;">${profile.bio}</p>
                                    ` : `
                                        <p style="color: #666; font-style: italic;">Artist profile</p>
                                    `}
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Events Section -->
                    <section id="events-section" class="portfolio-tab" style="display: none;">
                        <section class="artworks-section">
                            ${events.length > 0 ? `
                                <div class="artworks-grid">
                                    ${events.map(event => `
                                        <div class="event-card">
                                            <div class="event-date">${new Date(event.event_date).toLocaleDateString()}</div>
                                            <div class="event-title">${event.title}</div>
                                            ${event.location ? `<div class="event-location">📍 ${event.location}</div>` : ''}
                                            ${event.description ? `<div class="event-description">${event.description}</div>` : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="empty-state">
                                    <div class="empty-icon">
                                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none" stroke="#ddd" stroke-width="1.5">
                                            <rect x="15" y="15" width="50" height="35" rx="2" fill="none"/>
                                            <rect x="20" y="55" width="40" height="15" rx="1" fill="none"/>
                                            <line x1="30" y1="20" x2="50" y2="20" stroke="#ddd" stroke-width="1"/>
                                            <line x1="30" y1="25" x2="50" y2="25" stroke="#ddd" stroke-width="1"/>
                                            <line x1="30" y1="30" x2="40" y2="30" stroke="#ddd" stroke-width="1"/>
                                        </svg>
                                    </div>
                                    <h4>No upcoming events</h4>
                                    <p>There are no scheduled events at the moment.</p>
                                </div>
                            `}
                        </section>
                    </section>
                </main>

                <!-- Style Editor Panel -->
                <div id="styleEditor" class="style-editor-panel" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h4 style="margin: 0; font-size: 1rem; font-weight: 500;">Customize Portfolio</h4>
                        <button class="close-form" onclick="toggleStyleEditor()">×</button>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
                        <button class="style-editor-tab active" onclick="switchStyleTab('colors')">Colors</button>
                        <button class="style-editor-tab" onclick="switchStyleTab('text')">Text</button>
                        <button class="style-editor-tab" onclick="switchStyleTab('layout')">Layout</button>
                    </div>
                    
                    <div id="colors-tab" class="style-tab-content">
                        <h3 style="font-size: 0.85rem; margin-bottom: 1rem;">Color Settings</h3>
                        <div class="form-group">
                            <label>Background Color</label>
                            <input type="color" id="bgColor" value="#ffffff" style="width: 100%; height: 40px;">
                        </div>
                        <div class="form-group">
                            <label>Text Color</label>
                            <input type="color" id="textColor" value="#000000" style="width: 100%; height: 40px;">
                        </div>
                        <div class="form-group">
                            <label>Artist Name Color</label>
                            <input type="color" id="artistNameColor" value="#000000" style="width: 100%; height: 40px;">
                        </div>
                        <div class="form-group">
                            <label>Navigation Color</label>
                            <input type="color" id="navColor" value="#666666" style="width: 100%; height: 40px;">
                        </div>
                    </div>
                    
                    <div id="text-tab" class="style-tab-content" style="display: none;">
                        <h3 style="font-size: 0.85rem; margin-bottom: 1rem;">Text Settings</h3>
                        <div class="form-group">
                            <label>Font Family</label>
                            <select id="fontFamily" style="width: 100%; padding: 0.5rem;">
                                <option value="Space Grotesk">Space Grotesk</option>
                                <option value="Helvetica">Helvetica</option>
                                <option value="Georgia">Georgia</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Artist Name Size</label>
                            <input type="range" id="headerFontSize" min="16" max="32" value="24">
                            <span id="headerFontSizeValue">24px</span>
                        </div>
                        <div class="form-group">
                            <label>Navigation Size</label>
                            <input type="range" id="navFontSize" min="12" max="18" value="14">
                            <span id="navFontSizeValue">14px</span>
                        </div>
                    </div>
                    
                    <div id="layout-tab" class="style-tab-content" style="display: none;">
                        <h3 style="font-size: 0.85rem; margin-bottom: 1rem;">Layout Settings</h3>
                        <div class="form-group">
                            <label>Grid Layout</label>
                            <select id="gridLayout" style="width: 100%; padding: 0.5rem;">
                                <option value="grid-classic">Classic Grid</option>
                                <option value="grid-masonry">Masonry</option>
                                <option value="stacked-minimal">Stacked</option>
                                <option value="card-modern">Modern Cards</option>
                                <option value="magazine">Magazine</option>
                                <option value="portfolio-focused">Portfolio Focused</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-actions" style="margin-top: 1.5rem;">
                        <button type="button" class="btn-primary" onclick="saveCustomizations()" style="width: 100%;">Apply Changes</button>
                    </div>
                </div>
            `;

            document.getElementById('portfolioPage').innerHTML = portfolioHTML;
            setupPortfolioNavigation();
        }

        // ==================== STYLE SYSTEM ====================
        function toggleStyleEditor() {
            const editor = document.getElementById('styleEditor');
            if (editor.style.display === 'none') {
                editor.style.display = 'block';
                loadCurrentStyles();
            } else {
                editor.style.display = 'none';
            }
        }

        function switchStyleTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.style-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            // Show selected tab
            document.getElementById(tabName + '-tab').style.display = 'block';
            
            // Update tab buttons
            document.querySelectorAll('.style-editor-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function loadCurrentStyles() {
            const portfolioPage = document.getElementById('portfolioPage');
            if (!portfolioPage) return;

            const computedStyle = getComputedStyle(portfolioPage);

            // Load current colors with fallbacks
            document.getElementById('bgColor').value = rgbToHex(computedStyle.backgroundColor) || '#ffffff';
            document.getElementById('textColor').value = rgbToHex(computedStyle.color) || '#000000';
            
            // Load current font with fallback
            document.getElementById('fontFamily').value = computedStyle.fontFamily?.replace(/['"]/g, '').split(',')[0].trim() || 'Space Grotesk';
            
            // Load current layout with fallback
            const currentLayout = cachedPortfolioData?.portfolio_layout || 'grid-classic';
            document.getElementById('gridLayout').value = currentLayout;

            // Load font sizes with fallbacks
            document.getElementById('headerFontSize').value = parseInt(getComputedStyle(portfolioPage).getPropertyValue('--header-font-size') || '24');
            document.getElementById('navFontSize').value = parseInt(getComputedStyle(portfolioPage).getPropertyValue('--nav-font-size') || '14');
            
            // Update display values
            document.getElementById('headerFontSizeValue').textContent = document.getElementById('headerFontSize').value + 'px';
            document.getElementById('navFontSizeValue').textContent = document.getElementById('navFontSize').value + 'px';
        }

        async function saveCustomizations() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const updateData = {
                    portfolio_layout: document.getElementById('gridLayout').value,
                    custom_colors: {
                        bg: document.getElementById('bgColor').value,
                        text: document.getElementById('textColor').value,
                        artistName: document.getElementById('artistNameColor').value,
                        nav: document.getElementById('navColor').value
                    },
                    custom_fonts: {
                        family: document.getElementById('fontFamily').value,
                        headerSize: document.getElementById('headerFontSize').value,
                        navSize: document.getElementById('navFontSize').value
                    }
                };

                const { error } = await supabaseClient
                    .from('profiles')
                    .update(updateData)
                    .eq('id', user.id);

                if (error) throw error;

                showToast('Customizations saved');
                clearPortfolioCache();
                loadPortfolio();

            } catch (error) {
                console.error('Error saving customizations:', error);
                showToast('Error saving customizations', 'error');
            }
        }

        function applySavedStyles(profile) {
            const portfolioPage = document.getElementById('portfolioPage');
            if (!portfolioPage || !profile) return;

            // Apply portfolio style if set
            if (profile.portfolio_style && STYLE_PRESETS[profile.portfolio_style]) {
                const style = STYLE_PRESETS[profile.portfolio_style];
                portfolioPage.classList.add('style-applied', `style-${profile.portfolio_style}`);
                
                // Apply CSS variables
                portfolioPage.style.setProperty('--bg-color', style.colors.bg);
                portfolioPage.style.setProperty('--text-color', style.colors.text);
                portfolioPage.style.setProperty('--accent-color', style.colors.accent);
                portfolioPage.style.setProperty('--border-color', style.colors.border);
            }

            // Apply custom colors if set
            if (profile.custom_colors) {
                Object.entries(profile.custom_colors).forEach(([key, value]) => {
                    portfolioPage.style.setProperty(`--${key}-color`, value);
                });
            }

            // Apply custom fonts if set
            if (profile.custom_fonts) {
                Object.entries(profile.custom_fonts).forEach(([key, value]) => {
                    if (key === 'family') {
                        portfolioPage.style.setProperty('--body-font-family', value);
                        portfolioPage.style.setProperty('--header-font-family', value);
                    } else {
                        portfolioPage.style.setProperty(`--${key}`, value + (key.includes('Size') ? 'px' : ''));
                    }
                });
            }

            // Apply layout if set
            if (profile.portfolio_layout) {
                // Layout will be applied through CSS classes in displayPortfolio
            }
        }

        // ==================== STYLE BROWSER ====================
        function showStyleBrowser() {
            document.getElementById('styleBrowserModal').style.display = 'flex';
            loadStyleBrowser();
        }

        function hideStyleBrowser() {
            document.getElementById('styleBrowserModal').style.display = 'none';
        }

        function loadStyleBrowser() {
            const container = document.getElementById('styleBrowserGrid');
            container.innerHTML = Object.values(STYLE_PRESETS).map(style => `
                <div class="style-card" style="border: 1px solid #e5e5e5; border-radius: 12px; padding: 1.5rem; transition: all 0.2s ease;">
                    <div style="background: ${style.colors.bg}; color: ${style.colors.text}; padding: 2rem; border-radius: 8px; margin-bottom: 1rem; text-align: center; font-family: '${style.fonts.primary}', sans-serif; cursor: pointer; border: 2px solid transparent; transition: border-color 0.2s ease;" 
                         onclick="previewStyle('${style.id}')"
                         onmouseover="this.style.borderColor='${style.colors.accent}'"
                         onmouseout="this.style.borderColor='transparent'">
                        <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">${style.name}</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">${style.layout.replace('-', ' ')}</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">${style.name}</div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem;">${Object.values(style.fonts).join(' + ')}</div>
                        </div>
                        <button type="button" class="heart-btn" onclick="toggleFavorite('${style.id}')" style="background: none; border: none; cursor: pointer; font-size: 1.2rem; color: ${favoriteStyles.includes(style.id) ? '#ff6b6b' : '#ddd'}">
                            ${favoriteStyles.includes(style.id) ? '❤️' : '🤍'}
                        </button>
                    </div>
                    <button type="button" onclick="applyStyle('${style.id}')" class="btn-primary" style="width: 100%;">
                        Apply Style
                    </button>
                </div>
            `).join('');
        }

        async function applyStyle(styleId) {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const style = STYLE_PRESETS[styleId];
                if (!style) return;

                // Get current customizations first
                const { data: currentProfile } = await supabaseClient
                    .from('profiles')
                    .select('portfolio_style, portfolio_layout, custom_colors, custom_fonts')
                    .eq('id', user.id)
                    .single();

                // Merge new style with existing customizations
                const updateData = {
                    portfolio_style: styleId,
                    portfolio_layout: style.layout,
                    // Preserve custom colors/fonts if they exist
                    custom_colors: currentProfile?.custom_colors || {},
                    custom_fonts: currentProfile?.custom_fonts || {}
                };

                const { error } = await supabaseClient
                    .from('profiles')
                    .update(updateData)
                    .eq('id', user.id);

                if (error) throw error;

                showToast(`${style.name} applied - customizations preserved`);
                hideStyleBrowser();
                clearPortfolioCache();
                loadPortfolio();

            } catch (error) {
                console.error('Error applying style:', error);
                showToast('Error applying style', 'error');
            }
        }

        // ==================== ARTWORK MANAGEMENT ====================
        function showUploadForm() {
            document.getElementById('uploadForm').style.display = 'block';
        }

        function hideUploadForm() {
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('artworkUploadForm').reset();
            clearImageSelection();
        }

        async function uploadArtwork() {
            const submitBtn = document.getElementById('uploadSubmitBtn');
            const submitText = document.getElementById('uploadSubmitText');

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) throw new Error('Not authenticated');

                const formData = new FormData(document.getElementById('artworkUploadForm'));
                const title = document.getElementById('title').value;

                if (!title) {
                    showToast('Please enter a title', 'error');
                    return;
                }

                if (!selectedImageFile) {
                    showToast('Please select an image', 'error');
                    return;
                }

                // Set loading state
                submitBtn.disabled = true;
                submitText.innerHTML = '<span class="loading-spinner"></span> Uploading...';

                // Upload image
                const imageName = `${user.id}/${Date.now()}_${selectedImageFile.name}`;
                const { data: imageData, error: uploadError } = await supabaseClient.storage
                    .from('artwork-images')
                    .upload(imageName, selectedImageFile);

                if (uploadError) throw uploadError;

                const { data: { publicUrl } } = supabaseClient.storage
                    .from('artwork-images')
                    .getPublicUrl(imageData.path);

                // Create artwork record
                const artworkData = {
                    artist_id: user.id,
                    title: title,
                    year: formData.get('year') || null,
                    medium: formData.get('medium') || '',
                    dimensions: formData.get('dimensions') || '',
                    description: formData.get('description') || '',
                    image_url: publicUrl,
                    is_public: document.getElementById('isPublic').checked
                };

                const { data, error } = await supabaseClient
                    .from('artworks')
                    .insert([artworkData])
                    .select();

                if (error) throw error;

                // Log activity
                await logActivity(ACTIVITY_TYPES.ARTWORK_UPLOAD, `Uploaded artwork: ${title}`);

                showToast('Artwork added successfully');
                hideUploadForm();
                clearImageSelection();
                clearPortfolioCache();
                fetchUserArtworks();

            } catch (error) {
                console.error('Error uploading artwork:', error);
                showToast('Error uploading artwork: ' + error.message, 'error');
            } finally {
                // Reset loading state
                submitBtn.disabled = false;
                submitText.textContent = 'Add Artwork';
            }
        }

        // ==================== EVENT MANAGEMENT ====================
        function showAddEventForm() {
            document.getElementById('addEventPopup').style.display = 'flex';
        }

        function hideAddEventForm() {
            document.getElementById('addEventPopup').style.display = 'none';
            document.getElementById('eventForm').reset();
            clearEventImageSelection();
        }

        async function createEvent(eventData) {
            const submitBtn = document.getElementById('eventSubmitBtn');
            const submitText = document.getElementById('eventSubmitText');

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) throw new Error('Not authenticated');

                let imageUrl = null;
                
                // Set loading state
                submitBtn.disabled = true;
                submitText.innerHTML = '<span class="loading-spinner"></span> Creating...';

                // Upload event image if selected
                if (selectedEventImageFile) {
                    const imageName = `events/${user.id}/${Date.now()}_${selectedEventImageFile.name}`;
                    const { data: imageData, error: uploadError } = await supabaseClient.storage
                        .from('event-images')
                        .upload(imageName, selectedEventImageFile);

                    if (uploadError) throw uploadError;

                    const { data: { publicUrl } } = supabaseClient.storage
                        .from('event-images')
                        .getPublicUrl(imageData.path);
                        
                    imageUrl = publicUrl;
                }

                const eventRecord = {
                    artist_id: user.id,
                    title: eventData.title,
                    event_type: eventData.eventType,
                    event_date: eventData.eventDate,
                    location: eventData.location,
                    description: eventData.description,
                    image_url: imageUrl,
                    is_public: true
                };

                const { data, error } = await supabaseClient
                    .from('events')
                    .insert([eventRecord])
                    .select();

                if (error) throw error;

                // Log activity
                await logActivity(ACTIVITY_TYPES.EVENT_CREATE, `Created event: ${eventData.title}`);
                
                showToast('Event added successfully');
                hideAddEventForm();
                clearPortfolioCache();
                fetchUserEvents();

            } catch (error) {
                console.error('Error creating event:', error);
                showToast('Error creating event: ' + error.message, 'error');
            } finally {
                // Reset loading state
                submitBtn.disabled = false;
                submitText.textContent = 'Add Event';
            }
        }

        // ==================== COLLECTION MANAGEMENT ====================
        function showCreateCollectionForm() {
            document.getElementById('createCollectionForm').style.display = 'block';
            loadAvailableArtworks();
        }

        function hideCreateCollectionForm() {
            document.getElementById('createCollectionForm').style.display = 'none';
            document.getElementById('collectionForm').reset();
        }

        async function loadAvailableArtworks(currentArtworkIds = []) {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const { data: artworks, error } = await supabaseClient
                    .from('artworks')
                    .select('id, title, image_url, year')
                    .eq('artist_id', user.id)
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Error loading artworks:', error);
                    document.getElementById('availableArtworks').innerHTML = '<p>Error loading artworks</p>';
                    return;
                }

                const availableArtworksHTML = artworks && artworks.length > 0 ? artworks.map(artwork => `
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 0.5rem; border-bottom: 1px solid #f0f0f0;">
                        <input type="checkbox" id="artwork-${artwork.id}" name="artworks" value="${artwork.id}" 
                               ${currentArtworkIds.includes(artwork.id) ? 'checked' : ''}>
                        <img src="${artwork.image_url}" alt="${artwork.title}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                        <div>
                            <div style="font-weight: 500; font-size: 0.9rem;">${artwork.title}</div>
                            ${artwork.year ? `<div style="font-size: 0.8rem; color: #666;">${artwork.year}</div>` : ''}
                        </div>
                    </div>
                `).join('') : '<p>No artworks available</p>';

                document.getElementById('availableArtworks').innerHTML = availableArtworksHTML;

            } catch (error) {
                console.error('Error loading artworks:', error);
                document.getElementById('availableArtworks').innerHTML = '<p>Error loading artworks</p>';
            }
        }

        async function createCollection(collectionData) {
            const submitBtn = document.getElementById('collectionSubmitBtn');
            const submitText = document.getElementById('collectionSubmitText');

            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) throw new Error('Not authenticated');

                // Set loading state
                submitBtn.disabled = true;
                submitText.innerHTML = '<span class="loading-spinner"></span> Creating...';

                // Create collection
                const { data: collection, error } = await supabaseClient
                    .from('collections')
                    .insert([{
                        artist_id: user.id,
                        name: collectionData.name,
                        statement: collectionData.statement,
                        is_public: true
                    }])
                    .select()
                    .single();

                if (error) throw error;

                // Add selected artworks to collection
                const selectedArtworks = Array.from(document.querySelectorAll('input[name="artworks"]:checked'))
                    .map(checkbox => checkbox.value);

                if (selectedArtworks.length > 0) {
                    const artworkConnections = selectedArtworks.map(artworkId => ({
                        collection_id: collection.id,
                        artwork_id: artworkId
                    }));

                    const { error: connectionError } = await supabaseClient
                        .from('artwork_collections')
                        .insert(artworkConnections);

                    if (connectionError) throw connectionError;
                }

                // Log activity
                await logActivity(ACTIVITY_TYPES.COLLECTION_CREATE, `Created collection: ${collectionData.name}`, `With ${selectedArtworks.length} artworks`);

                showToast('Collection created successfully');
                hideCreateCollectionForm();
                clearPortfolioCache();
                loadProfileData(); // Refresh collections list

            } catch (error) {
                console.error('Error creating collection:', error);
                showToast('Error creating collection: ' + error.message, 'error');
            } finally {
                // Reset loading state
                submitBtn.disabled = false;
                submitText.textContent = 'Create Collection';
            }
        }

        // ==================== SOCIAL PLATFORM MANAGEMENT ====================
        function addSocialPlatform(platform = '', username = '') {
            const container = document.getElementById('socialPlatformsContainer');
            
            const platformSelect = Object.keys(socialIcons).map(p => 
                `<option value="${p}" ${p === platform ? 'selected' : ''}>${p}</option>`
            ).join('');

            const newPlatformHTML = `
                <div class="social-platform-item">
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <div style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                            ${socialIcons[platform] || '🔗'}
                        </div>
                        <select onchange="updateSocialPlatformIcon(this)" style="padding: 0.5rem; border-radius: 6px; border: 1px solid #d1d1d1;">
                            <option value="">Select platform...</option>
                            ${platformSelect}
                        </select>
                        <input type="text" placeholder="username" value="${username}" 
                               onchange="updateSocialPlatform(this.previousElementSibling.value, this.value)">
                        <button onclick="this.parentElement.parentElement.remove()" class="delete-btn">Remove</button>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', newPlatformHTML);
        }

        function updateSocialPlatform(platform, username) {
            if (!platform || !username) return;
            
            // Update in database
            saveSocialPlatforms();
        }

        async function saveSocialPlatforms() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const socialLinks = {};
                document.querySelectorAll('.social-platform-item').forEach(item => {
                    const platform = item.querySelector('select').value;
                    const username = item.querySelector('input[type="text"]').value;
                    if (platform && username) {
                        socialLinks[platform] = username;
                    }
                });

                const { error } = await supabaseClient
                    .from('profiles')
                    .update({ social_links: socialLinks })
                    .eq('id', user.id);

                if (error) throw error;

                showToast('Social platforms updated');

            } catch (error) {
                console.error('Error saving social platforms:', error);
                showToast('Error saving social platforms', 'error');
            }
        }

        // ==================== ACTIVITY SYSTEM ====================
        async function logActivity(type, title, description = null, metadata = {}) {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const activityData = {
                    artist_id: user.id,
                    activity_type: type,
                    title: title,
                    description: description,
                    metadata: metadata,
                    created_at: new Date().toISOString()
                };

                const { error } = await supabaseClient
                    .from('activities')
                    .insert([activityData]);

                if (error) throw error;

            } catch (error) {
                console.error('Error logging activity:', error);
            }
        }

        async function fetchActivities(limit = 10) {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return [];

                const { data: activities, error } = await supabaseClient
                    .from('activities')
                    .select('*')
                    .eq('artist_id', user.id)
                    .order('created_at', { ascending: false })
                    .limit(limit);

                if (error) {
                    console.error('Error fetching activities:', error);
                    return [];
                }

                return activities || [];

            } catch (error) {
                console.error('Error fetching activities:', error);
                return [];
            }
        }

        function displayActivities(activities) {
            const container = document.getElementById('activitiesList');
            if (!container) return;

            if (!activities || activities.length === 0) {
                container.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <p>No recent activity</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-dot"></div>
                    <div class="activity-content">
                        <p>${activity.title}</p>
                        ${activity.description ? `<p style="color: #666;">${activity.description}</p>` : ''}
                        <div class="activity-time">${formatActivityTime(activity.created_at)}</div>
                    </div>
                </div>
            `).join('');
        }

        function formatActivityTime(timestamp) {
            if (!timestamp) return 'Recently';
            
            const now = new Date();
            const activityTime = new Date(timestamp);
            const diffMs = now - activityTime;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return activityTime.toLocaleDateString();
        }

        // ==================== DASHBOARD DATA INTEGRATION ====================
        async function fetchUserArtworks() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return [];

                const { data: artworks, error } = await supabaseClient
                    .from('artworks')
                    .select('*')
                    .eq('artist_id', user.id)
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Error fetching artworks:', error);
                    return [];
                }

                currentArtworks = artworks || [];
                displayArtworksGrid(currentArtworks);
                updateStats();
                return currentArtworks;

            } catch (error) {
                console.error('Error fetching artworks:', error);
                return [];
            }
        }

        async function fetchUserEvents() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return [];

                const { data: events, error } = await supabaseClient
                    .from('events')
                    .select('*')
                    .eq('artist_id', user.id)
                    .order('event_date', { ascending: true });

                if (error) {
                    console.error('Error fetching events:', error);
                    return [];
                }

                displayEventsGrid(events || []);
                updateStats();
                return events || [];

            } catch (error) {
                console.error('Error fetching events:', error);
                return [];
            }
        }

        function displayArtworksGrid(artworks) {
            const grid = document.getElementById('artworksGrid');
            if (!grid) return;

            if (!artworks || artworks.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none" stroke="#ddd" stroke-width="1.5">
                                <rect x="10" y="10" width="60" height="60" rx="4" fill="none"/>
                                <line x1="25" y1="25" x2="55" y2="55" stroke="#ddd" stroke-width="1"/>
                                <line x1="55" y1="25" x2="25" y2="55" stroke="#ddd" stroke-width="1"/>
                                <circle cx="40" cy="40" r="8" fill="none"/>
                            </svg>
                        </div>
                        <h4>No artworks yet</h4>
                        <p>Add your first artwork to start building your archive</p>
                        <button class="cta-button" onclick="showUploadForm()">Upload Your First Piece</button>
                    </div>
                `;
                return;
            }

            grid.innerHTML = artworks.map(artwork => `
                <div class="artwork-card">
                    <div class="artwork-image">
                        <img src="${artwork.image_url}" alt="${artwork.title}" onclick="openArtworkPopup('${artwork.image_url}')">
                    </div>
                    <div class="artwork-info">
                        <h3 class="artwork-title">${artwork.title || 'Untitled'}</h3>
                        <div class="artwork-details">
                            ${artwork.year ? `<div>${artwork.year}</div>` : ''}
                            ${artwork.medium ? `<div>${artwork.medium}</div>` : ''}
                            ${artwork.dimensions ? `<div>${artwork.dimensions}</div>` : ''}
                        </div>
                        <div class="artwork-actions">
                            <button class="delete-btn" onclick="deleteArtwork('${artwork.id}')">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function displayEventsGrid(events) {
            const grid = document.getElementById('eventsGrid');
            if (!grid) return;

            if (!events || events.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none" stroke="#ddd" stroke-width="1.5">
                                <rect x="15" y="15" width="50" height="35" rx="2" fill="none"/>
                                <rect x="20" y="55" width="40" height="15" rx="1" fill="none"/>
                                <line x1="30" y1="20" x2="50" y2="20" stroke="#ddd" stroke-width="1"/>
                                <line x1="30" y1="25" x2="50" y2="25" stroke="#ddd" stroke-width="1"/>
                                <line x1="30" y1="30" x2="40" y2="30" stroke="#ddd" stroke-width="1"/>
                            </svg>
                        </div>
                        <h4>No upcoming events</h4>
                        <p>Add exhibitions, shows, or important dates to track your artistic calendar</p>
                        <button class="cta-button" onclick="showAddEventForm()">Add Your First Event</button>
                    </div>
                `;
                return;
            }

            grid.innerHTML = events.map(event => `
                <div class="event-card">
                    <div class="event-date">${new Date(event.event_date).toLocaleDateString()}</div>
                    <div class="event-title">${event.title}</div>
                    ${event.location ? `<div class="event-location">📍 ${event.location}</div>` : ''}
                    ${event.description ? `<div class="event-description">${event.description}</div>` : ''}
                    <div class="event-actions">
                        <button class="delete-btn" onclick="deleteEvent('${event.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            // Update artwork count
            const artworksCount = currentArtworks.length;
            document.getElementById('artworksCount').textContent = artworksCount;

            // Update other stats (collections and events would need to be fetched)
            // For now, we'll set them to 0 and update when we have the data
            document.getElementById('collectionsCount').textContent = '0';
            document.getElementById('eventsCount').textContent = '0';
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showSection(sectionName) {
            // Hide all sections
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('dashboard-section').style.display = 'none';
            document.getElementById('settings-section').style.display = 'none';
            document.getElementById('portfolio-section').style.display = 'none';

            // Show selected section
            const section = document.getElementById(sectionName + '-section');
            if (section) {
                section.style.display = 'block';
            }

            // Load section data
            if (sectionName === 'dashboard') {
                fetchUserArtworks();
                fetchUserEvents();
                fetchActivities().then(displayActivities);
            } else if (sectionName === 'settings') {
                loadProfileData();
            } else if (sectionName === 'portfolio') {
                loadPortfolio();
            }
        }

        function showToast(message, type = 'success') {
            // Remove existing toast
            const existingToast = document.getElementById('global-toast');
            if (existingToast) existingToast.remove();

            // Create toast
            const toast = document.createElement('div');
            toast.id = 'global-toast';
            toast.textContent = message;
            if (type === 'error') {
                toast.style.background = '#dc2626';
            }

            document.body.appendChild(toast);

            // Auto remove
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 3000);
        }

        function clearPortfolioCache() {
            cachedPortfolioData = null;
            cachedArtworksData = null;
            cachedCollectionsData = null;
            cachedEventsData = null;
        }

        function setupPortfolioNavigation() {
            const navItems = document.querySelectorAll('.portfolio-nav .nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');

                    const tabName = this.getAttribute('data-tab');
                    document.querySelectorAll('.portfolio-tab').forEach(tab => {
                        tab.style.display = tab.id === `${tabName}-section` ? 'block' : 'none';
                    });
                });
            });
        }

        function openArtworkPopup(imageUrl) {
            document.getElementById('popupArtworkImage').src = imageUrl;
            document.getElementById('artworkPopup').style.display = 'flex';
        }

        function closeArtworkPopup() {
            document.getElementById('artworkPopup').style.display = 'none';
        }

        function rgbToHex(rgb) {
            // Simple RGB to hex conversion - this is a placeholder
            // In production, you'd want a proper RGB to HEX conversion
            if (rgb.includes('rgb')) {
                const values = rgb.match(/\d+/g);
                if (values && values.length >= 3) {
                    return '#' + values.map(x => {
                        const hex = parseInt(x).toString(16);
                        return hex.length === 1 ? '0' + hex : hex;
                    }).join('');
                }
            }
            return '#ffffff';
        }

        // ==================== IMAGE HANDLING ====================
        function handleImageSelect(event) {
            if (event.target.files.length > 0) {
                handleImageFile(event.target.files[0]);
            }
        }

        function handleImageFile(file) {
            if (!file.type.startsWith('image/')) {
                showToast('Please select an image file', 'error');
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                showToast('Image must be smaller than 5MB', 'error');
                return;
            }

            selectedImageFile = file;

            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('uploadPlaceholder').style.display = 'none';
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('imagePreview').innerHTML = `
                    <img src="${e.target.result}" alt="Preview">
                    <div style="margin-top: 1rem; font-size: 0.8rem; color: #666;">
                        ${file.name} (${Math.round(file.size / 1024)}KB)
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function clearImageSelection() {
            selectedImageFile = null;
            document.getElementById('uploadPlaceholder').style.display = 'block';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('imageInput').value = '';
        }

        function handleEventImageSelect(event) {
            if (event.target.files.length > 0) {
                handleEventImageFile(event.target.files[0]);
            }
        }

        function handleEventImageFile(file) {
            if (!file.type.startsWith('image/')) {
                showToast('Please select an image file', 'error');
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                showToast('Image must be smaller than 5MB', 'error');
                return;
            }

            selectedEventImageFile = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('eventImagePreview').innerHTML = `
                    <img src="${e.target.result}" alt="Event preview" style="max-width: 200px; border-radius: 8px;">
                    <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">
                        ${file.name} (${Math.round(file.size / 1024)}KB)
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function clearEventImageSelection() {
            selectedEventImageFile = null;
            document.getElementById('eventImagePreview').innerHTML = '';
        }

        // ==================== FORM SWITCHING ====================
        function showSignUpForm() {
            document.getElementById('signInForm').style.display = 'none';
            document.getElementById('signUpForm').style.display = 'block';
        }

        function showSignInForm() {
            document.getElementById('signUpForm').style.display = 'none';
            document.getElementById('signInForm').style.display = 'block';
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.parentNode.querySelector('button');
            
            if (input.type === 'password') {
                input.type = 'text';
                button.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>`;
            } else {
                input.type = 'password';
                button.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>`;
            }
        }

        // ==================== PLACEHOLDER FUNCTIONS ====================
        // These would be fully implemented in a production system
        async function loadProfileData() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) return;

                const { data: profile, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', user.id)
                    .single();

                if (error) {
                    console.error('Error loading profile:', error);
                    return;
                }

                // Populate form fields
                if (profile) {
                    document.getElementById('username').value = profile.username || '';
                    document.getElementById('profileFullName').value = profile.full_name || '';
                    document.getElementById('bio').value = profile.bio || '';
                    document.getElementById('website').value = profile.website || '';
                    document.getElementById('contactEmail').value = profile.contact_email || '';
                    
                    // Update portfolio link
                    document.getElementById('portfolioLink').value = `trac.art/${profile.username}`;
                    
                    // Load social platforms
                    if (profile.social_links) {
                        document.getElementById('socialPlatformsContainer').innerHTML = '';
                        Object.entries(profile.social_links).forEach(([platform, username]) => {
                            addSocialPlatform(platform, username);
                        });
                    }
                }

            } catch (error) {
                console.error('Error loading profile data:', error);
                showToast('Error loading profile', 'error');
            }
        }

        function setupActivitiesRealtime() {
            // Implementation would go here
            console.log('Setting up real-time activities...');
        }

        function showArchivedPopup() {
            // Implementation would go here
            console.log('Showing archived popup...');
            showToast('Archived works feature coming soon!');
        }

        function showActivityHistory() {
            // Implementation would go here
            console.log('Showing activity history...');
            showToast('Activity history feature coming soon!');
        }

        function copyPortfolioLink() {
            const linkInput = document.getElementById('portfolioLink');
            linkInput.select();
            document.execCommand('copy');
            showToast('Portfolio link copied to clipboard!');
        }

        function hideCreateCollectionForm() {
            document.getElementById('createCollectionForm').style.display = 'none';
            document.getElementById('collectionForm').reset();
        }

        function hideActivityHistory() {
            document.getElementById('activityHistoryPopup').style.display = 'none';
        }

        function hideArchivedPopup() {
            document.getElementById('archivedPopup').style.display = 'none';
        }

        function showTermsPopup() {
            document.getElementById('termsPopup').style.display = 'flex';
        }

        function hideTermsPopup() {
            document.getElementById('termsPopup').style.display = 'none';
        }

        function showPrivacyPopup() {
            document.getElementById('privacyPopup').style.display = 'flex';
        }

        function hidePrivacyPopup() {
            document.getElementById('privacyPopup').style.display = 'none';
        }

        function requestPasswordReset() {
            const email = document.getElementById('email').value;
            if (!email) {
                showToast('Please enter your email address', 'error');
                return;
            }
            showToast('Password reset feature coming soon!');
        }

        function toggleFavorite(styleId) {
            const index = favoriteStyles.indexOf(styleId);
            if (index > -1) {
                favoriteStyles.splice(index, 1);
            } else {
                favoriteStyles.push(styleId);
            }
            loadStyleBrowser(); // Refresh to show updated favorites
        }

        function previewStyle(styleId) {
            // Implementation for style preview
            console.log('Previewing style:', styleId);
            showToast('Style preview: ' + STYLE_PRESETS[styleId].name);
        }

        async function deleteArtwork(artworkId) {
            if (!confirm('Are you sure you want to delete this artwork?')) return;
            
            try {
                const { error } = await supabaseClient
                    .from('artworks')
                    .delete()
                    .eq('id', artworkId);

                if (error) throw error;

                showToast('Artwork deleted successfully');
                fetchUserArtworks();
                clearPortfolioCache();

            } catch (error) {
                console.error('Error deleting artwork:', error);
                showToast('Error deleting artwork', 'error');
            }
        }

        async function deleteEvent(eventId) {
            if (!confirm('Are you sure you want to delete this event?')) return;
            
            try {
                const { error } = await supabaseClient
                    .from('events')
                    .delete()
                    .eq('id', eventId);

                if (error) throw error;

                showToast('Event deleted successfully');
                fetchUserEvents();
                clearPortfolioCache();

            } catch (error) {
                console.error('Error deleting event:', error);
                showToast('Error deleting event', 'error');
            }
        }

        // ==================== EVENT LISTENERS ====================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();

            // Form switching
            document.getElementById('switchToSignUp').addEventListener('click', showSignUpForm);
            document.getElementById('switchToSignIn').addEventListener('click', showSignInForm);

            // Artwork form
            document.getElementById('artworkUploadForm').addEventListener('submit', function(e) {
                e.preventDefault();
                uploadArtwork();
            });

            // Image upload
            document.getElementById('uploadZone').addEventListener('click', function() {
                document.getElementById('imageInput').click();
            });
            document.getElementById('imageInput').addEventListener('change', handleImageSelect);

            // Profile form
            document.getElementById('profileSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const submitBtn = document.getElementById('profileSubmitBtn');
                const submitText = document.getElementById('profileSubmitText');
                
                // Set loading state
                submitBtn.disabled = true;
                submitText.innerHTML = '<span class="loading-spinner"></span> Saving...';

                // Simulate save operation
                setTimeout(() => {
                    showToast('Profile saved successfully');
                    submitBtn.disabled = false;
                    submitText.textContent = 'Save Profile';
                }, 1000);
            });

            // Event form
            document.getElementById('eventForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                createEvent({
                    title: formData.get('title'),
                    eventType: formData.get('eventType'),
                    eventDate: formData.get('eventDate'),
                    location: formData.get('location'),
                    description: formData.get('description')
                });
            });

            // Collection form
            document.getElementById('collectionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                createCollection({
                    name: formData.get('name'),
                    statement: formData.get('statement')
                });
            });

            // Event image upload
            document.getElementById('eventImageUpload').addEventListener('change', handleEventImageSelect);

            // Close popup on background click
            document.getElementById('artworkPopup').addEventListener('click', function(e) {
                if (e.target === this) closeArtworkPopup();
            });

            // ESC key to close popups
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeArtworkPopup();
                    hideUploadForm();
                    hideStyleBrowser();
                    hideAddEventForm();
                    hideCreateCollectionForm();
                }
            });

            // Real-time font size updates
            document.getElementById('headerFontSize')?.addEventListener('input', function() {
                document.getElementById('headerFontSizeValue').textContent = this.value + 'px';
            });
            document.getElementById('navFontSize')?.addEventListener('input', function() {
                document.getElementById('navFontSizeValue').textContent = this.value + 'px';
            });

            // Drag and drop for upload zone
            const uploadZone = document.getElementById('uploadZone');
            if (uploadZone) {
                uploadZone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });

                uploadZone.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                });

                uploadZone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    if (e.dataTransfer.files.length > 0) {
                        handleImageFile(e.dataTransfer.files[0]);
                    }
                });
            }
        });
    </script>
</body>
</html>